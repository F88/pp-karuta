import{r as c,j as e,R as je,c as mt}from"./react-vendor-CZsbqYdR.js";import{u as xe,L as le,c as pt,O as ut,a as he,b as xt,d as ht,R as ft}from"./tanstack-router-CdYXsu92.js";import{t as yt,c as bt,S as vt,a as fe,b as Pe,C as wt,d as Ce,P as jt,e as Ee,I as Re,f as Ie,g as Te,h as kt,R as $e,i as ze,L as De,j as Ae,k as St,T as Nt,l as Pt,M as Ct,m as Et,n as Rt,o as It,p as Tt,O as Me,q as $t,r as Fe,s as zt,X as Dt,u as Le,D as _e,v as At,w as Mt,E as Ft,x as Lt,y as _t,z as Ot,A as Bt,B as Gt,F as Yt,G as Kt,H as Ut,J as Ht,K as Wt,N as Vt,Q as Xt,U as Oe,V as qt}from"./vendor-BA9RSyYg.js";import{T as Jt,a as Zt,c as Qt,t as ea,p as ta,g as aa,C as sa}from"./promidas-2nzqTpKI.js";import{f as D}from"./faker-vendor-lT0botVD.js";const ra={theme:"system",setTheme:()=>null},Be=c.createContext(ra);function na({children:a,defaultTheme:t="system",storageKey:s="vite-ui-theme",...r}){const[n,i]=c.useState(()=>localStorage.getItem(s)||t);c.useEffect(()=>{const l=window.document.documentElement;if(l.classList.remove("light","dark"),n==="system"){const d=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";l.classList.add(d);return}l.classList.add(n)},[n]);const o={theme:n,setTheme:l=>{localStorage.setItem(s,l),i(l)}};return e.jsx(Be.Provider,{...r,value:o,children:a})}const ia=()=>{const a=c.useContext(Be);if(a===void 0)throw new Error("useTheme must be used within a ThemeProvider");return a};function S(...a){return yt(bt(a))}const oa=fe("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),P=c.forwardRef(({className:a,variant:t,size:s,asChild:r=!1,...n},i)=>{const o=r?vt:"button";return e.jsx(o,{className:S(oa({variant:t,size:s,className:a})),ref:i,...n})});P.displayName="Button";const la=St,da=Nt,ca=c.forwardRef(({className:a,inset:t,children:s,...r},n)=>e.jsxs(Pe,{ref:n,className:S("focus:bg-accent data-[state=open]:bg-accent flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none select-none [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",a),...r,children:[s,e.jsx(wt,{className:"ml-auto"})]}));ca.displayName=Pe.displayName;const ga=c.forwardRef(({className:a,...t},s)=>e.jsx(Ce,{ref:s,className:S("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-[--radix-dropdown-menu-content-transform-origin] overflow-hidden rounded-md border p-1 shadow-lg",a),...t}));ga.displayName=Ce.displayName;const Ge=c.forwardRef(({className:a,sideOffset:t=4,...s},r)=>e.jsx(jt,{children:e.jsx(Ee,{ref:r,sideOffset:t,className:S("bg-popover text-popover-foreground z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",a),...s})}));Ge.displayName=Ee.displayName;const ee=c.forwardRef(({className:a,inset:t,...s},r)=>e.jsx(Re,{ref:r,className:S("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm transition-colors outline-none select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",a),...s}));ee.displayName=Re.displayName;const ma=c.forwardRef(({className:a,children:t,checked:s,...r},n)=>e.jsxs(Ie,{ref:n,className:S("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center rounded-sm py-1.5 pr-2 pl-8 text-sm transition-colors outline-none select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:s,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Te,{children:e.jsx(kt,{className:"h-4 w-4"})})}),t]}));ma.displayName=Ie.displayName;const pa=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs($e,{ref:r,className:S("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center rounded-sm py-1.5 pr-2 pl-8 text-sm transition-colors outline-none select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Te,{children:e.jsx(ze,{className:"h-2 w-2 fill-current"})})}),t]}));pa.displayName=$e.displayName;const ua=c.forwardRef(({className:a,inset:t,...s},r)=>e.jsx(De,{ref:r,className:S("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",a),...s}));ua.displayName=De.displayName;const xa=c.forwardRef(({className:a,...t},s)=>e.jsx(Ae,{ref:s,className:S("bg-muted -mx-1 my-1 h-px",a),...t}));xa.displayName=Ae.displayName;function ha(){const{setTheme:a}=ia();return e.jsxs(la,{children:[e.jsx(da,{asChild:!0,children:e.jsxs(P,{variant:"ghost",size:"icon",children:[e.jsx(Pt,{className:"h-[1.2rem] w-[1.2rem] scale-100 rotate-0 transition-all dark:scale-0 dark:-rotate-90"}),e.jsx(Ct,{className:"absolute h-[1.2rem] w-[1.2rem] scale-0 rotate-90 transition-all dark:scale-100 dark:rotate-0"}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),e.jsxs(Ge,{align:"end",children:[e.jsx(ee,{onClick:()=>a("light"),children:"Light"}),e.jsx(ee,{onClick:()=>a("dark"),children:"Dark"}),e.jsx(ee,{onClick:()=>a("system"),children:"System"})]})]})}function fa({state:a,onClick:t}){const s=()=>{switch(a.type){case"not-created":return{icon:Tt,color:"text-gray-400"};case"validating":return{icon:It,color:"text-blue-500"};case"created-token-valid":return{icon:Rt,color:"text-green-500"};case"token-invalid":return{icon:Et,color:"text-red-500"}}},{icon:r,color:n}=s();return e.jsx(P,{type:"button",onClick:t,variant:"ghost",size:"icon","aria-label":"Repository status",children:e.jsx(r,{className:`h-5 w-5 ${n}`})})}function ya({state:a,onClick:t}){return e.jsx(fa,{state:a,onClick:t})}function ye(a){return{base:a?"bg-indigo-600 text-white dark:bg-indigo-500":"bg-white dark:bg-gray-800",title:a?"text-white":"text-gray-900 dark:text-gray-100",description:a?"text-white/90":"text-gray-600 dark:text-gray-400",label:a?"text-white/80":"text-gray-500 dark:text-gray-400",content:a?"text-white/90":"text-gray-700 dark:text-gray-300",iconBg:a?"bg-white/20 text-white":"bg-indigo-100 dark:bg-indigo-900",animation:"transition-all duration-300 hover:-translate-y-1 hover:shadow-2xl active:translate-y-0",gradient:`absolute inset-0 bg-gradient-to-br from-blue-400 to-indigo-500 opacity-0 transition-opacity group-hover:opacity-10 ${a?"opacity-20":""}`}}function k(a,t){return!a&&t.responsive?t.responsive:t[a||"tablet"]}function ba({screenSize:a,homeButton:t,rulesButton:s,playerButton:r,repoStateIndicator:n,themeToggle:i}){const o=k(a,{smartphone:{height:"h-10",padding:"px-2",gap:"gap-1"},tablet:{height:"h-12",padding:"px-4",gap:"gap-2"},pc:{height:"h-14",padding:"px-4",gap:"gap-2"},responsive:{height:"h-12 md:h-14 lg:h-16",padding:"px-2 md:px-4",gap:"gap-1 md:gap-2"}}),l=`Application header - ${a} view`;return e.jsx("header",{className:`border-b bg-white dark:border-gray-800 dark:bg-gray-950 ${o.height}`,"aria-label":l,children:e.jsxs("div",{className:`mx-auto flex h-full max-w-7xl items-center justify-between ${o.padding}`,children:[e.jsxs("div",{className:`flex items-center ${o.gap}`,children:[t,r]}),e.jsxs("div",{className:`flex items-center ${o.gap}`,children:[s,n,i]})]})})}function va({repoState:a,onRepoIndicatorClick:t,screenSize:s}){const r=xe(),n=k(s,{smartphone:{buttonText:"text-xs",iconText:"text-base"},tablet:{buttonText:"text-sm",iconText:"text-lg"},pc:{buttonText:"text-base",iconText:"text-xl"},responsive:{buttonText:"text-xs md:text-sm lg:text-base",iconText:"text-base md:text-lg lg:text-xl"}}),i=o=>{o.preventDefault(),r({to:"/",search:{reset:Date.now().toString()}})};return e.jsx(ba,{screenSize:s,homeButton:e.jsx(P,{variant:"ghost",size:"sm",asChild:!0,"aria-label":"ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹",className:n.buttonText,children:e.jsxs(le,{to:"/",onClick:i,title:"ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹",children:[e.jsx("span",{className:n.iconText,children:"ğŸ´"})," MENU"]})}),playerButton:e.jsx(P,{variant:"ghost",size:"sm",asChild:!0,"aria-label":"ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†",className:n.buttonText,children:e.jsxs(le,{to:"/player",title:"ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†",children:[e.jsx("span",{className:n.iconText,children:"ğŸ§™"})," PLAYER"]})}),rulesButton:e.jsx(P,{variant:"ghost",size:"sm",asChild:!0,"aria-label":"æŸã‚’ç¢ºèª",className:n.buttonText,children:e.jsxs(le,{to:"/intro",title:"æŸã‚’ç¢ºèª",children:[e.jsx("span",{className:n.iconText,children:"ğŸ“œ"})," æŸ"]})}),repoStateIndicator:e.jsx(ya,{state:a,onClick:t}),themeToggle:e.jsx(ha,{})})}const b={log:(...a)=>{console.log("[LOG]",...a)},debug:(...a)=>{},info:(...a)=>{},warn:(...a)=>{console.warn("[WARN]",...a)},error:(...a)=>{console.error("[ERROR]",...a)}},wa=At,ja=$t,Ye=c.forwardRef(({className:a,...t},s)=>e.jsx(Me,{ref:s,className:S("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",a),...t}));Ye.displayName=Me.displayName;const Ke=c.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(ja,{children:[e.jsx(Ye,{}),e.jsxs(Fe,{ref:r,className:S("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] fixed top-[50%] left-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 sm:rounded-lg",a),...s,children:[t,e.jsxs(zt,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none disabled:pointer-events-none",children:[e.jsx(Dt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ke.displayName=Fe.displayName;const Ue=({className:a,...t})=>e.jsx("div",{className:S("flex flex-col space-y-1.5 text-center sm:text-left",a),...t});Ue.displayName="DialogHeader";const He=c.forwardRef(({className:a,...t},s)=>e.jsx(Le,{ref:s,className:S("text-lg leading-none font-semibold tracking-tight",a),...t}));He.displayName=Le.displayName;const We=c.forwardRef(({className:a,...t},s)=>e.jsx(_e,{ref:s,className:S("text-muted-foreground text-sm",a),...t}));We.displayName=_e.displayName;const U=Jt.forSessionStorage(Zt.PROTOPEDIA_API_V2_TOKEN);function ka(a=5){const t=[],s=new Set;for(let r=0;r<a;r++){let n;do n=D.number.int({min:1,max:1e5});while(s.has(n));s.add(n),t.push({id:n,prototypeNm:D.commerce.productName(),summary:D.commerce.productDescription(),freeComment:D.lorem.paragraph(),systemDescription:D.lorem.sentence(),mainUrl:D.image.url(),users:[D.person.fullName()],tags:D.helpers.arrayElements(["IoT","AI","Robot","Education","Healthcare","Entertainment"],{min:1,max:3}),materials:[],events:[],awards:[],teamNm:D.company.name(),createDate:D.date.past().toISOString(),updateDate:void 0,releaseDate:void 0,officialLink:void 0,videoUrl:void 0,relatedLink:void 0,relatedLink2:void 0,relatedLink3:void 0,relatedLink4:void 0,relatedLink5:void 0,viewCount:D.number.int({min:0,max:1e4}),goodCount:D.number.int({min:0,max:1e3}),commentCount:D.number.int({min:0,max:100}),releaseFlg:1,status:1,createId:void 0,updateId:void 0,uuid:void 0,nid:void 0,revision:void 0,licenseType:void 0,thanksFlg:void 0,slideMode:void 0})}return t}class Sa{allPrototypes;filteredPrototypes;events=new Mt.EventEmitter;constructor(){const t=performance.now();this.allPrototypes=ka(1e4);const r=performance.now()-t;this.filteredPrototypes=this.allPrototypes,b.debug(`[DummyRepository] Generated 10000 prototypes in ${r.toFixed(2)}ms`)}getConfig(){return{ttlMs:1/0,maxDataSizeBytes:30*1024*1024,logLevel:"info"}}getStats(){return{size:this.filteredPrototypes.length,cachedAt:new Date,isExpired:!1,remainingTtlMs:1/0,dataSizeBytes:0,refreshInFlight:!1}}async setupSnapshot(t){this.events.emit("snapshotStarted","setup");const s=performance.now(),r=this.allPrototypes.filter(m=>!(t.userNm&&!m.users.some(p=>p===t.userNm)||t.materialNm&&!m.materials.some(p=>p===t.materialNm)||t.tagNm&&!m.tags.some(p=>p===t.tagNm)||t.eventNm&&!m.events.some(p=>p===t.eventNm))),n=t.offset??0,i=t.limit??r.length,o=r.slice(n,n+i);this.filteredPrototypes=o;const d=performance.now()-s;b.debug(`[DummyRepository] Filtering took ${d.toFixed(2)}ms`),b.info(`[DummyRepository] Filtered ${this.allPrototypes.length} -> ${r.length} -> ${o.length} prototypes`);const g=this.getStats();return this.events.emit("snapshotCompleted",g),{ok:!0,stats:g}}async refreshSnapshot(){this.events.emit("snapshotStarted","refresh");const t=this.getStats();return this.events.emit("snapshotCompleted",t),{ok:!0,stats:t}}async analyzePrototypes(){if(this.filteredPrototypes.length===0)return{min:null,max:null};let t=this.filteredPrototypes[0].id,s=this.filteredPrototypes[0].id;for(const r of this.filteredPrototypes)r.id<t&&(t=r.id),r.id>s&&(s=r.id);return{min:t,max:s}}async getAllFromSnapshot(){return this.filteredPrototypes}async getPrototypeIdsFromSnapshot(){return this.filteredPrototypes.map(t=>t.id)}async getPrototypeFromSnapshotByPrototypeId(t){return this.filteredPrototypes.find(s=>s.id===t)??null}async getRandomPrototypeFromSnapshot(){if(this.filteredPrototypes.length===0)return null;const t=Math.floor(Math.random()*this.filteredPrototypes.length);return this.filteredPrototypes[t]??null}async getRandomSampleFromSnapshot(t){if(t<=0||this.filteredPrototypes.length===0)return[];const s=[...this.filteredPrototypes].sort(()=>Math.random()-.5);return s.slice(0,Math.min(t,s.length))}dispose(){}}let de=null;function Na(){return de||(de=new Sa),de}class K{static instance=null;repository=null;tokenStatus="not-validated";error=null;initPromise=null;initPromiseId=0;storage;constructor(t=U){this.storage=t}static getInstance(t=U){return K.instance||(K.instance=new K(t)),K.instance}isDummyMode(){return!1}getState(){if(!this.repository)return this.tokenStatus==="invalid"?{type:"token-invalid",error:this.error||"Unknown error"}:{type:"not-created"};switch(this.tokenStatus){case"not-validated":return{type:"validating"};case"valid":return{type:"created-token-valid",repository:this.repository};case"invalid":return{type:"token-invalid",error:this.error||"Unknown error"}}}reset(){this.repository=null,this.tokenStatus="not-validated",this.error=null,this.initPromise=null,this.initPromiseId++}static resetInstance(){K.instance=null}createRepository(t){return Qt({protopediaApiToken:t,logLevel:"info"})}async setupSnapshot(t,s){return await t.setupSnapshot(s)}async validateRepository(t){return await t.setupSnapshot({limit:0})}getDummyRepository(){return this.repository||(this.repository=Na(),this.tokenStatus="valid"),this.repository}async getRepository(){if(this.isDummyMode())return this.getDummyRepository();const t=this.getState();if(t.type==="created-token-valid")return t.repository;if(this.initPromise)return this.initPromise;const s=this.initPromiseId;return this.initPromise=(async()=>{try{const r=await this.storage.get();if(!r)throw new Error("ProtoPedia API token is missing. Provide a token via the in-app Token UI.");if(r.trim()==="")throw this.repository=null,this.tokenStatus="invalid",this.error="Token is empty",new Error("Token is empty");let n;try{n=this.createRepository(r),this.initPromiseId===s&&(this.repository=n,this.tokenStatus="not-validated",this.error=null)}catch(o){b.error("Failed to create Promidas repository:",o);const l=o instanceof Error?ea(o):"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";throw this.initPromiseId===s&&(this.repository=null,this.tokenStatus="invalid",this.error=l),new Error(l)}const i=await this.validateRepository(n);if(!i.ok){b.error("Token validation failed:",i);const l=ta(i)?.localizedMessage||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";throw b.info("Parsed token validation error:",l),this.initPromiseId===s&&(this.repository=null,this.tokenStatus="invalid",this.error=l),new Error(l)}return this.initPromiseId===s&&(this.tokenStatus="valid",this.error=null),n}finally{this.initPromiseId===s&&(this.initPromise=null)}})(),this.initPromise}}function Pa(){return K.getInstance()}const A=Pa();function Ca(){const[a,t]=c.useState(null),[s,r]=c.useState(!1),[n,i]=c.useState(!0);c.useEffect(()=>{(async()=>{try{const g=await U.get();t(g),r(await U.has())}catch(g){b.error("[useToken] Failed to load token from storage",g)}finally{i(!1)}})()},[]);const o=c.useCallback(async d=>{await U.save(d),t(d),r(!0)},[]),l=c.useCallback(async()=>{await U.remove(),t(null),r(!1)},[]);return{token:a,hasToken:s,isLoading:n,saveToken:o,removeToken:l}}const Ve=c.forwardRef(({className:a,type:t,...s},r)=>e.jsx("input",{type:t,className:S("border-input bg-background file:text-foreground placeholder:text-muted-foreground focus-visible:ring-ring flex h-9 w-full rounded-md border px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:ring-1 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",a),ref:r,...s}));Ve.displayName="Input";const F=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:S("bg-card text-card-foreground rounded-xl border shadow",a),...t}));F.displayName="Card";const G=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:S("flex flex-col space-y-1.5 p-6",a),...t}));G.displayName="CardHeader";const H=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:S("leading-none font-semibold tracking-tight",a),...t}));H.displayName="CardTitle";const te=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:S("text-muted-foreground text-sm",a),...t}));te.displayName="CardDescription";const L=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:S("p-6 pt-0",a),...t}));L.displayName="CardContent";const Xe=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:S("flex items-center p-6 pt-0",a),...t}));Xe.displayName="CardFooter";function Ea({inputValue:a,showToken:t,hasToken:s,isValidating:r,repoState:n,onInputChange:i,onToggleShowToken:o,onSave:l,onRemove:d,screenSize:g}){const m=g?{smartphone:"p-3",tablet:"p-4",pc:"p-6"}[g]:"p-3 md:p-4 lg:p-6",p=g?{smartphone:"text-base",tablet:"text-lg",pc:"text-xl"}[g]:"text-base md:text-lg lg:text-xl",x=g?{smartphone:"text-xs",tablet:"text-sm",pc:"text-sm"}[g]:"text-xs md:text-sm",u=g?{smartphone:"space-y-2",tablet:"space-y-3",pc:"space-y-3"}[g]:"space-y-2 md:space-y-3",y=()=>r?e.jsx("p",{className:"text-muted-foreground text-xs",children:"Tokenã‚’ç¢ºèªä¸­..."}):n.type==="created-token-valid"?e.jsx("p",{className:"text-muted-foreground text-xs",children:"Tokenã¯æœ‰åŠ¹ã§ã™"}):n.type==="token-invalid"?e.jsx("p",{className:"text-destructive text-xs",children:"TokenãŒç„¡åŠ¹ã§ã™ã€‚ã‚‚ã—ãã¯APIã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚"}):null,h=()=>s?r?e.jsx(_t,{className:"animate-spin",size:20}):n.type==="created-token-valid"?e.jsx(Ot,{className:"text-green-600",size:20}):n.type==="token-invalid"?e.jsx(Bt,{className:"text-destructive",size:20}):null:e.jsx(ze,{className:"text-muted-foreground",size:20});return e.jsxs(F,{className:"w-full max-w-sm",children:[e.jsx(G,{className:m,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(H,{className:p,children:"API Token"}),e.jsx(te,{className:x,children:"ProtoPedia APIãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®š"})]}),h()]})}),e.jsx(L,{className:m,children:e.jsxs("form",{className:u,onSubmit:f=>{f.preventDefault(),l()},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{type:t?"text":"password",id:"protopedia-api-token",name:"protopedia-api-token",value:a,onChange:f=>i(f.target.value),placeholder:"ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å…¥åŠ›",autoComplete:"on"}),e.jsx(P,{type:"button",variant:"outline",size:"icon",onClick:o,"aria-label":t?"Hide token":"Show token",children:t?e.jsx(Ft,{size:18}):e.jsx(Lt,{size:18})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{type:"submit",className:"flex-1",disabled:!a.trim()||r,children:"ä¸€æ™‚çš„ã«ä¿å­˜"}),s&&e.jsx(P,{type:"button",variant:"destructive",className:"flex-1",onClick:d,children:"å‰Šé™¤"})]}),y()]})}),e.jsx(Xe,{className:m,children:e.jsxs("p",{className:`text-muted-foreground ${x}`,children:["ãƒˆãƒ¼ã‚¯ãƒ³ã¯"," ",e.jsx("a",{href:"https://protopedia.net",target:"_blank",rel:"noopener noreferrer",className:"hover:text-primary font-semibold underline underline-offset-4",children:"ProtoPedia"})," ","ã§ç¢ºèªã—ã¦ãã ã•ã„"]})})]})}function Ra({screenSize:a}){const{token:t,hasToken:s,saveToken:r,removeToken:n}=Ca(),[i,o]=c.useState(""),[l,d]=c.useState(!1),[g,m]=c.useState(!1),[p,x]=c.useState({type:"not-created"});c.useEffect(()=>{o(t||"")},[t]),c.useEffect(()=>{if(!s){x({type:"not-created"});return}const w=A.getState();x(w)},[s]);const u=async()=>{if(i.trim()){A.reset(),await r(i.trim()),m(!0);try{await A.getRepository();const w=A.getState();b.info("[TokenManager] Repository state after validation:",w),x(w)}catch(w){const R=w instanceof Error?w.message:String(w);b.error("[TokenManager] Validation failed:",R),x({type:"token-invalid",error:R})}finally{m(!1)}}},y=async()=>{await n(),A.reset(),o(""),x({type:"not-created"})},h=w=>{o(w)},f=()=>{d(!l)};return e.jsx(Ea,{inputValue:i,showToken:l,hasToken:s,isValidating:g,repoState:p,onInputChange:h,onToggleShowToken:f,onSave:u,onRemove:y,screenSize:a})}function Ia(){const[a,t]=c.useState(null),[s,r]=c.useState("not-stored");return c.useEffect(()=>{const i=async()=>{if(A.getState().type!=="created-token-valid"){t(null),r("not-stored");return}try{const g=(await A.getRepository()).getStats();t(g),r(aa(g))}catch{t(null),r("not-stored")}};i();const o=setInterval(()=>{i()},1e4);return()=>clearInterval(o)},[]),{storeState:s,stats:a,isReady:s==="stored"}}const Ta=fe("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Y({className:a,variant:t,...s}){return e.jsx("div",{className:S(Ta({variant:t}),a),...s})}function $a({repoState:a,repoError:t,storeState:s,storeStats:r,useDummyData:n,screenSize:i}){const o=k(i,{smartphone:{padding:"p-3",title:{size:"text-sm"},text:{size:"text-xs"},spacing:"space-y-3"},tablet:{padding:"p-4",title:{size:"text-base"},text:{size:"text-sm"},spacing:"space-y-4"},pc:{padding:"p-6",title:{size:"text-base"},text:{size:"text-sm"},spacing:"space-y-4"},responsive:{padding:"p-3 md:p-4 lg:p-6",title:{size:"text-sm md:text-base"},text:{size:"text-xs md:text-sm"},spacing:"space-y-3 md:space-y-4"}}),l=x=>{switch(x.type){case"not-created":return"æœªåˆæœŸåŒ–";case"validating":return"æ¤œè¨¼ä¸­";case"token-invalid":return"ç„¡åŠ¹";case"created-token-valid":return"æœ‰åŠ¹"}},d=x=>{switch(x.type){case"not-created":return"bg-muted text-muted-foreground";case"validating":return"bg-blue-600 text-white dark:bg-blue-700";case"token-invalid":return"bg-destructive text-destructive-foreground";case"created-token-valid":return"bg-green-600 text-white dark:bg-green-700"}},g=x=>{switch(x){case"not-stored":return"æœªä¿å­˜";case"stored":return"ä¿å­˜æ¸ˆã¿";case"expired":return"æœŸé™åˆ‡ã‚Œ"}},m=x=>{switch(x){case"not-stored":return"bg-muted text-muted-foreground";case"stored":return"bg-blue-600 text-white dark:bg-blue-700";case"expired":return"bg-yellow-600 text-white dark:bg-yellow-700"}},p=x=>{if(x<=0)return"0ç§’";const u=Math.floor(x/1e3),y=Math.floor(u/60),h=Math.floor(y/60);return h>0?`${h}æ™‚é–“${y%60}åˆ†`:y>0?`${y}åˆ†${u%60}ç§’`:`${u}ç§’`};return n?e.jsxs(F,{className:"w-full max-w-md",children:[e.jsxs(G,{className:o.padding,children:[e.jsx(H,{className:o.title.size,children:"PROMIDAS Repository"}),e.jsx(te,{className:o.text.size,children:"ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ¼ãƒ‰"})]}),e.jsx(L,{className:o.padding,children:e.jsx("p",{className:`text-muted-foreground ${o.text.size}`,children:"ç’°å¢ƒå¤‰æ•° VITE_USE_DUMMY_DATA=true ã®ãŸã‚ã€ å®Ÿéš›ã®Repositoryã¯ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"})})]}):e.jsxs(F,{className:"w-full max-w-md",children:[e.jsxs(G,{className:o.padding,children:[e.jsx(H,{className:o.title.size,children:"PROMIDAS Repository"}),e.jsx(te,{className:o.text.size,children:"Repository & Store çŠ¶æ…‹"})]}),e.jsxs(L,{className:`${o.padding} ${o.spacing}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`${o.text.size} font-medium`,children:"Repository"}),e.jsx(Y,{variant:"outline",className:d(a),children:l(a)})]}),t&&e.jsx("p",{className:"text-destructive text-xs",children:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`${o.text.size} font-medium`,children:"Store"}),e.jsx(Y,{variant:"outline",className:m(s),children:g(s)})]}),r&&s!=="not-stored"&&e.jsxs("div",{className:`text-muted-foreground space-y-1 ${o.text.size}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ•°:"}),e.jsxs("span",{className:"font-mono",children:[r.size,"ä»¶"]})]}),r.cachedAt&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ—¥æ™‚:"}),e.jsx("span",{className:"font-mono",children:new Date(r.cachedAt).toLocaleTimeString("ja-JP")})]}),s==="stored"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"æ®‹ã‚Šæ™‚é–“:"}),e.jsx("span",{className:"font-mono",children:p(r.remainingTtlMs)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º:"}),e.jsxs("span",{className:"font-mono",children:[(r.dataSizeBytes/1024).toFixed(1)," KB"]})]})]})]})]})]})}function za({screenSize:a}){const[t,s]=c.useState({type:"not-created"}),[r,n]=c.useState(null),{storeState:i,stats:o}=Ia(),l=!1;return c.useEffect(()=>{const d=()=>{const m=A.getState();s(m),n(m.type==="token-invalid"?m.error:null)};d();const g=setInterval(d,5e3);return()=>clearInterval(g)},[]),e.jsx($a,{repoState:t,repoError:r,storeState:i,storeStats:o,useDummyData:l,screenSize:a})}function qe({screenSize:a}){return e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(Ra,{screenSize:a}),e.jsx(za,{screenSize:a})]})}function Da({open:a,onOpenChange:t,autoCloseOnValid:s=!1,screenSize:r}){return c.useEffect(()=>{if(!a||!s)return;const n=setInterval(()=>{A.getState().type==="created-token-valid"&&t(!1)},500);return()=>clearInterval(n)},[a,s,t]),e.jsx(wa,{open:a,onOpenChange:t,children:e.jsxs(Ke,{className:"max-w-4xl",children:[e.jsxs(Ue,{children:[e.jsx(He,{children:"Setup PROMIDAS Repository"}),e.jsx(We,{children:"Configure your PROMIDAS API token to access prototype data."})]}),e.jsx(qe,{screenSize:r})]})})}function Aa(){const a=()=>{if(typeof window>"u")return"smartphone";const r=window.innerWidth;return r>=1024?"pc":r>=640?"tablet":"smartphone"},[t,s]=c.useState(a);return c.useEffect(()=>{if(typeof window>"u")return;const r=()=>{s(a())};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),t}const Je=c.createContext(void 0);function Ma({children:a}){const t=Aa();return e.jsx(Je.Provider,{value:t,children:a})}function be(){const a=c.useContext(Je);if(a===void 0)throw new Error("useScreenSizeContext must be used within ScreenSizeProvider");return a}const Fa=[["7","8","9","0","u","i","o","p","j","k","l",";","m",",",".","/"],["1","2","3","4","q","w","e","r","a","s","d","f","z","x","c","v"]],La=[["j","k","l",";","m",",",".","/"],["a","s","d","f","z","x","c","v"],["7","8","9","0","u","i","o","p"],["1","2","3","4","q","w","e","r"]];function Ze(a,t=2){return(t>=3?La:Fa)[a]}function _a(a,t,s=2){return Ze(a,s)?.[t]}const ce=[4,8],Oa=8,ge=[4,8,12,16];class V{static async setupSnapshotFromRecipe(t,s){if(!t||!t.apiParams)throw new Error("Invalid recipe: apiParams is required");return b.debug("[INFO] API Params:",t.apiParams),await s.setupSnapshot(t.apiParams)}static createDeck(t){if(!Array.isArray(t))throw new Error("Invalid input: prototypes must be an array");const s=new Map,r=new Set;for(const n of t){if(!n||typeof n.id!="number")throw new Error("Invalid prototype: missing or invalid ID");if(r.has(n.id))throw new Error(`Duplicate prototype ID detected: ${n.id}`);r.add(n.id),s.set(n.id,n)}return s}static createDeckWithFilter(t,s){const r=[...t];if(s!=null){const n=s(r);return b.debug("[DEBUG] createDeckWithFilter - Prototypes count after filtering:",{before:r.length,after:n.length}),this.createDeck(n)}return this.createDeck(r)}static async getPrototypesFromRecipe(t,s){const r=await this.setupSnapshotFromRecipe(t,s);if(!r.ok)throw new Error(`Failed to fetch prototypes from repository: ${r.message}`);const n=await s.getAllFromSnapshot();return b.info(`Retrieved ${n.length} prototypes from snapshot`),n}static getIds(t){return[...t.keys()].sort((s,r)=>s-r)}static getPrototypes(t){return[...t.values()]}static getById(t,s){return t.get(s)}static getByIds(t,s){return s.map(r=>t.get(r)).filter(r=>r!==void 0)}static getSize(t){return t.size}static has(t,s){return t.has(s)}static async sha256(t){const s=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")}static async createIdsHash(t){const r=[...t].sort((n,i)=>n-i).join(",");return await this.sha256(r)}static async createIdentifier(t,s){const r=this.getIds(t),n=`${s}:${r.join(",")}`;return{deckHash:await this.sha256(n)}}static async createMetaData(t,s,r){const n=this.getIds(t),i=await this.sha256(`${s}:${n.join(",")}`),o=await this.sha256(n.join(","));return{deckHash:i,deckIdsHash:o,title:r,fetchedAt:s,prototypeIds:n}}}function Ba(a){const t={ï½¦:"ãƒ²",ï½§:"ã‚¡",ï½¨:"ã‚£",ï½©:"ã‚¥",ï½ª:"ã‚§",ï½«:"ã‚©",ï½¬:"ãƒ£",ï½­:"ãƒ¥",ï½®:"ãƒ§",ï½¯:"ãƒƒ",ï½°:"ãƒ¼",ï½±:"ã‚¢",ï½²:"ã‚¤",ï½³:"ã‚¦",ï½´:"ã‚¨",ï½µ:"ã‚ª",ï½¶:"ã‚«",ï½·:"ã‚­",ï½¸:"ã‚¯",ï½¹:"ã‚±",ï½º:"ã‚³",ï½»:"ã‚µ",ï½¼:"ã‚·",ï½½:"ã‚¹",ï½¾:"ã‚»",ï½¿:"ã‚½",ï¾€:"ã‚¿",ï¾:"ãƒ",ï¾‚:"ãƒ„",ï¾ƒ:"ãƒ†",ï¾„:"ãƒˆ",ï¾…:"ãƒŠ",ï¾†:"ãƒ‹",ï¾‡:"ãƒŒ",ï¾ˆ:"ãƒ",ï¾‰:"ãƒ",ï¾Š:"ãƒ",ï¾‹:"ãƒ’",ï¾Œ:"ãƒ•",ï¾:"ãƒ˜",ï¾:"ãƒ›",ï¾:"ãƒ",ï¾:"ãƒŸ",ï¾‘:"ãƒ ",ï¾’:"ãƒ¡",ï¾“:"ãƒ¢",ï¾”:"ãƒ¤",ï¾•:"ãƒ¦",ï¾–:"ãƒ¨",ï¾—:"ãƒ©",ï¾˜:"ãƒª",ï¾™:"ãƒ«",ï¾š:"ãƒ¬",ï¾›:"ãƒ­",ï¾œ:"ãƒ¯",ï¾:"ãƒ³",ï¾:"ã‚›",ï¾Ÿ:"ã‚œ"},s={ã‚«:"ã‚¬",ã‚­:"ã‚®",ã‚¯:"ã‚°",ã‚±:"ã‚²",ã‚³:"ã‚´",ã‚µ:"ã‚¶",ã‚·:"ã‚¸",ã‚¹:"ã‚º",ã‚»:"ã‚¼",ã‚½:"ã‚¾",ã‚¿:"ãƒ€",ãƒ:"ãƒ‚",ãƒ„:"ãƒ…",ãƒ†:"ãƒ‡",ãƒˆ:"ãƒ‰",ãƒ:"ãƒ",ãƒ’:"ãƒ“",ãƒ•:"ãƒ–",ãƒ˜:"ãƒ™",ãƒ›:"ãƒœ"},r={ãƒ:"ãƒ‘",ãƒ’:"ãƒ”",ãƒ•:"ãƒ—",ãƒ˜:"ãƒš",ãƒ›:"ãƒ"};return a.replace(/[\uFF61-\uFF9F]/g,n=>t[n]||n).replace(/([ã‚«-ã‚³ã‚µ-ã‚½ã‚¿-ãƒˆãƒ-ãƒ›])ã‚›/g,(n,i)=>s[i]||i+"ã‚›").replace(/([ãƒ-ãƒ›])ã‚œ/g,(n,i)=>r[i]||i+"ã‚œ")}function Ga(a){return a.replace(/[\uFF10-\uFF19\uFF21-\uFF3A\uFF41-\uFF5A]/g,t=>String.fromCharCode(t.charCodeAt(0)-65248))}function me(a){return Ba(Ga(a)).toLowerCase()}function Ya(a){const t=new Set(a);return s=>s.filter(r=>{const n=t.has(r.id);return n&&b.debug(`âœ… DeckRecipe id filter matched: ${r.id} - ${r.prototypeNm}`),n})}function N(a){const t=a.map(s=>me(s));return s=>s.filter(r=>{const n=me(r.prototypeNm),i=me(r.summary);let o=t.find(l=>n.includes(l));return o||(o=t.find(l=>i.includes(l))),o&&b.debug(`âœ… DeckRecipe filter matched: "${o}" in ${r.id} - ${r.prototypeNm}`),!!o})}function Ka(a){return t=>t.filter(s=>{if(!s.releaseDate)return!1;const n=new Date(s.releaseDate).getFullYear()===a;return n&&b.debug(`âœ… DeckRecipe releaseDate filter matched: ${a} in ${s.id} - ${s.prototypeNm} (${s.releaseDate})`),n})}const M={offset:0,limit:1e4},Ua={id:"all-prototypes",title:"ğŸŒ å…¨ä½œå“",description:"å…¨ã¦ã®ä½œå“",apiParams:{...M},difficulty:"advanced",tags:[]};Ya([7917,7920,7968,7972]);const Ha={id:"karuta",title:"ğŸ´ ã‹ã‚‹ãŸ",apiParams:{...M},difficulty:"intermediate",tags:["ã‹ã‚‹ãŸ"],description:"ã‹ã‚‹ãŸä½œå“",filter:N(["ã‹ã‚‹ãŸ","ã‚«ãƒ«ã‚¿","æ­Œç•™å¤š","ç™¾äººä¸€é¦–","KARUTA"])},_={apiParams:{...M},difficulty:"intermediate",tags:["å¹²æ”¯"]},Wa={..._,id:"eto-ne",title:"ğŸ å­",description:"ã­ãšã¿ã«ã¡ãªã‚€",filter:N(["ğŸ","ğŸ­","ğŸª¤","ğŸ–±ï¸","å­","é¼ ","ã­ãšã¿","ãƒã‚ºãƒŸ","ãƒãƒ¥ãƒ¼","ãƒãƒ¥ã‚¦","ãƒãƒ ã‚¹ã‚¿ãƒ¼","ãƒ¢ãƒ«ãƒ¢ãƒƒãƒˆ","MOUSE","MICKY"])},Va={..._,id:"eto-ushi",title:"ğŸ„ ä¸‘",description:"ã†ã—ã«ã¡ãªã‚€",filter:N(["ğŸ„","ğŸ®","ä¸‘","ç‰›","ã†ã—","ã‚¦ã‚·","ãƒ¢ãƒ¼","MOW","COW","BULL","OX"])},Xa={..._,id:"eto-tora",title:"ğŸ… å¯…",description:"ã¨ã‚‰ã«ã¡ãªã‚€",filter:N(["ğŸ…","ğŸ¯","å¯…","è™","ã¨ã‚‰","ãƒˆãƒ©","ã‚¿ã‚¤ã‚¬ãƒ¼","TIGER","TORA"])},qa={..._,id:"eto-u",title:"ğŸ‡ å¯",description:"ã†ã•ãã«ã¡ãªã‚€",filter:N(["ğŸ‡","ğŸ°","å¯","å…","å…”","ã†ã•ã","ã‚¦ã‚µã‚®","ã¨ã«ã‹ã","ãƒ©ãƒ“ãƒƒãƒˆ","ãƒ”ãƒ§ãƒ³","ãƒŸãƒƒãƒ•ã‚£ãƒ¼","ãƒãƒ‹ãƒ¼","RABBIT","USAGI","BUNNY"])},Ja={..._,id:"eto-tatsu",title:"ğŸ‰ è¾°",description:"ã‚Šã‚…ã†ã«ã¡ãªã‚€",filter:N(["ğŸ‰","ğŸ²","è¾°","ç«œ","é¾","ãŸã¤","ã‚¿ãƒ„","ã‚Šã‚…ã†","ãƒªãƒ¥ã‚¦","ãƒ‰ãƒ©ã‚´ãƒ³","ç«‹ã¤","DRAGON","RYU","TATSU"])},Za={..._,id:"eto-mi",title:"ğŸ å·³",description:"ã¸ã³ã«ã¡ãªã‚€",filter:N(["ğŸ","å·³","è›‡","ã¸ã³","ãƒ˜ãƒ“","ã‚¹ãƒãƒ¼ã‚¯","ã€œ","SNAKE","HEBI","HEAVY"])},Qa={..._,id:"eto-uma",title:"ğŸ´ åˆ",description:"ã†ã¾ã«ã¡ãªã‚€",filter:N(["ğŸ´","ğŸ ","ğŸ","ğŸª","HORSE","UMA","ã†ã¾","ã‚¦ãƒ","ãƒ›ãƒ¼ã‚¹","åˆ","é¦¬","æ—¨","å®‡æ‘©","ä¸Šæ‰‹","ç¾å‘³"])},es={..._,id:"eto-hitsuji",title:"ğŸ æœª",description:"ã²ã¤ã˜ã«ã¡ãªã‚€",filter:N(["ğŸ","ğŸ‘","æœª","ç¾Š","ã²ã¤ã˜","ãƒ’ãƒ„ã‚¸","ãƒ©ãƒ ","ã‚¸ãƒ³ã‚®ã‚¹ã‚«ãƒ³","ãƒ¡ã‚§","SHEEP","HITSUJI"])},ts={..._,id:"eto-saru",title:"ğŸ’ ç”³",description:"ã•ã‚‹ã«ã¡ãªã‚€",filter:N(["ğŸ’","ğŸµ","ğŸ™ˆ","ğŸ™‰","ğŸ™Š","ğŸ¦","ğŸ¦§","ç”³","çŒ¿","ã•ã‚‹","ã‚µãƒ«","ã‚´ãƒªãƒ©","ãƒ¢ãƒ³ã‚­ãƒ¼","å»ã‚‹","ã†ã","ã‚¦ã‚­","MONKEY","SARU","LEAVE",""])},as={..._,id:"eto-tori",title:"ğŸ“ é…‰",description:"ã¨ã‚Šã«ã¡ãªã‚€",filter:N(["ğŸ“","ğŸ”","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¦","ğŸ§","é…‰","é³¥","é¶","ã¨ã‚Š","ãƒˆãƒª","ãƒ‹ãƒ¯ãƒˆãƒª","ã²ã‚ˆã“","ãƒ’ãƒ¨ã‚³","ã‚³ã‚±ã‚³ãƒƒã‚³ãƒ¼","ãºã‚“ãã‚“","ãƒšãƒ³ã‚®ãƒ³","TORI","BIRD","ROOSTER","CHICKEN"])},ss={..._,id:"eto-inu",title:"ğŸ• æˆŒ",description:"ã„ã¬ã«ã¡ãªã‚€",filter:N(["ğŸ•","ğŸ¶","æˆŒ","çŠ¬","ã„ã¬","ã‚¤ãƒŒ","ãƒ‰ãƒƒã‚°","ã‚ã‚“","ãƒ¯ãƒ³","DOG","INU","ONE","BOW"])},rs={..._,id:"eto-i",title:"ğŸ— äº¥",description:"ã„ã®ã—ã—ã«ã¡ãªã‚€",filter:N(["ğŸ—","ğŸ–","ğŸ·","ğŸ½","äº¥","çŒª","è±š","ã„ã®ã—ã—","ã‚¤ãƒã‚·ã‚·","ã¶ãŸ","ãƒ–ã‚¿","ãƒ–ãƒ¼","ãƒ–ãƒ’","çŒªçª","çŒ›é€²","BOAR","INOSHISHI"])},ns=[Wa,Va,Xa,qa,Ja,Za,Qa,es,ts,as,ss,rs],is=[{id:"new-year",title:"ğŸŠ ãŠæ­£æœˆ",apiParams:{...M},difficulty:"intermediate",tags:["æ­³æ™‚"],description:"ã‚ã‘ãŠã‚",filter:N(["NEW YEAR","æ­£æœˆ","ã—ã‚‡ã†ãŒã¤","ã‚·ãƒ§ã‚¦ã‚¬ãƒ„","å…ƒæ—¥","å…ƒæ—¦","æ–°æ˜¥","åˆè©£","ã¯ã¤ã‚‚ã†ã§","ãƒãƒ„ãƒ¢ã‚¦ãƒ‡","åˆæ—¥ã®å‡º","ãŠã›ã¡","ã‚ªã‚»ãƒ","å¹´è³€","å¹´ç‰","ã¨ã—ã ã¾","ãƒˆã‚·ãƒ€ãƒ","å‡§","ãŸã“","ã‚¿ã‚³","ç¾½æ ¹ã¤ã","ã¯ã­ã¤ã","ãƒãƒãƒ„ã‚­","ã“ã¾å›ã—","ã“ã¾ã¾ã‚ã—","ã‚³ãƒå›ã—","ã‚³ãƒãƒãƒ¯ã‚·","é–€æ¾","é¡é¤…","ç¦ç¬‘ã„","ãµãã‚ã‚‰ã„","ç¥ç¤¾","ã˜ã‚“ã˜ã‚ƒ","ã‚¸ãƒ³ã‚¸ãƒ£","ğŸ—»","ğŸ¦…","ğŸ†","ğŸŒ…","ğŸŒ„","â›©ï¸","â›©","ğŸŠ"])},{id:"setsubun",title:"ğŸ‘¹ ç¯€åˆ†",apiParams:{...M},difficulty:"intermediate",tags:["æ­³æ™‚"],description:"é¬¼ã¯å¤– ç¦ã¯å†…",filter:N(["SETUBUN","ç¯€åˆ†","è±†","ã¾ã‚","ãƒãƒ¡","é¬¼","ãŠã«","ã‚ªãƒ‹","ç¦","ãµã","ãƒ•ã‚¯","ğŸ€","ğŸ§§","ğŸ§Œ","ğŸ‘¹","ğŸ˜ˆ"])},{id:"valentines-day",title:"ğŸ« ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³ãƒ‡ãƒ¼",apiParams:{...M},difficulty:"intermediate",tags:["æ­³æ™‚"],description:"ãƒãƒ§ã‚³ã‚ˆã‚Šã‹ã‚‹ãŸ",filter:N(["VALENTINE","ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³","ã°ã‚Œã‚“ãŸã„ã‚“","ğŸ«","â¤ï¸","ğŸ’","ã¡ã‚‡ã“","ãƒãƒ§ã‚³"])},{title:"ğŸ‹ ä¸ƒå¤•",id:"tanabata",apiParams:{...M},difficulty:"intermediate",tags:["æ­³æ™‚"],description:"ç¹”å§«ã¨å½¦æ˜Ÿã®é€¢ç€¬",filter:N(["TANABATA","ä¸ƒå¤•","ãŸãªã°ãŸ","ã‚¿ãƒŠãƒã‚¿","æ£šã¼ãŸ","ãŸãªã¼ãŸ","ã‚¿ãƒŠãƒœã‚¿","çŸ­å†Š","ãŸã‚“ã–ã","ã‚¿ãƒ³ã‚¶ã‚¯","ç¬¹","ã•ã•","ã‚µã‚µ","ç«¹","ãŸã‘","ã‚¿ã‚±","â­","ğŸŒ ","ğŸ‹"])},{id:"respect-for-the-aged-day",title:"ğŸª© æ•¬è€ã®æ—¥",apiParams:{...M},difficulty:"intermediate",tags:["æ­³æ™‚"],description:"äº€ã®ç”²ã‚ˆã‚Šå¹´ã®åŠŸ",filter:N(["RESPECT FOR THE AGED DAY","æ•¬è€","ã‘ã„ã‚ã†","ã‚±ã‚¤ãƒ­ã‚¦","å¹´å¯„ã‚Š","ã¨ã—ã‚ˆã‚Š","ãƒˆã‚·ãƒ¨ãƒª","è€äºº","ã‚ã†ã˜ã‚“","ãƒ­ã‚¦ã‚¸ãƒ³","ã‚·ãƒ«ãƒãƒ¼","ã—ã‚‹ã°ãƒ¼","çˆº","ã˜ã„ã•ã‚“","ã˜ã„ã¡ã‚ƒã‚“","å©†","ã°ã‚ã•ã‚“","ã°ã‚ã¡ã‚ƒã‚“","ğŸ‘µğŸ¼","ğŸ‘´","ğŸ§“ğŸ»","ğŸ¢"])},{id:"halloween",title:"ğŸƒ ãƒãƒ­ã‚¦ã‚£ãƒ³",apiParams:{...M},difficulty:"intermediate",tags:["æ­³æ™‚"],description:"ğŸ§™ğŸ§ŸğŸ‘»ğŸ’€",filter:N(["HALLOWEEN","ãƒãƒ­ã‚¦ã‚£ãƒ³","ã¯ã‚ã†ãƒã‚“","ğŸ‘»","ğŸ’€","ğŸƒ","ãŠã°ã‘","ã‚ªãƒã‚±","ã‚´ãƒ¼ã‚¹ãƒˆ","é­”å¥³","ã‹ã¼ã¡ã‚ƒ","ã‚«ãƒœãƒãƒ£","ãƒ‘ãƒ³ãƒ—ã‚­ãƒ³","ã‚¾ãƒ³ãƒ“","ãã‚“ã³","ğŸ§Ÿ","ğŸ§Ÿâ€â™‚ï¸","ğŸ§Ÿâ€â™€ï¸","ğŸ§™","ğŸ§™â€â™€ï¸"])},{title:"ğŸ–ï¸ ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚ºãƒ»ãƒªãƒ¼ã‚°",id:"heroes-league",apiParams:{...M},difficulty:"intermediate",tags:["æ­³æ™‚"],description:"ğŸ¦¸â€â™‚ï¸ğŸ¦¸â€â™€ï¸ğŸ¦¹â€â™‚ï¸ğŸ¦¹â€â™€ï¸",filter:N(["HEROES LEAGUE","HL","ãƒ’ãƒ¼ãƒ­ãƒ¼","ã²ãƒ¼ã‚ãƒ¼","ğŸ¦¸","ğŸ¦¸â€â™€ï¸","ğŸ¦¸â€â™‚ï¸","ğŸ¦¹","ğŸ¦¹â€â™€ï¸","ğŸ¦¹â€â™‚ï¸"])},{id:"christmas",title:"ğŸ„ ã‚¯ãƒªã‚¹ãƒã‚¹",apiParams:{...M},difficulty:"intermediate",tags:["æ­³æ™‚"],description:"ğŸª…ğŸ„ğŸ¦ŒğŸ›·ğŸ…ğŸ",filter:N(["CHRISTMAS","XMAS","X'mas","ã‚¯ãƒªã‚¹ãƒã‚¹","ãã‚Šã™ã¾ã™","ğŸ","ğŸ„","ğŸª…","ğŸ…","ğŸ¤¶ğŸ¼","ğŸ§‘ğŸ½â€ğŸ„","ğŸ¦Œ","ğŸ›·"])}];function os(a,t=1e3){const s=[];for(let r=1;r<=a;r++){const n=(r-1)*t,i=n+1,o=n+t;s.push({id:`Deck-rande-${r}`,title:`Deck-${r}`,description:`${i.toLocaleString()} - ${o.toLocaleString()}`,apiParams:{offset:n,limit:t},difficulty:"beginner",tags:[]})}return s}function ls(a){return a.map(t=>({id:`rel-${t}`,title:`ğŸ‰ ${t}`,description:`${t}å¹´ç”Ÿ`,apiParams:{...M},difficulty:"intermediate",tags:["ãƒªãƒªãƒ¼ã‚¹"],filter:Ka(t)}))}class Qe{static rangeRecipes=os(7);static releaseYearRecipes=ls([2027,2026,2025,2024,2023,2022,2021,2020,2019,2018,2017,2016,2015,2014]);static RECIPES=[...ns,...is,Ha,...this.releaseYearRecipes,Ua,...this.rangeRecipes];static findById(t){return this.RECIPES.find(s=>s.id===t)}static getAll(){return[...this.RECIPES]}static filterByDifficulty(t){return this.RECIPES.filter(s=>s.difficulty===t)}static filterByTag(t){return this.RECIPES.filter(s=>s.tags.includes(t))}}class pe{static RECIPES=[{id:"standard-10",title:"10",description:"10çµ„ã®æœ­",tags:[],difficulty:"beginner",sortMethod:"random",maxSize:10},{id:"standard-20",title:"20",description:"20çµ„ã®æœ­",tags:[],difficulty:"beginner",sortMethod:"random",maxSize:20},{id:"standard-30",title:"30",description:"30çµ„ã®æœ­",tags:[],difficulty:"beginner",sortMethod:"random",maxSize:30},{id:"all-random",title:"ALL",description:"å…¨ã¦ã®æœ­",tags:[],difficulty:"advanced",sortMethod:"random",maxSize:"all"}];static findById(t){return this.RECIPES.find(s=>s.id===t)}static getAll(){return[...this.RECIPES]}static filterByDifficulty(t){return this.RECIPES.filter(s=>s.difficulty===t)}static filterByTag(t){return this.RECIPES.filter(s=>s.tags.includes(t))}}class ue{static generate(t,s){const r=Array.from(t.keys());let n;switch(s.sortMethod){case"random":n=this.shuffle(r);break;case"id-asc":n=[...r].sort((o,l)=>o-l);break;case"id-desc":n=[...r].sort((o,l)=>l-o);break;default:throw new Error(`Unknown sortMethod: ${s.sortMethod}`)}if(s.maxSize==="all")return n;if(typeof s.maxSize!="number"||s.maxSize<=0)throw new Error('maxSize must be positive number or "all"');const i=Math.min(s.maxSize,n.length);return n.slice(0,i)}static shuffle(t){const s=[...t];for(let r=s.length-1;r>0;r--){const n=Math.floor(Math.random()*(r+1));[s[r],s[n]]=[s[n],s[r]]}return s}static getSize(t){return t.length}static isEmpty(t){return t.length===0}static pop(t,s){if(s<=0)return{popped:[],remaining:t};const r=Math.min(s,t.length);return{popped:t.slice(0,r),remaining:t.slice(r)}}}const ds=pe.RECIPES;class E{static STORAGE_KEY="PP_KARUTA_PLAYERS";static storage=null;static MAX_PLAYERS=50;static getStorage(){return this.storage||(this.storage=sa.forLocalStorage(this.STORAGE_KEY)),this.storage}static createPlayers(t){if(typeof t!="number"||t<1||t>this.MAX_PLAYERS)throw new Error(`Player count must be between 1 and ${this.MAX_PLAYERS}`);return Array.from({length:t},(s,r)=>this.createPlayer(`player-${r+1}`,`Player ${r+1}`))}static createPlayer(t,s){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Player id must be a non-empty string");if(!s||typeof s!="string"||s.trim()==="")throw new Error("Player name must be a non-empty string");return{id:t.trim(),name:s.trim()}}static validatePlayersForGame(t,s){if(!Array.isArray(t))throw new Error("Players must be an array");if(t.length===0)throw new Error("Players array must not be empty");if(t.length>s)throw new Error(`Maximum ${s} players allowed in a game`);const r=new Set;for(const n of t){if(!n||typeof n!="object")throw new Error("Each player must be an object");if(!n.id||typeof n.id!="string")throw new Error("Each player must have a valid id");if(r.has(n.id))throw new Error(`Duplicate player id: ${n.id}`);r.add(n.id)}}static validatePlayers(t){if(!Array.isArray(t))throw new Error("Players must be an array");if(t.length===0)throw new Error("Players array must not be empty");if(t.length>this.MAX_PLAYERS)throw new Error(`Maximum ${this.MAX_PLAYERS} players allowed`);const s=new Set;for(const r of t){if(!r||typeof r!="object")throw new Error("Each player must be an object");if(!r.id||typeof r.id!="string")throw new Error("Each player must have a valid id");if(s.has(r.id))throw new Error(`Duplicate player id: ${r.id}`);s.add(r.id)}}static async savePlayers(t){this.validatePlayers(t),await this.getStorage().save(JSON.stringify(t))}static async loadPlayers(){const s=await this.getStorage().get();if(!s)return null;try{const r=JSON.parse(s);return this.validatePlayers(r),r}catch(r){throw new Error(`Failed to load players from storage: ${r instanceof Error?r.message:"Unknown error"}`)}}static async hasPlayers(){return await this.getStorage().has()}static async removePlayers(){await this.getStorage().remove()}static async initialize(){const t=await this.loadPlayers();if(t&&t.length>0)return t;const s=this.createPlayers(1);return await this.savePlayers(s),s}}class cs{static PLAY_MODES=["keyboard","touch"];static DEFAULT_PLAY_MODE="keyboard";static isValidPlayMode(t){return typeof t=="string"&&this.PLAY_MODES.includes(t)}static validatePlayMode(t){if(!this.isValidPlayMode(t))throw new Error(`Invalid PlayMode: ${t}. Must be one of: ${this.PLAY_MODES.join(", ")}`)}static getDisplayInfo(t){switch(t){case"keyboard":return{title:"Keyboard",description:"ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼ã§æ“ä½œã—ã¾ã™ã€‚å…±é€šã®Tatamiã‚¨ãƒªã‚¢ã‚’ä½¿ç”¨ã—ã€å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å°‚ç”¨ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’å‰²ã‚Šå½“ã¦ã¾ã™ã€‚",targetDevice:"PCç’°å¢ƒå‘ã‘"};case"touch":return{title:"Touch",description:"ã‚¿ãƒƒãƒ—ã§æ“ä½œã—ã¾ã™ã€‚å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å°‚ç”¨ã®Tatamiã‚¨ãƒªã‚¢ã‚’è¡¨ç¤ºã—ã€è‡ªåˆ†ã®ã‚¨ãƒªã‚¢ã®ã¿ã‚¿ãƒƒãƒ—å¯èƒ½ã§ã™ã€‚",targetDevice:"ãƒ¢ãƒã‚¤ãƒ«/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå‘ã‘"}}}static requiresSeparateTatami(t){return t==="touch"}static getRecommendedPlayMode(){return"ontouchstart"in window||navigator.maxTouchPoints>0?"touch":"keyboard"}}class B{static MAX_GAME_PLAYERS=4;static createInitialState(t,s,r,n,i=5){if(t.size===0)throw new Error("Deck must not be empty");E.validatePlayersForGame(s,this.MAX_GAME_PLAYERS),cs.validatePlayMode(r);const o=ue.generate(t,n),l=o.length,d=Math.min(i,o.length),g=o.slice(0,d),m=o.slice(d),p=s.map(x=>({player:x,tatami:[...g],mochiFuda:[],score:0}));return{deck:t,stack:m,tatami:g,playerStates:p,totalRaces:l}}static isGameOver(t){return t.tatami.length===0}static pickYomiFuda(t){if(t.length===0)return null;{const s=Math.floor(Math.random()*t.length);return t[s]}}static processCorrectAnswer(t,s,r){const n=t.stack.length>0?t.stack[0]:void 0,i=t.stack.slice(1),o=t.playerStates.map(d=>{const g=d.tatami.filter(m=>m!==r);return n!==void 0&&g.push(n),d.player.id===s?{...d,tatami:g,mochiFuda:[...d.mochiFuda,r],score:d.score+1}:{...d,tatami:g}}),l=t.tatami.filter(d=>d!==r);return n!==void 0&&l.push(n),{...t,tatami:l,stack:i,playerStates:o}}static processIncorrectAnswer(t,s){const r=t.playerStates.map(n=>n.player.id!==s?n:{...n,score:Math.max(0,n.score-1)});return{...t,playerStates:r}}}const ae=pt({component:gs});function gs(){return e.jsx(na,{defaultTheme:"system",storageKey:"pp-karuta-theme",children:e.jsx(Ma,{children:e.jsx(ms,{})})})}function ms(){const a=be(),[t,s]=c.useState(()=>A.getState()),[r,n]=c.useState(!1);c.useEffect(()=>{const o=setInterval(()=>{s(A.getState())},1e3);return()=>clearInterval(o)},[]),c.useEffect(()=>{E.initialize().catch(o=>{b.error("Failed to initialize players:",o)})},[]);const i=k(a,{smartphone:{headerPadding:"pt-10",contentHeight:"h-[calc(100vh-2.5rem)]"},tablet:{headerPadding:"pt-12",contentHeight:"h-[calc(100vh-3rem)]"},pc:{headerPadding:"pt-14",contentHeight:"h-[calc(100vh-3.5rem)]"},responsive:{headerPadding:"pt-12 md:pt-14 lg:pt-16",contentHeight:"h-[calc(100vh-3rem)] md:h-[calc(100vh-3.5rem)] lg:h-[calc(100vh-4rem)]"}});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 left-0 z-50",children:e.jsx(va,{repoState:t,onRepoIndicatorClick:()=>n(!0),screenSize:a})}),e.jsx("div",{className:i.headerPadding}),e.jsxs("div",{className:i.contentHeight,children:[e.jsx(Da,{open:r,onOpenChange:()=>n(!1),autoCloseOnValid:!1,screenSize:a}),e.jsx(ut,{})]}),!1]})}const ps=fe("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),se=c.forwardRef(({className:a,variant:t,...s},r)=>e.jsx("div",{ref:r,role:"alert",className:S(ps({variant:t}),a),...s}));se.displayName="Alert";const us=c.forwardRef(({className:a,...t},s)=>e.jsx("h5",{ref:s,className:S("mb-1 leading-none font-medium tracking-tight",a),...t}));us.displayName="AlertTitle";const re=c.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:S("text-sm [&_p]:leading-relaxed",a),...t}));re.displayName="AlertDescription";function xs({players:a,isLoading:t,error:s,onAddPlayer:r,onUpdatePlayer:n,onDeletePlayer:i}){return t?e.jsx("div",{className:"container mx-auto max-w-2xl p-4",children:e.jsxs(F,{children:[e.jsx(G,{children:e.jsx(H,{children:"ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†"})}),e.jsx(L,{children:e.jsx("p",{children:"èª­ã¿è¾¼ã¿ä¸­..."})})]})}):e.jsx("div",{className:"container mx-auto max-w-2xl p-4",children:e.jsxs(F,{children:[e.jsx(G,{children:e.jsx(H,{children:"ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†"})}),e.jsxs(L,{children:[s&&e.jsx(se,{variant:"destructive",className:"mb-4",children:e.jsx(re,{children:s})}),e.jsx("div",{className:"space-y-4",children:a.map(o=>e.jsx(hs,{player:o,onUpdate:n,onDelete:i,canDelete:a.length>1},o.id))}),e.jsxs("div",{className:"mt-4",children:[e.jsx(P,{onClick:r,disabled:a.length>=E.MAX_PLAYERS,className:"w-full",children:"+ ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ "}),a.length>=E.MAX_PLAYERS&&e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-500",children:["æœ€å¤§",E.MAX_PLAYERS,"äººã¾ã§ç™»éŒ²ã§ãã¾ã™"]})]})]})]})})}function hs({player:a,onUpdate:t,onDelete:s,canDelete:r}){const[n,i]=c.useState(!1),[o,l]=c.useState(a.name),d=()=>{o.trim()&&(t(a.id,o),i(!1))},g=()=>{l(a.name),i(!1)};return e.jsx("div",{className:"flex items-center gap-2 rounded border p-3",children:n?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:o,onChange:m=>l(m.target.value),className:"flex-1 rounded border px-2 py-1 dark:bg-gray-800",autoFocus:!0,placeholder:"ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å","aria-label":"ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å",onKeyDown:m=>{m.key==="Enter"&&d(),m.key==="Escape"&&g()}}),e.jsx(P,{size:"sm",onClick:d,children:"ä¿å­˜"}),e.jsx(P,{size:"sm",variant:"outline",onClick:g,children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex-1 font-medium",children:a.name}),e.jsx(P,{size:"sm",variant:"outline",onClick:()=>i(!0),children:"ç·¨é›†"}),e.jsx(P,{size:"sm",variant:"destructive",onClick:()=>s(a.id),disabled:!r,children:"å‰Šé™¤"})]})})}function fs(){const[a,t]=c.useState([]),[s,r]=c.useState(!0),[n,i]=c.useState(null);c.useEffect(()=>{o()},[]);const o=async()=>{try{r(!0),i(null);const m=await E.initialize();t(m)}catch(m){const p=m instanceof Error?m.message:"Failed to load players";i(p),b.error("Failed to load players:",m)}finally{r(!1)}},l=c.useCallback(()=>{if(a.length>=E.MAX_PLAYERS){i(`Maximum ${E.MAX_PLAYERS} players allowed`);return}const m=`player-${Date.now()}`,p=E.createPlayer(m,`Player ${a.length+1}`),x=[...a,p];t(x),E.savePlayers(x).catch(u=>{b.error("Failed to save players:",u),i("Failed to save players")})},[a]),d=c.useCallback((m,p)=>{const x=a.map(u=>u.id===m?{...u,name:p.trim()}:u);t(x),E.savePlayers(x).catch(u=>{b.error("Failed to save players:",u),i("Failed to save players")})},[a]),g=c.useCallback(m=>{if(a.length<=1){i("At least one player must exist");return}const p=a.filter(x=>x.id!==m);t(p),E.savePlayers(p).catch(x=>{b.error("Failed to save players:",x),i("Failed to save players")})},[a]);return e.jsx(xs,{players:a,isLoading:s,error:n,onAddPlayer:l,onUpdatePlayer:d,onDeletePlayer:g})}const ys=he("/player")({component:bs});function bs(){return e.jsx(fs,{})}function vs({onBack:a}){const[t,s]=c.useState("");return c.useEffect(()=>(document.body.classList.add("pp-karuta-intro-theme"),()=>{document.body.classList.remove("pp-karuta-intro-theme")}),[]),c.useEffect(()=>{fetch("/pp-karuta//data/INTRO.txt").then(n=>n.text()).then(n=>{const i=n.replace(/^---[\s\S]*?---\n\n/,"");s(i)}).catch(n=>{b.error("Failed to load INTRO.txt:",n),s("# Error loading INTRO.txt")})},[]),e.jsxs("div",{className:"intro-page",children:[e.jsx("div",{className:"protopedia-readme",children:e.jsx(Gt,{remarkPlugins:[Yt],children:t})}),e.jsx("button",{onClick:a,className:"back-button",children:"ã€ å¸°é‚„ ã€‘"})]})}const ws=he("/intro")({component:js});function js(){const a=xe(),t=()=>{a({to:"/"})};return e.jsx(vs,{onBack:t})}function ks(a,t){return a.type!==t.type?!1:a.type==="token-invalid"&&t.type==="token-invalid"?a.error===t.error:a.type==="created-token-valid"&&t.type==="created-token-valid"?a.repository===t.repository:!0}function et(a=1e3){const[t,s]=c.useState(A.getState());return c.useEffect(()=>{const r=setInterval(()=>{const n=A.getState();s(i=>ks(i,n)?i:n)},a);return()=>clearInterval(r)},[a]),t}function Ss({recipe:a,onSelect:t,isSelected:s=!1,isLoading:r=!1,isLoadingThisRecipe:n=!1,screenSize:i,showTags:o=!1}){const l=ye(s),d=k(i,{smartphone:{padding:"p-2",title:{size:"text-base"},description:{size:"text-xs"},label:{size:"text-xs"},content:{size:"text-xs"}},tablet:{padding:"p-3",title:{size:"text-lg"},description:{size:"text-sm"},label:{size:"text-sm"},content:{size:"text-sm"}},pc:{padding:"p-4",title:{size:"text-xl"},description:{size:"text-sm"},label:{size:"text-sm"},content:{size:"text-sm"}},responsive:{padding:"p-4 md:p-6 lg:p-8",title:{size:"text-lg md:text-xl lg:text-2xl"},description:{size:"text-xs md:text-sm"},label:{size:"text-xs md:text-sm"},content:{size:"text-xs md:text-sm"}}});return e.jsxs(P,{onClick:()=>t(a),disabled:r,variant:s?"default":"outline",className:`group relative h-full overflow-hidden rounded-lg shadow-lg ${l.animation} disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:scale-100 ${d.padding} ${l.base}`,children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/90 dark:bg-gray-800/90",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-4 border-indigo-500 border-t-transparent"}),e.jsx("span",{className:"text-sm font-semibold text-indigo-600 dark:text-indigo-400",children:"Loading..."})]})}),e.jsx("div",{className:l.gradient}),e.jsxs("div",{className:"relative",children:[e.jsx("h2",{className:`font-bold wrap-break-word whitespace-normal ${d.title.size} ${l.title}`,children:a.title}),a.description&&e.jsx("p",{className:`wrap-break-word whitespace-normal ${d.description.size} ${l.description}`,children:a.description}),!1,o&&e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:a.tags.map(g=>e.jsx(Y,{variant:"secondary",className:s?"bg-white/20 text-white hover:bg-white/30":"",children:g},g))})]})]})}function ke({deck:a,showDetails:t=!1}){const s=Array.from(a.values()).slice(0,30);return e.jsx(se,{className:"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950",children:e.jsxs(re,{className:"text-green-800 dark:text-green-200",children:[e.jsxs("div",{className:"mb-0 font-semibold",children:["âœ“ ãƒ‡ãƒƒã‚­: ",a.size.toLocaleString()," çµ„"]}),t&&s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.map(r=>e.jsxs(Y,{variant:"outline",className:"bg-white text-xs dark:bg-gray-900",children:[e.jsx("span",{className:"text-muted-foreground font-mono",children:r.id}),e.jsx("span",{className:"text-foreground ml-1",children:r.prototypeNm})]},r.id))}),t&&a.size>30&&e.jsxs("div",{className:"text-muted-foreground mt-2 text-xs",children:["ä»– ",(a.size-30).toLocaleString()," ä»¶"]})]})})}const Ns=Kt,Ps=Ut,Cs=Ht;function Es({deckRecipes:a,selectedDeckRecipe:t,onSelectDeckRecipe:s,isDeckLoading:r,loadingDeckRecipeId:n,generatedDeck:i,screenSize:o,enableGrouping:l=!0,initialOpenCategories:d}){const g=l?a.reduce((h,f)=>((f.tags.length>0?f.tags:["æœªåˆ†é¡"]).forEach(R=>{h[R]||(h[R]=[]),h[R].push(f)}),h),{}):null,[m,p]=c.useState(()=>g?Object.keys(g).reduce((h,f)=>(h[f]=d?.includes(f)??!1,h),{}):{}),x=h=>{p(f=>({...f,[h]:!f[h]}))},u=k(o,{smartphone:{gridCols:"grid-cols-3",gap:"gap-2",trigger:{padding:"px-2 py-1"},title:{size:"text-sm"},icon:{size:"h-4 w-4"},spacing:"space-y-1",contentPadding:"pt-1"},tablet:{gridCols:"grid-cols-4",gap:"gap-3",trigger:{padding:"px-3 py-2"},title:{size:"text-sm"},icon:{size:"h-4 w-4"},spacing:"space-y-2",contentPadding:"pt-2"},pc:{gridCols:"grid-cols-6",gap:"gap-4",trigger:{padding:"px-4 py-2"},title:{size:"text-base"},icon:{size:"h-6 w-6"},spacing:"space-y-4",contentPadding:"py-4"},responsive:{gridCols:"grid-cols-3 md:grid-cols-4 lg:grid-cols-6",gap:"gap-2 md:gap-3 lg:gap-4",trigger:{padding:"px-4 py-2.5"},title:{size:"text-base"},icon:{size:"h-4 w-4"},spacing:"space-y-3",contentPadding:"pt-4"}}),y=h=>e.jsx("div",{className:`grid ${u.gap} ${u.gridCols}`,children:h.map(f=>e.jsx(Ss,{recipe:f,onSelect:s,isSelected:t?.id===f.id,isLoading:r,isLoadingThisRecipe:n===f.id,screenSize:o},f.id))});return e.jsxs(e.Fragment,{children:[i&&e.jsx(ke,{deck:i,showDetails:!1}),l&&g?e.jsx("div",{className:u.spacing,children:Object.entries(g).map(([h,f])=>e.jsxs(Ns,{open:m[h],onOpenChange:()=>x(h),children:[e.jsxs(Ps,{className:`border-border bg-background/50 hover:bg-accent hover:border-accent-foreground/20 flex w-full items-center justify-between rounded-md border transition-all ${u.trigger.padding}`,children:[e.jsx("h3",{className:`font-semibold ${u.title.size}`,children:h}),e.jsx(Wt,{className:`text-muted-foreground transition-transform duration-200 ${u.icon.size} ${m[h]?"rotate-180":""}`})]}),e.jsx(Cs,{className:u.contentPadding,children:y(f)})]},h))}):y(a),i&&e.jsx(ke,{deck:i,showDetails:!1})]})}function Rs({selectedPlayMode:a,selectedDeckRecipe:t,generatedDeck:s,selectedStackRecipe:r,stackSize:n,selectedPlayerCount:i,screenSize:o}){const l=k(o,{smartphone:{gridCols:"grid-cols-2",gap:"gap-2",padding:"p-2",title:{size:"text-base",margin:"mb-2"},text:{size:"text-sm"}},tablet:{gridCols:"grid-cols-4",gap:"gap-3",padding:"p-3",title:{size:"text-lg",margin:"mb-2"},text:{size:"text-base"}},pc:{gridCols:"grid-cols-4",gap:"gap-4",padding:"p-4",title:{size:"text-xl",margin:"mb-2"},text:{size:"text-xl"}},responsive:{gridCols:"grid-cols-2 md:grid-cols-4",gap:"gap-2 md:gap-3 lg:gap-4",padding:"p-3 md:p-4 lg:p-6",title:{size:"text-base md:text-lg lg:text-xl",margin:"mb-3 md:mb-4"},text:{size:"text-sm md:text-base lg:text-xl"}}});return e.jsxs("div",{className:`rounded-lg border-2 border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 ${l.padding}`,children:[e.jsx("h3",{className:`${l.title.margin} ${l.title.size} font-bold text-gray-900 dark:text-gray-100`,children:"ğŸ“‹ è¨­å®š"}),e.jsxs("div",{className:`grid ${l.gap} ${l.gridCols}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${l.text.size} font-semibold text-gray-700 dark:text-gray-300`,children:"å…¥åŠ›æ–¹å¼:"}),e.jsx("span",{className:`${l.text.size} text-gray-900 dark:text-gray-100`,children:a==="keyboard"?"âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰":a==="touch"?"ğŸ“± ã‚¿ãƒƒãƒ":e.jsx("span",{className:"text-destructive",children:"æœªé¸æŠ"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${l.text.size} font-semibold text-gray-700 dark:text-gray-300`,children:"å‚åŠ è€…:"}),e.jsx("span",{className:`${l.text.size} text-gray-900 dark:text-gray-100`,children:i>0?`${i} äºº`:e.jsx("span",{className:"text-destructive",children:"æœªé¸æŠ"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${l.text.size} font-semibold text-gray-700 dark:text-gray-300`,children:"ãƒ‡ãƒƒã‚­:"}),e.jsx("span",{className:`${l.text.size} text-gray-900 dark:text-gray-100`,children:t?e.jsxs(e.Fragment,{children:[t.title,s&&e.jsxs("span",{className:"ml-1 text-xs text-gray-600 dark:text-gray-400",children:["(",s.size.toLocaleString()," çµ„)"]})]}):e.jsx("span",{className:"text-destructive",children:"æœªé¸æŠ"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${l.text.size} font-semibold text-gray-700 dark:text-gray-300`,children:"æœ­æ•°:"}),e.jsx("span",{className:`${l.text.size} text-gray-900 dark:text-gray-100`,children:r?e.jsxs(e.Fragment,{children:[r.title,n!==null&&e.jsxs("span",{className:"ml-1 text-xs text-gray-600 dark:text-gray-400",children:["(",n.toLocaleString()," çµ„)"]})]}):e.jsx("span",{className:"text-destructive",children:"æœªé¸æŠ"})})]})]})]})}function X({isSelected:a,onClick:t,disabled:s=!1,icon:r,label:n,className:i="",alignment:o="center",screenSize:l}){const d=ye(a),g=k(l,{smartphone:{padding:"p-2",gap:"gap-2",iconContainerSize:"h-6 w-6",iconSize:"h-4 w-4",textSize:"text-sm"},tablet:{padding:"p-2",gap:"gap-2",iconContainerSize:"h-8 w-8",iconSize:"h-5 w-5",textSize:"text-base"},pc:{padding:"p-2",gap:"gap-2",iconContainerSize:"h-10 w-10",iconSize:"h-6 w-6",textSize:"text-xl"},responsive:{padding:"p-2 md:p-4",gap:"gap-2 md:gap-3",iconContainerSize:"h-8 w-8 md:h-12 md:w-12",iconSize:"h-5 w-5 md:h-8 md:w-8",textSize:"text-sm md:text-base lg:text-xl"}});return e.jsxs("div",{onClick:s?void 0:t,className:`group relative flex h-full w-full flex-col justify-center overflow-hidden rounded-lg shadow-md ${d.animation} ${g.padding} ${s?"cursor-not-allowed opacity-50":"cursor-pointer"} ${d.base} ${i}`,children:[e.jsx("div",{className:d.gradient}),e.jsxs("div",{className:`relative flex items-center ${g.gap} ${o==="start"?"justify-start":"justify-center"}`,children:[r&&e.jsx("div",{className:`flex shrink-0 items-center justify-center rounded-full ${g.iconContainerSize} ${d.iconBg}`,children:je.isValidElement(r)?je.cloneElement(r,{className:S(r.props.className,g.iconSize)}):r}),e.jsx("div",{className:`flex items-center font-semibold ${g.textSize} ${o==="start"?"w-full flex-1 text-left":"text-center"} ${d.title}`,children:n})]})]})}function Is({selectedPlayMode:a,onSelectPlayMode:t,isLoading:s,screenSize:r}){const n=k(r,{smartphone:{gridCols:"grid-cols-2",gap:"gap-2"},tablet:{gridCols:"grid-cols-2",gap:"gap-3"},pc:{gridCols:"grid-cols-2",gap:"gap-4"},responsive:{gridCols:"grid-cols-2",gap:"gap-2 md:gap-3 lg:gap-4"}});return e.jsxs("div",{className:`grid ${n.gap} ${n.gridCols}`,children:[e.jsx(X,{isSelected:a==="touch",onClick:()=>t("touch"),disabled:s,icon:e.jsx(Vt,{className:"h-6 w-6"}),label:"ã‚¿ãƒƒãƒ",alignment:"center",screenSize:r}),e.jsx(X,{isSelected:a==="keyboard",onClick:()=>t("keyboard"),disabled:s,icon:e.jsx(Xt,{className:"h-6 w-6"}),label:"ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰",alignment:"center",screenSize:r})]})}function Ts({availablePlayers:a,selectedPlayerIds:t,onTogglePlayer:s,onAddPlayer:r,isLoading:n,screenSize:i}){const o=k(i,{smartphone:{gridCols:"grid-cols-2",gap:"gap-2"},tablet:{gridCols:"grid-cols-3",gap:"gap-3"},pc:{gridCols:"grid-cols-4",gap:"gap-4"},responsive:{gridCols:"grid-cols-2 md:grid-cols-3 lg:grid-cols-4",gap:"gap-2 md:gap-3 lg:gap-4"}});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`grid ${o.gap} ${o.gridCols}`,children:[a.map(l=>{const d=t.includes(l.id),g=t.length>=B.MAX_GAME_PLAYERS;return e.jsx(X,{isSelected:d,onClick:()=>s(l.id),disabled:n||!d&&g,icon:e.jsx(Oe,{}),label:l.name,alignment:"start",screenSize:i},l.id)}),e.jsx(X,{isSelected:!1,onClick:r,disabled:n||t.length>=B.MAX_GAME_PLAYERS,icon:e.jsx(qt,{}),label:"",className:"bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700",alignment:"center",screenSize:i})]}),t.length>=B.MAX_GAME_PLAYERS&&e.jsxs("p",{className:"text-muted-foreground text-center text-sm",children:["ã‚²ãƒ¼ãƒ ã«å‚åŠ ã§ãã‚‹ã®ã¯æœ€å¤§",B.MAX_GAME_PLAYERS,"äººã¾ã§ã§ã™"]})]})}const $s={primary:"text-indigo-600 dark:text-indigo-400",secondary:"text-gray-600 dark:text-gray-400",success:"text-green-600 dark:text-green-400",warning:"text-orange-600 dark:text-orange-400",danger:"text-red-600 dark:text-red-400"};function W({title:a,variant:t="primary",children:s,className:r="",screenSize:n}){const i=k(n,{smartphone:{titleSize:"text-xs",padding:"p-2 pt-2",titlePosition:"-top-2.5 left-3 px-2",spacing:"space-y-2"},tablet:{titleSize:"text-sm",padding:"p-3 pt-3",titlePosition:"-top-3 left-4 px-2",spacing:"space-y-3"},pc:{titleSize:"text-base",padding:"p-4 pt-4",titlePosition:"-top-3.5 left-4 px-2",spacing:"space-y-3"},responsive:{titleSize:"text-xs md:text-sm lg:text-base",padding:"p-3 pt-5 md:p-4 md:pt-6",titlePosition:"-top-2 left-3 px-1.5 md:-top-2.5 md:left-4 md:px-2",spacing:"space-y-2 md:space-y-3"}});return e.jsxs("div",{className:`relative rounded-lg border-2 border-gray-200 dark:border-gray-700 ${i.padding} ${r}`,children:[e.jsx("h2",{className:`absolute bg-gradient-to-br from-indigo-50 to-purple-50 font-bold tracking-wider uppercase dark:from-gray-900 dark:to-gray-800 ${i.titleSize} ${i.titlePosition} ${$s[t]}`,children:a}),e.jsx("div",{className:i.spacing,children:s})]})}function zs({recipe:a,onSelect:t,isSelected:s=!1,isLoading:r=!1,screenSize:n}){const i=ye(s),o=k(n,{smartphone:{padding:"p-2",title:{size:"text-sm"},description:{size:"text-xs"},label:{size:"text-xs"},content:{size:"text-xs"}},tablet:{padding:"p-2",title:{size:"text-base"},description:{size:"text-sm"},label:{size:"text-sm"},content:{size:"text-sm"}},pc:{padding:"p-2",title:{size:"text-xl"},description:{size:"text-sm"},label:{size:"text-sm"},content:{size:"text-sm"}},responsive:{padding:"p-4 md:p-5 lg:p-6",title:{size:"text-base md:text-lg lg:text-xl"},description:{size:"text-xs md:text-sm"},label:{size:"text-xs md:text-sm"},content:{size:"text-xs md:text-sm"}}});return e.jsxs(P,{onClick:()=>t(a),disabled:r,variant:s?"default":"outline",className:`group relative h-full overflow-hidden rounded-lg shadow-lg ${i.animation} disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:scale-100 ${o.padding} ${i.base}`,children:[e.jsx("div",{className:i.gradient}),e.jsxs("div",{className:"relative",children:[e.jsx("h3",{className:`my-0 font-bold ${o.title.size} ${i.title}`,children:a.title}),!1,n!=="smartphone"&&e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:a.tags.map(l=>e.jsxs(Y,{variant:"secondary",className:s?"bg-white/20 text-white hover:bg-white/30":"",children:["#",l]},l))})]})]})}function Ds({stackRecipes:a,selectedStackRecipe:t,onSelectStackRecipe:s,isLoading:r,generatedDeck:n,screenSize:i}){const o=k(i,{smartphone:{gridCols:"grid-cols-4",gap:"gap-2"},tablet:{gridCols:"grid-cols-4",gap:"gap-3"},pc:{gridCols:"grid-cols-4",gap:"gap-4"},responsive:{gridCols:"grid-cols-4",gap:"gap-2 md:gap-3 lg:gap-4"}});return n!==null&&n.size===0?e.jsx("div",{className:"rounded-lg border border-yellow-200 bg-yellow-50 p-4 dark:border-yellow-800 dark:bg-yellow-950",children:e.jsx("p",{className:"text-sm font-semibold text-yellow-800 dark:text-yellow-200",children:"âš ï¸ ãƒ‡ãƒƒã‚­ãŒç©º (0çµ„) ã®ãŸã‚ã€ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹å‡ºæ¥ã¾ã›ã‚“"})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:`grid ${o.gap} ${o.gridCols}`,children:a.map(d=>e.jsx(zs,{recipe:d,onSelect:s,isSelected:t?.id===d.id,isLoading:r,screenSize:i},d.id))})})}function As({selectedTatamiSize:a,onSelectTatamiSize:t,availableSizes:s,isLoading:r,screenSize:n}){const i=k(n,{smartphone:{gridCols:"grid-cols-4",gap:"gap-2"},tablet:{gridCols:"grid-cols-4",gap:"gap-3"},pc:{gridCols:"grid-cols-4",gap:"gap-4"},responsive:{gridCols:"grid-cols-4",gap:"gap-2 md:gap-3 lg:gap-4"}});return e.jsx("div",{className:`grid ${i.gap} ${i.gridCols}`,children:s.map(o=>{const l=a===o;return e.jsx(X,{isSelected:l,onClick:()=>t(o),disabled:r,label:String(o),alignment:"center",screenSize:n},o)})})}function Ms({playMode:a,repository:t,deckRecipe:s,stackRecipe:r,players:n,tatamiSize:i,game:o,state:l,screenSize:d}){const g=k(d,{smartphone:{padding:"p-4",titleMargin:"mb-4",title:{size:"text-2xl"},sectionSpacing:"space-y-4",buttonMargin:"mt-4 mb-8",button:{height:"h-12",padding:"px-8",text:"text-base"},noteMargin:"mt-4",noteText:"text-sm"},tablet:{padding:"p-4",titleMargin:"mb-4",title:{size:"text-3xl"},sectionSpacing:"space-y-6",buttonMargin:"mt-8 mb-8",button:{height:"h-14",padding:"px-10",text:"text-lg"},noteMargin:"mt-4",noteText:"text-sm"},pc:{padding:"p-8",titleMargin:"mb-8",title:{size:"text-4xl"},sectionSpacing:"space-y-8",buttonMargin:"mt-8 mb-8",button:{height:"h-16",padding:"px-12",text:"text-xl"},noteMargin:"mt-4",noteText:"text-sm"},responsive:{padding:"p-4",titleMargin:"mb-8",title:{size:"text-2xl md:text-3xl lg:text-4xl"},sectionSpacing:"space-y-6",buttonMargin:"mt-8 mb-8",button:{height:"h-12 md:h-14 lg:h-16",padding:"px-8 md:px-10 lg:px-12",text:"text-base md:text-lg lg:text-xl"},noteMargin:"mt-4",noteText:"text-sm"}}),m=r.generatedStack?r.generatedStack.length:s.generatedDeck&&r.selected?r.selected.maxSize==="all"?s.generatedDeck.size:Math.min(r.selected.maxSize,s.generatedDeck.size):null;return e.jsx("div",{className:`min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-gray-900 dark:to-gray-800 ${g.padding}`,children:e.jsxs("div",{className:"mx-auto max-w-7xl",children:[e.jsx("div",{className:`text-center ${g.titleMargin}`,children:e.jsx("h1",{className:`mb-2 font-bold text-gray-800 dark:text-gray-100 ${g.title.size}`,children:"ğŸ´ PP Karuta 26"})}),l.error&&e.jsx(se,{variant:"destructive",className:"mb-6",children:e.jsxs(re,{children:[e.jsx("p",{className:"font-semibold",children:"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:"}),e.jsx("p",{className:"text-xs md:text-sm",children:l.error})]})}),e.jsxs("div",{className:g.sectionSpacing,children:[e.jsx(W,{title:"å…¥åŠ›æ–¹å¼",variant:"primary",screenSize:d,children:e.jsx(Is,{selectedPlayMode:a.selected,onSelectPlayMode:a.onSelect,isLoading:l.isLoading,screenSize:d})}),e.jsx(W,{title:"ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼",variant:"success",screenSize:d,children:e.jsx(Ts,{availablePlayers:n.available,selectedPlayerIds:n.selectedIds,onTogglePlayer:n.onToggle,onAddPlayer:n.onAdd,isLoading:l.isLoading,screenSize:d})}),e.jsx(W,{title:"ç•³ã‚µã‚¤ã‚º",variant:"warning",screenSize:d,children:e.jsx(As,{selectedTatamiSize:i.selected,onSelectTatamiSize:i.onSelect,availableSizes:i.availableSizes,isLoading:l.isLoading,screenSize:d})}),e.jsxs(W,{title:"ãƒ‡ãƒƒã‚­",variant:"danger",screenSize:d,children:[!t.isReady&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(qe,{screenSize:d})}),t.isReady&&e.jsx(Es,{deckRecipes:s.recipes,selectedDeckRecipe:s.selected,onSelectDeckRecipe:s.onSelect,isDeckLoading:s.isLoading,loadingDeckRecipeId:s.loadingRecipeId,generatedDeck:s.generatedDeck,screenSize:d,initialOpenCategories:s.selected?s.selected.tags:["å¹²æ”¯","æ­³æ™‚","PROMIDAS"]})]}),t.isReady&&e.jsx(W,{title:"æœ­æ•°",variant:"secondary",screenSize:d,children:e.jsx(Ds,{stackRecipes:r.recipes,selectedStackRecipe:r.selected,onSelectStackRecipe:r.onSelect,isLoading:l.isLoading,generatedStack:r.generatedStack,generatedDeck:s.generatedDeck,screenSize:d})}),e.jsx(Rs,{selectedPlayMode:a.selected,selectedDeckRecipe:s.selected,generatedDeck:s.generatedDeck,selectedStackRecipe:r.selected,stackSize:m,selectedPlayerCount:n.selectedIds.length,screenSize:d})]}),e.jsx("div",{className:`flex justify-center ${g.buttonMargin}`,children:e.jsx(P,{onClick:o.onStart,disabled:!o.canStart||l.isLoading,size:"lg",className:`font-bold ${g.button.height} ${g.button.padding} ${g.button.text}`,children:l.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mr-2 h-5 w-5 animate-spin rounded-full border-4 border-white border-t-transparent"}),"Loading..."]}):"ã‚ˆã‚ã—ããŠã­ãŒã„ã—ã¾ã™"})}),!o.canStart&&e.jsx("p",{className:`text-center text-gray-500 dark:text-gray-400 ${g.noteMargin} ${g.noteText}`,children:"å…¨ã¦ã®é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„"})]})})}function ve(){c.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[])}function Fs({setup:a,onShowIntro:t}){const s=be();ve();const r=et();c.useEffect(()=>{r.type==="token-invalid"&&b.error("Repository error:",r.error)},[r]);const n=r.type==="created-token-valid",i=r.type==="token-invalid"?r.error:null;return e.jsx(Ms,{playMode:{selected:a.selectedPlayMode,onSelect:a.selectPlayMode},repository:{isReady:n},deckRecipe:{recipes:Qe.RECIPES,selected:a.selectedDeckRecipe,onSelect:a.selectDeckRecipe,isLoading:a.isDeckLoading,loadingRecipeId:a.loadingDeckRecipeId,generatedDeck:a.generatedDeck},stackRecipe:{recipes:ds,selected:a.selectedStackRecipe,onSelect:a.selectStackRecipe,generatedStack:a.generatedStack},players:{available:a.availablePlayers,selectedIds:a.selectedPlayerIds,onToggle:a.togglePlayer,onAdd:a.addPlayer},tatamiSize:{selected:a.selectedTatamiSize,onSelect:a.selectTatamiSize,availableSizes:a.availableTatamiSizes},game:{onStart:a.createGameState,canStart:a.canStartGame},state:{isLoading:a.isCreatingGame||r.type==="validating",error:a.error||(i?`Repository error: ${i}`:null)},onShowIntro:t,screenSize:s})}function Ls({enabled:a,playerStates:t,deck:s,onCardSelect:r}){c.useEffect(()=>{if(!a)return;const n=i=>{if(i.ctrlKey||i.metaKey||i.altKey||i.shiftKey)return;const o=i.key.toLowerCase(),l=t.length;for(let d=0;d<t.length;d++){const g=t[d],m=Ze(d,l);if(!m)continue;const p=m.indexOf(o);if(p!==-1){const x=V.getByIds(s,g.tatami);if(p<x.length){const u=x[p];i.preventDefault(),r(g.player.id,u);return}}}};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[a,t,s,r])}const Q=["bg-blue-500 dark:bg-blue-600","bg-green-500 dark:bg-green-600","bg-purple-500 dark:bg-purple-600","bg-orange-500 dark:bg-orange-600"];function _s({playerStates:a,totalRaces:t,currentRace:s,screenSize:r}){const n=k(r,{smartphone:{bar:{height:"h-2",textSize:"text-xs"},legend:{textSize:"text-xs"},raceInfo:{margin:"me-2"},container:"px-4 py-2"},tablet:{bar:{height:"h-4",textSize:"text-sm"},legend:{textSize:"text-sm"},raceInfo:{margin:"me-4"},container:"px-8 py-2"},pc:{bar:{height:"h-8",textSize:"text-xl",showLabels:!0},legend:{textSize:"text-base"},raceInfo:{margin:"me-8"},container:"px-12 py-2"},responsive:{bar:{height:"h-4 md:h-6",textSize:"text-xs md:text-sm",showLabels:!0},legend:{textSize:"text-xs md:text-sm"},raceInfo:{margin:"me-2 md:me-4 lg:me-8"},container:"px-4 py-2 md:px-8 lg:px-12"}}),i=a.reduce((g,m)=>g+m.mochiFuda.length,0),o=t-i,l=a.length>1,d=Math.floor(90/a.length);return e.jsxs("div",{className:`w-full space-y-1 ${n.container}`,children:[l&&e.jsx("div",{className:`text-muted-foreground flex flex-wrap items-center justify-center gap-2 ${n.legend.textSize}`,children:a.map((g,m)=>e.jsxs("div",{style:{maxWidth:`${d}%`},className:"flex items-center gap-1",children:[e.jsx("div",{className:`h-3 w-3 shrink-0 rounded-sm ${Q[m%Q.length]}`}),e.jsxs("span",{className:"min-w-0 flex-1 truncate",children:[g.player.name,": ",g.mochiFuda.length]})]},g.player.id))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`shrink-0 font-bold ${n.raceInfo.margin} ${n.bar.textSize}`,children:[s," / ",t]}),e.jsxs("div",{className:`flex min-w-0 flex-1 overflow-hidden rounded ${n.bar.height}`,children:[a.map((g,m)=>{const p=g.mochiFuda.length/t*100;return p===0?null:e.jsx("div",{style:{width:`${p}%`},className:`${Q[m%Q.length]} flex items-center justify-center ${n.bar.textSize} font-semibold text-white transition-all duration-300`,title:`${g.player.name}: ${g.mochiFuda.length} cards`,children:n.bar.showLabels&&g.mochiFuda.length>0&&e.jsx("span",{className:"px-1",children:g.mochiFuda.length})},g.player.id)}),o>0&&e.jsx("div",{style:{width:`${o/t*100}%`},className:`flex items-center justify-center bg-gray-300 ${n.bar.textSize} font-medium text-gray-600 transition-all duration-300 dark:bg-gray-600 dark:text-gray-300`,title:`æ®‹ã‚Š: ${o} cards`,children:n.bar.showLabels&&o>0&&e.jsx("span",{className:"px-1",children:o})})]})]})]})}function Os({currentRace:a,totalRaces:t,score:s,mochiFudaCount:r,stackCount:n,tatamiCount:i,playerStates:o,screenSize:l}){const d=k(l,{smartphone:{text:"text-xs",gap:"gap-1",raceInfo:"text-lg",margin:"m-0"},tablet:{text:"text-sm",gap:"gap-2",raceInfo:"text-xl",margin:"m-0"},pc:{text:"text-base",gap:"gap-4",raceInfo:"text-2xl",margin:"m-0"},responsive:{text:"text-xs md:text-sm lg:text-base",gap:"gap-1 sm:gap-2 md:gap-4",raceInfo:"text-lg md:text-xl lg:text-2xl",margin:"m-2 md:m-3 lg:m-4"}});return e.jsxs("div",{className:`text-center ${d.margin} space-y-2`,children:[e.jsx(_s,{totalRaces:t,currentRace:a,playerStates:o,screenSize:l}),!1]})}function Bs({normalizedPrototype:a,index:t,keyboardKey:s,screenSize:r}){return k(r,{smartphone:{index:"h-6 w-6 bg-indigo-600 text-xs shadow-md",title:"mb-1 line-clamp-2 text-xs font-semibold text-gray-800",summary:"line-clamp-2 text-xs text-gray-600",id:"mt-1 text-xs text-gray-400"},tablet:{index:"h-7 w-7 bg-indigo-600 text-sm shadow-md",title:"mb-1 line-clamp-2 text-sm font-semibold text-gray-800",summary:"line-clamp-2 text-xs text-gray-600",id:"mt-2 text-xs text-gray-400"},pc:{index:"h-8 w-8 bg-indigo-600 text-base shadow-md",title:"mb-1 line-clamp-2 text-sm font-semibold text-gray-800",summary:"line-clamp-2 text-xs text-gray-600",id:"mt-2 text-xs text-gray-400"},responsive:{index:"h-6 w-6 md:h-7 md:w-7 lg:h-8 lg:w-8 bg-indigo-600 text-xs md:text-sm lg:text-base shadow-md",title:"mb-1 line-clamp-2 text-xs md:text-sm font-semibold text-gray-800",summary:"line-clamp-2 text-xs text-gray-600",id:"mt-1 md:mt-2 text-xs text-gray-400"}}),e.jsx(F,{className:"@container overflow-hidden rounded-none border-2 border-black bg-white shadow-none dark:border-white dark:bg-gray-950",children:e.jsxs(L,{className:"flex h-full items-center justify-center p-0",children:[s&&e.jsx("span",{className:"inline-flex min-h-8 min-w-8 items-center justify-center font-bold text-gray-700 dark:text-gray-300 @[60px]:text-base @[80px]:text-lg @[100px]:text-xl @[120px]:text-2xl @[140px]:text-3xl @[180px]:text-4xl @[220px]:text-5xl @[280px]:text-6xl",children:s.toUpperCase()}),!1]})})}function tt({normalizedPrototype:a,index:t,isClickable:s=!1,showImage:r=!0,onClick:n,screenSize:i}){const l=`rounded-none ${k(i,{smartphone:{borderWidth:"border-4",index:"h-5 w-5 bg-indigo-500",title:"mb-1 text-xs font-semibold text-gray-800",summary:"text-xs text-gray-600",id:"mt-1 text-xs text-gray-400"},tablet:{borderWidth:"border-8",index:"h-6 w-6 bg-indigo-500",title:"mb-1 text-md font-semibold text-gray-800",summary:"text-md text-gray-600",id:"mt-2 text-md text-gray-400"},pc:{borderWidth:"border-8",index:"h-6 w-6 bg-indigo-500",title:"mb-1 text-2xl font-semibold text-gray-800",summary:"text-xl text-gray-600",id:"mt-2 text-2xl text-gray-400"},responsive:{borderWidth:"border-4 md:border-8",index:"h-5 w-5 md:h-6 md:w-6 bg-indigo-500",title:"mb-1 text-xs md:text-sm font-semibold text-gray-800",summary:"text-xs text-gray-600",id:"mt-1 md:mt-2 text-xs text-gray-400"}}).borderWidth} border-black dark:border-white`;return e.jsx(F,{className:s?`${l} group cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95`:l,onClick:s&&n?()=>n(a):void 0,children:e.jsxs(L,{className:"relative p-0",children:[r&&e.jsx("div",{className:"aspect-video overflow-hidden rounded-none bg-gray-200",children:e.jsx("img",{src:a.mainUrl,alt:a.prototypeNm,className:"h-full w-full object-cover",onError:x=>{x.currentTarget.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100"%3E%3Crect fill="%23ddd" width="100" height="100"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" dy=".3em" fill="%23999"%3ENo Image%3C/text%3E%3C/svg%3E'}})}),!1]})})}function Gs(a){const{playMode:t}=a;return t==="keyboard"?e.jsx(Bs,{...a}):e.jsx(tt,{...a})}function Ys({tatamiCards:a,onCardClick:t,playMode:s,playerIndex:r,playerCount:n,screenSize:i="pc"}){const o=k(i,{smartphone:{gap:"gap-2",padding:"p-2",edgeBorder:"h-2",sideBorder:"border-x",background:"tatami-bg-smartphone"},tablet:{gap:"gap-4",padding:"p-4",edgeBorder:"h-3",sideBorder:"border-x",background:"tatami-bg-tablet"},pc:{gap:"gap-6",padding:"p-6",edgeBorder:"h-4",sideBorder:"border-x",background:"tatami-bg-pc"},responsive:{gap:"gap-2 md:gap-3 lg:gap-4",padding:"p-2 md:p-4 lg:p-6",edgeBorder:"h-2 md:h-[10px] lg:h-3",sideBorder:"border-x",background:"tatami-bg-smartphone md:tatami-bg-tablet lg:tatami-bg-pc"}}),l=`${o.edgeBorder} bg-indigo-950 dark:bg-indigo-900`,d=s==="keyboard"?"grid-cols-4":k(i,{smartphone:"grid-cols-2",tablet:"grid-cols-2",pc:"grid-cols-2",responsive:"grid-cols-2 md:grid-cols-3 lg:grid-cols-4"}),g=s==="touch";return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:l}),e.jsx("div",{className:`${o.padding} ${o.sideBorder} ${o.background} border-gray-300 dark:border-gray-600`,children:e.jsx("div",{className:`grid ${o.gap} ${d}`,children:a.map((m,p)=>e.jsx(Gs,{normalizedPrototype:m,index:p,isClickable:!0,playMode:s,showImage:g,onClick:t,keyboardKey:_a(r,p,n),screenSize:i},m.id))})}),e.jsx("div",{className:l})]})}function Ks({player:a,mochiFudaCount:t,score:s,playMode:r,screenSize:n="pc"}){const i=k(n,{smartphone:{icon:"h-6 w-6",title:"text-base",badgeText:"text-base"},tablet:{icon:"h-6 w-6",title:"text-xl",badgeText:"text-xl"},pc:{icon:"h-6 w-6",title:"text-2xl",badgeText:"text-2xl"},responsive:{icon:"h-4 w-4 md:h-5 md:w-5 lg:h-6 lg:w-6",title:"text-sm md:text-base lg:text-lg",badgeText:"text-xs md:text-sm lg:text-base"}}),o=r==="keyboard",l=o?"flex flex-col gap-1":"flex flex-row justify-between gap-2",d=o?`text-foreground flex min-w-0 items-center justify-center gap-2 font-bold ${i.title}`:`text-foreground flex min-w-0 flex-1 items-center gap-2 font-bold ${i.title}`,g=o?"flex flex-wrap justify-center gap-1":"flex flex-nowrap gap-2";return e.jsxs("div",{className:l,children:[e.jsxs("h3",{className:d,children:[e.jsx(Oe,{className:`shrink-0 ${i.icon}`}),e.jsx("span",{className:"min-w-0 truncate",children:a.name})]}),e.jsxs("div",{className:g,children:[e.jsxs(Y,{variant:"outline",className:`shrink-0 bg-yellow-100 text-yellow-700 ${i.badgeText}`,children:[s.toLocaleString()," pts"]}),e.jsxs(Y,{variant:"outline",className:`shrink-0 bg-green-100 text-green-700 ${i.badgeText}`,children:[t.toLocaleString()," æš"]})]})]})}function Us({player:a,playerIndex:t,playerCount:s,tatamiCards:r,onCardClick:n,mochiFudaCount:i,score:o,playMode:l,feedbackState:d=null,screenSize:g="pc"}){const m=k(g,{smartphone:{card:{borderWidth:"border-4",borderColor:"border-transparent",background:"bg-transparent",shadow:"shadow-none",transition:"transition-all duration-300"},header:{padding:"px-2 pt-2 pb-0"},content:{padding:"p-2"}},tablet:{card:{borderWidth:"border-4",borderColor:"border-transparent",background:"bg-transparent",shadow:"shadow-none",transition:"transition-all duration-300"},header:{padding:"px-4 pt-4 pb-0"},content:{padding:"p-4"}},pc:{card:{borderWidth:"border-4",borderColor:"border-transparent",background:"bg-transparent",shadow:"shadow-none",transition:"transition-all duration-300"},header:{padding:"px-6 pt-6 pb-0"},content:{padding:"p-6"}},responsive:{card:{borderWidth:"border-2",borderColor:"border-transparent",background:"bg-card",shadow:"shadow-none",transition:"transition-all duration-300"},header:{padding:"p-2 md:p-3 lg:p-4"},content:{padding:"p-2 md:p-4 lg:p-6"}}}),p=d?d==="correct"?`${m.card.borderWidth} border-green-500`:`${m.card.borderWidth} border-red-500`:`${m.card.borderWidth} ${m.card.borderColor}`,x=d?d==="correct"?"shadow-2xl shadow-green-500/70":"shadow-2xl shadow-red-500/70":m.card.shadow,u=d?d==="correct"?"animate-[flash_0.6s_ease-in-out]":"animate-[shake_0.5s_ease-in-out]":"";return e.jsxs(F,{className:`flex max-h-full flex-col ${p} ${x} ${u} ${m.card.background} ${m.card.transition}`,children:[e.jsx(G,{className:`shrink-0 ${m.header.padding}`,children:e.jsx(Ks,{player:a,mochiFudaCount:i,score:o,playMode:l,screenSize:g})}),e.jsx(L,{className:`min-h-0 flex-1 overflow-y-auto ${m.content.padding}`,children:e.jsx(Ys,{tatamiCards:r,onCardClick:n,playMode:l,playerIndex:t,playerCount:s,screenSize:g})})]})}function Hs({tatamiCards:a,screenSize:t="pc"}){const s=k(t,{smartphone:{title:"text-base",gap:"gap-2",padding:"p-2",edgeBorder:"h-2",sideBorder:"border-x",background:"tatami-bg-smartphone"},tablet:{title:"text-lg",gap:"gap-4",padding:"p-4",edgeBorder:"h-3",sideBorder:"border-x",background:"tatami-bg-tablet"},pc:{title:"text-xl",gap:"gap-6",padding:"p-6",edgeBorder:"h-4",sideBorder:"border-x",background:"tatami-bg-pc"},responsive:{title:"text-base md:text-lg lg:text-xl",gap:"gap-2 md:gap-3 lg:gap-4",padding:"p-3 md:p-4 lg:p-6",edgeBorder:"h-2 md:h-[10px] lg:h-3",sideBorder:"border-x",background:"tatami-bg-smartphone md:tatami-bg-tablet lg:tatami-bg-pc"}}),r=`${s.edgeBorder} bg-indigo-950 dark:bg-indigo-900`;return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:r}),e.jsx("div",{className:`${s.padding} ${s.sideBorder} ${s.background} border-gray-300 dark:border-gray-600`,children:e.jsx("div",{className:`grid ${s.gap} grid-cols-4`,children:a.map((i,o)=>e.jsx(tt,{normalizedPrototype:i,index:o,isClickable:!1,showImage:!0,screenSize:t},i.id))})}),e.jsx("div",{className:r})]})}function Ws({text:a,speed:t=100,rhythm:s=[5,7,5,7,7],rhythmPause:r=300,remainingSpeed:n=50,startDelay:i=0}){const[o,l]=c.useState(""),[d,g]=c.useState(-1),m=c.useMemo(()=>Array.from(a),[a]),p=c.useMemo(()=>{const y=[];let h=0;for(const f of s)h+=f,y.push(h);return y},[s]),x=c.useMemo(()=>s.reduce((y,h)=>y+h,0),[s]),u=c.useRef(p);return c.useEffect(()=>{u.current=p},[p]),c.useEffect(()=>{if(d!==-1)return;const y=setTimeout(()=>{g(0)},i);return()=>clearTimeout(y)},[i,d]),c.useEffect(()=>{if(d<0||d>=m.length)return;const y=d>=x,h=u.current.includes(d);let f;h?f=r:y?f=n:f=t;const w=setTimeout(()=>{l(m.slice(0,d+1).join("")),g(d+1)},f);return()=>clearTimeout(w)},[d,m,t,r,n,x]),{displayedText:o,isComplete:d>=m.length}}function Vs({normalizedPrototype:a,screenSize:t}){const s=(a.prototypeNm??"NO NAME")+" - "+(a.summary||"NO DESCRIPTION"),{displayedText:r}=Ws({text:s,speed:200,rhythmPause:1e3}),n=k(t,{smartphone:{text:"text-lg",padding:"px-3 py-2"},tablet:{text:"text-xl",padding:"px-4 py-3"},pc:{text:"text-2xl",padding:"px-6 py-4"},responsive:{text:"text-lg md:text-xl lg:text-2xl",padding:"px-3 py-2 md:px-4 md:py-3 lg:px-6 lg:py-4"}});return e.jsxs(e.Fragment,{children:[!1,e.jsx("div",{className:`bg-primary text-primary-foreground flex items-center gap-3 rounded-lg shadow-lg ${n.padding}`,children:e.jsxs("h2",{className:`flex-1 font-bold tracking-widest ${n.text}`,children:["ğŸ’¬ ",r||"Â "]})})]})}function Xs({yomiFuda:a,sharedTatamiCards:t,playerStates:s,deck:r,totalRaces:n,currentRace:i,stackCount:o,playMode:l,onPlayerCardSelect:d,playerFeedbackStates:g,screenSize:m}){const p=s.reduce((f,w)=>f+w.score,0),x=s.reduce((f,w)=>f+w.mochiFuda.length,0),u=s.length,y=k(m,{smartphone:{containerPadding:"p-0",sectionSpacing:"my-2",sharedTatami:{padding:"px-4"},yomiFuda:{padding:"px-4"},playerGrid:{gap:"gap-2",margin:"m-0",padding:"px-2"}},tablet:{containerPadding:"p-0",sectionSpacing:"my-3",sharedTatami:{padding:"px-12"},yomiFuda:{padding:"px-12"},playerGrid:{gap:"gap-2",margin:"m-0",padding:"px-2"}},pc:{containerPadding:"p-0",sectionSpacing:"my-4",sharedTatami:{padding:"px-16"},yomiFuda:{padding:"px-16"},playerGrid:{gap:"gap-2",margin:"m-0",padding:"px-2"}},responsive:{containerPadding:"p-3 md:p-4 lg:p-6",sectionSpacing:"my-4 md:my-6 lg:my-8 space-y-3 md:space-y-4 lg:space-y-6",sharedTatami:{padding:"px-2 md:px-4 lg:px-6"},yomiFuda:{padding:"px-2 md:px-4 lg:px-6"},playerGrid:{gap:"gap-3 md:gap-4 lg:gap-6",margin:"m-0",padding:"p-2"}}}),h=()=>l==="keyboard"?u===1?"grid-cols-1":u===2?"grid-cols-2":u===3?"grid-cols-3":"grid-cols-4":l==="touch"?m==="smartphone"?u<=2?"grid-cols-1":"grid-cols-2":u<=1?"grid-cols-1":"grid-cols-2":"grid-cols-2";return e.jsx("div",{className:`flex h-full flex-col bg-gradient-to-br from-green-50 to-teal-100 dark:from-gray-900 dark:to-gray-800 ${y.containerPadding}`,children:e.jsxs("div",{className:"mx-auto flex w-full max-w-7xl flex-1 flex-col overflow-hidden",children:[e.jsx("div",{className:`shrink-0 ${y.sectionSpacing}`,children:e.jsx(Os,{currentRace:i,totalRaces:n,score:p,mochiFudaCount:x,stackCount:o,tatamiCount:t.length,playerStates:s,screenSize:m})}),l!=="touch"&&e.jsx("div",{className:`shrink-0 ${y.sectionSpacing} ${y.sharedTatami.padding}`,children:e.jsx(Hs,{tatamiCards:t,playMode:l,screenSize:m})}),e.jsx("div",{className:`shrink-0 ${y.sectionSpacing} ${y.yomiFuda.padding}`,children:e.jsx(Vs,{normalizedPrototype:a,screenSize:m},a.id)}),e.jsx("div",{className:`min-h-0 flex-1 ${y.sectionSpacing}`,children:e.jsx("div",{className:"flex h-full flex-col",children:e.jsx("div",{className:`grid h-full ${y.playerGrid.gap} ${y.playerGrid.margin} ${y.playerGrid.padding} ${h()}`,children:s.map((f,w)=>{const R=V.getByIds(r,f.tatami);return e.jsx("div",{className:"min-h-0",children:e.jsx(Us,{player:f.player,playerIndex:w,playerCount:s.length,tatamiCards:R,onCardClick:z=>d(f.player.id,z),mochiFudaCount:f.mochiFuda.length,score:f.score,playMode:l,feedbackState:g[f.player.id]??null,screenSize:m})},f.player.id)})})})})]})})}function qs({gameState:a,playMode:t,onCorrectAnswer:s,onIncorrectAnswer:r,screenSize:n}){ve();const l=a.playerStates.reduce((u,y)=>u+y.mochiFuda.length,0)+1,[d,g]=c.useState({}),m=c.useMemo(()=>{const u=B.pickYomiFuda(a.tatami);return u!==null?a.deck.get(u)??null:null},[a.tatami,a.deck]),p=V.getByIds(a.deck,a.tatami),x=c.useCallback((u,y)=>{if(!m)return;const h=y.id===m.id;b.debug(h?"âœ… Correct!":"âŒ Incorrect!",{player:u,selected:{name:y.prototypeNm,id:y.id},answer:{name:m.prototypeNm,id:m.id}}),g(w=>({...w,[u]:h?"correct":"incorrect"})),setTimeout(()=>{g(w=>({...w,[u]:null}))},h?1500:500),h?s(u,y.id):r(u)},[m,s,r]);return Ls({enabled:t==="keyboard",playerStates:a.playerStates,deck:a.deck,onCardSelect:x}),m?e.jsx(Xs,{yomiFuda:m,sharedTatamiCards:p,playerStates:a.playerStates,deck:a.deck,totalRaces:a.totalRaces,currentRace:l,stackCount:a.stack.length,playMode:t,onPlayerCardSelect:x,playerFeedbackStates:d,screenSize:n}):e.jsx("div",{children:"Loading results..."})}const Js="https://protopedia.net/prototype",Zs=a=>`${Js}/${a}`;function Qs({card:a}){const t=()=>{window.open(Zs(a.id),"_blank","noopener,noreferrer")};return e.jsx(F,{onClick:t,className:"cursor-pointer transition-all hover:shadow-lg",children:e.jsxs(L,{className:"p-4",children:[a.mainUrl&&e.jsx("img",{src:a.mainUrl,alt:a.prototypeNm,className:"mb-2 h-32 w-full rounded object-cover"}),e.jsx("h3",{className:"mb-1 text-sm font-semibold text-gray-800",children:a.prototypeNm}),e.jsx("p",{className:"line-clamp-2 text-xs text-gray-600",children:a.summary})]})})}function Se({onBackToTop:a,onReplay:t,buttonsGap:s,buttonSize:r}){return e.jsxs("div",{className:`flex flex-col justify-center sm:flex-row ${s}`,children:[e.jsx(P,{onClick:a,variant:"secondary",size:r,className:"shadow-lg",children:"ğŸ´ MENU"}),e.jsx(P,{onClick:t,variant:"default",size:r,className:"shadow-lg",children:"ğŸ”„ REPLAY"})]})}function er({playerStates:a,deck:t,onBackToTop:s,onReplay:r,screenSize:n}){const i=[...a].sort((d,g)=>g.score-d.score),o=[];i.forEach((d,g)=>{g===0?o.push(1):d.score===i[g-1].score?o.push(o[g-1]):o.push(g+1)});const l=k(n,{smartphone:{container:{padding:"p-4",maxWidth:"max-w-full"},header:{margin:"mb-4"},title:{size:"text-xl"},card:{margin:"mb-4"},ranking:{icon:"h-8 w-8 text-lg",name:"text-base",info:"text-xs",badge:"text-lg",padding:"p-3",gap:"gap-2"},playerCard:{icon:"h-8 w-8 text-base",title:"text-lg",gap:"gap-2"},grid:"grid-cols-1",buttons:{size:"default",gap:"gap-2"}},tablet:{container:{padding:"p-6",maxWidth:"max-w-3xl"},header:{margin:"mb-6"},title:{size:"text-2xl"},card:{margin:"mb-5"},ranking:{icon:"h-10 w-10 text-xl",name:"text-lg",info:"text-sm",badge:"text-xl",padding:"p-3",gap:"gap-3"},playerCard:{icon:"h-9 w-9 text-lg",title:"text-xl",gap:"gap-2"},grid:"grid-cols-2",buttons:{size:"lg",gap:"gap-3"}},pc:{container:{padding:"p-8",maxWidth:"max-w-4xl"},header:{margin:"mb-8"},title:{size:"text-2xl"},card:{margin:"mb-6"},ranking:{icon:"h-12 w-12 text-2xl",name:"text-lg",info:"text-sm",badge:"text-2xl",padding:"p-4",gap:"gap-4"},playerCard:{icon:"h-10 w-10 text-lg",title:"text-xl",gap:"gap-3"},grid:"grid-cols-3",buttons:{size:"lg",gap:"gap-4"}},responsive:{container:{padding:"p-4 md:p-6 lg:p-8",maxWidth:"max-w-full md:max-w-3xl lg:max-w-4xl"},header:{margin:"mb-4 md:mb-6 lg:mb-8"},title:{size:"text-xl md:text-2xl"},card:{margin:"mb-4 md:mb-5 lg:mb-6"},ranking:{icon:"h-8 w-8 md:h-10 md:w-10 lg:h-12 lg:w-12 text-lg md:text-xl lg:text-2xl",name:"text-base md:text-lg",info:"text-xs md:text-sm",badge:"text-lg md:text-xl lg:text-2xl",padding:"p-3 md:p-3 lg:p-4",gap:"gap-2 md:gap-3 lg:gap-4"},playerCard:{icon:"h-8 w-8 md:h-9 md:w-9 lg:h-10 lg:w-10 text-base md:text-lg",title:"text-lg md:text-xl",gap:"gap-2 md:gap-2 lg:gap-3"},grid:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",buttons:{size:"lg",gap:"gap-2 md:gap-3 lg:gap-4"}}});return e.jsx("div",{className:`min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 ${l.container.padding}`,children:e.jsxs("div",{className:`mx-auto ${l.container.maxWidth}`,children:[e.jsx("div",{className:`text-center ${l.header.margin}`}),e.jsxs(F,{className:l.card.margin,children:[e.jsx(G,{children:e.jsx("h2",{className:`text-foreground font-bold ${l.title.size}`,children:"ğŸ† çµæœ"})}),e.jsx(L,{children:e.jsx("div",{className:"space-y-3",children:i.map((d,g)=>e.jsxs("div",{className:`flex items-center justify-between rounded-lg border dark:border-gray-700 dark:bg-gray-800 ${l.ranking.padding}`,children:[e.jsxs("div",{className:`flex items-center ${l.ranking.gap}`,children:[e.jsx("div",{className:`flex items-center justify-center rounded-full bg-indigo-100 font-bold text-indigo-600 dark:bg-indigo-900 dark:text-indigo-300 ${l.ranking.icon}`,children:o[g]}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-foreground font-bold ${l.ranking.name}`,children:d.player.name}),e.jsxs("p",{className:`text-muted-foreground ${l.ranking.info}`,children:[d.mochiFuda.length," cards acquired"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs(Y,{variant:"outline",className:`bg-indigo-100 font-bold text-indigo-700 dark:bg-indigo-900 dark:text-indigo-200 ${l.ranking.badge}`,children:[d.score," pts"]})})]},d.player.id))})})]}),e.jsx("div",{className:l.card.margin,children:e.jsx(Se,{onBackToTop:s,onReplay:r,buttonsGap:l.buttons.gap,buttonSize:l.buttons.size})}),i.map((d,g)=>{const m=d.mochiFuda.map(p=>t.get(p)).filter(p=>p!==void 0);return e.jsxs(F,{className:l.card.margin,children:[e.jsx(G,{children:e.jsxs("div",{className:`flex items-center ${l.playerCard.gap}`,children:[e.jsx("div",{className:`flex items-center justify-center rounded-full bg-indigo-100 font-bold text-indigo-600 dark:bg-indigo-900 dark:text-indigo-300 ${l.playerCard.icon}`,children:o[g]}),e.jsxs("h2",{className:`text-foreground font-bold ${l.playerCard.title}`,children:[d.player.name," (",m.length.toLocaleString()," æš)"]})]})}),e.jsx(L,{children:m.length===0?e.jsx("p",{className:"text-muted-foreground text-center",children:"NO FUDA"}):e.jsx("div",{className:`grid gap-4 ${l.grid}`,children:m.map(p=>e.jsx(Qs,{card:p},p.id))})})]},d.player.id)}),e.jsx("div",{className:"mb-8",children:e.jsx(Se,{onBackToTop:s,onReplay:r,buttonsGap:l.buttons.gap,buttonSize:l.buttons.size})})]})})}function tr({deck:a,playerStates:t,onBackToTop:s,onReplay:r,screenSize:n}){ve();const i=c.useCallback(()=>{s()},[s]),o=c.useCallback(()=>{r()},[r]);return e.jsx(er,{playerStates:t,deck:a,onBackToTop:i,onReplay:o,screenSize:n})}const at="pp-karuta-deck-setup";function ar(a,t){return a.offset===t.offset&&a.limit===t.limit&&a.userNm===t.userNm&&a.materialNm===t.materialNm&&a.tagNm===t.tagNm&&a.eventNm===t.eventNm}async function sr(a,t,s){b.debug("ğŸ”¨ [generateDeckWithOptimization] Starting for recipe:",t.id);const r=s!==null&&ar(s,t.apiParams);let n;r?n=await a.getAllFromSnapshot():n=await V.getPrototypesFromRecipe(t,a),b.debug("ğŸ“Š [generateDeckWithOptimization] Fetched prototypes:",n.length);const i=V.createDeckWithFilter(n,t.filter);return b.info("âœ… [generateDeckWithOptimization] Created deck with",i.size,"cards"),{deck:i,usedApiParams:t.apiParams}}function rr(a){try{sessionStorage.setItem(at,JSON.stringify(a))}catch(t){b.error("Failed to save setup state:",t)}}function Ne(){try{const a=sessionStorage.getItem(at);return a?JSON.parse(a):null}catch(a){return b.error("Failed to load setup state:",a),null}}function nr({repository:a,onGameStateCreated:t}){const s=Ne(),[r,n]=c.useState(null),[i,o]=c.useState(null),[l,d]=c.useState(!1),[g,m]=c.useState(null),[p,x]=c.useState(null),[u,y]=c.useState(null),[h,f]=c.useState(()=>{if(s?.selectedStackRecipeId){const j=pe.findById(s.selectedStackRecipeId);return b.debug("ğŸ”„ Restoring StackRecipe from sessionStorage:",j?.id),j||null}const v=pe.findById("standard-10");return b.debug("ğŸ“¦ Using default StackRecipe:",v?.id),v||null}),[w,R]=c.useState([]),[z,q]=c.useState(()=>(b.debug("ğŸ”„ Restoring selectedPlayerIds from sessionStorage:",s?.selectedPlayerIds),s?.selectedPlayerIds||[])),[T,st]=c.useState(()=>(b.debug("ğŸ”„ Restoring selectedPlayMode from sessionStorage:",s?.selectedPlayMode),s?.selectedPlayMode||"touch")),[$,J]=c.useState(()=>(b.debug("ğŸ”„ Restoring selectedTatamiSize from sessionStorage:",s?.selectedTatamiSize),s?.selectedTatamiSize||Oa)),[rt,O]=c.useState(null),[ne,we]=c.useState(!1);c.useEffect(()=>{(async()=>{const j=await E.loadPlayers();if(j&&j.length>0)R(j),q([j[0].id]);else{const I=E.createPlayer(`player-${Date.now()}`,"Player 1"),C=[I];R(C),q([I.id]),await E.savePlayers(C)}})()},[]);const ie=c.useCallback(async v=>{if(!a){O("Repository is not initialized");return}if(i?.id===v.id&&r!==null){b.debug("ğŸ“¦ Same DeckRecipe selected, reusing existing Deck:",v.id),d(!1);return}d(!0),m(v.id),O(null);let j,I;try{const C=await sr(a,v,p);j=C.deck,I=C.usedApiParams}catch(C){const Z=C instanceof Error?C.message:"Failed to generate Deck";O(Z),b.error("Failed to generate Deck:",C),d(!1),m(null);return}if(x(I),n(j),o(v),b.debug("âœ… Deck generated successfully:",j.size,"cards"),h&&j.size>0)try{const C=ue.generate(j,h);y(C),b.debug("âœ… Stack regenerated:",C.length,"cards")}catch(C){b.error("Failed to regenerate Stack:",C),y(null)}else j.size===0&&y(null);d(!1),m(null)},[a,i?.id,r,h,p]);c.useEffect(()=>{const v=Ne();if(b.debug("ğŸ” Checking deck restoration:",{hasRepository:!!a,savedDeckRecipeId:v?.selectedDeckRecipeId,currentDeckRecipe:i?.id}),a&&v?.selectedDeckRecipeId&&!i){const j=Qe.RECIPES.find(I=>I.id===v.selectedDeckRecipeId);j?(b.debug("ğŸ”„ Restoring deck recipe from sessionStorage:",j.id),ie(j)):b.warn("âš ï¸ Saved deck recipe not found:",v.selectedDeckRecipeId)}},[a,i]),c.useEffect(()=>{a&&i&&!r&&!l&&(b.debug("ğŸ”„ Repository became available, regenerating deck for recipe:",i.id),ie(i))},[a,i,r,l]),c.useEffect(()=>{const v={selectedDeckRecipeId:i?.id||null,selectedStackRecipeId:h?.id||null,selectedPlayerIds:z,selectedPlayMode:T,selectedTatamiSize:$};rr(v)},[i,h,z,T,$]);const nt=c.useCallback(v=>{if(f(v),O(null),r&&r.size>0){const j=ue.generate(r,v);y(j),b.debug("âœ… Stack generated:",j.length,"cards")}else y(null),r&&r.size},[r]),it=c.useCallback(v=>{q(j=>{const I=j.includes(v)?j.filter(C=>C!==v):[...j,v];return T==="keyboard"&&I.length>=3&&($===12||$===16)&&J(8),I}),O(null)},[T,$]),ot=c.useCallback(async()=>{const v=w.length+1,j=E.createPlayer(`player-${Date.now()}`,`Player ${v}`),I=[...w,j];R(I),await E.savePlayers(I),q(C=>{const Z=[...C,j.id];return T==="keyboard"&&Z.length>=3&&($===12||$===16)&&J(8),Z}),O(null)},[w,T,$]),lt=c.useCallback(v=>{st(v),O(null),v==="keyboard"&&z.length>=3&&($===12||$===16)&&J(8)},[z.length,$]),dt=c.useCallback(v=>{J(v),O(null)},[]),ct=c.useMemo(()=>{if(T==="keyboard")switch(z.length){case 1:return ge;case 2:return ge;case 3:return ce;case 4:return ce;default:return ce}return ge},[T,z.length]),oe=c.useMemo(()=>r!==null&&r.size>0&&h!==null&&u!==null&&u.length>0&&z.length>0&&T!==null&&!l&&!ne,[r,h,u,z,T,l,ne]),gt=c.useCallback(async()=>{if(!(!oe||!r||!h||!T)){we(!0),O(null);try{const v=w.filter(I=>z.includes(I.id));if(v.length===0)throw new Error("No players selected");const j=B.createInitialState(r,v,T,h,$);t(j)}catch(v){const j=v instanceof Error?v.message:"Failed to create game state";O(j),b.error("Failed to create game state:",v)}finally{we(!1)}}},[oe,r,h,T,$,w,z,t]);return{generatedDeck:r,selectedDeckRecipe:i,selectDeckRecipe:ie,isDeckLoading:l,loadingDeckRecipeId:g,generatedStack:u,selectedStackRecipe:h,selectStackRecipe:nt,availablePlayers:w,selectedPlayerIds:z,togglePlayer:it,addPlayer:ot,selectedPlayMode:T,selectPlayMode:lt,selectedTatamiSize:$,selectTatamiSize:dt,availableTatamiSizes:ct??[4,8,12,16],canStartGame:oe,createGameState:gt,error:rt,isCreatingGame:ne}}function ir(){const a=xe(),t=be(),s=xt({from:"/"}),r=et(),n=r.type==="created-token-valid"?r.repository:null,[i,o]=c.useState(null),l=nr({repository:n,onGameStateCreated:f=>{b.debug("ğŸ® Game started"),o(f)}}),d=s?.reset;c.useEffect(()=>{d&&o(null)},[d]);const g=l.selectedPlayMode,m=c.useCallback((f,w)=>{o(R=>R&&B.processCorrectAnswer(R,f,w))},[]),p=c.useCallback(f=>{o(w=>w&&B.processIncorrectAnswer(w,f))},[]),x=c.useCallback(()=>{o(null)},[]),u=c.useCallback(async()=>{await l.createGameState()},[l]),y=c.useCallback(()=>{a({to:"/intro"})},[a]);return(i?B.isGameOver(i):!1)&&i?e.jsx(tr,{deck:i.deck,playerStates:i.playerStates,onBackToTop:x,onReplay:u,screenSize:t}):i&&g?e.jsx(qs,{gameState:i,playMode:g,onCorrectAnswer:m,onIncorrectAnswer:p,screenSize:t}):e.jsx(Fs,{setup:l,onShowIntro:y})}const or=he("/")({component:lr,validateSearch:a=>({reset:typeof a.reset=="string"?a.reset:void 0})});function lr(){return e.jsx(ir,{})}const dr=ys.update({id:"/player",path:"/player",getParentRoute:()=>ae}),cr=ws.update({id:"/intro",path:"/intro",getParentRoute:()=>ae}),gr=or.update({id:"/",path:"/",getParentRoute:()=>ae}),mr={IndexRoute:gr,IntroRoute:cr,PlayerRoute:dr},pr=ae._addFileChildren(mr)._addFileTypes(),ur=ht({routeTree:pr,basepath:"/pp-karuta"});mt.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsx(ft,{router:ur})}));
