import{r as d,j as e,c as nt}from"./react-vendor-CZsbqYdR.js";import{u as me,L as re,c as ot,O as it,a as ue,b as lt,d as dt,R as ct}from"./tanstack-router-_HpTP72C.js";import{t as mt,c as ut,S as gt,a as ge,b as we,C as pt,d as je,P as xt,e as Se,I as Ne,f as Pe,g as Ce,h as ht,R as Re,i as Ee,L as Ie,j as De,k as ft,T as yt,l as bt,M as vt,m as kt,n as wt,o as jt,p as St,q as Nt,E as Pt,r as Ct,s as Rt,u as Et,v as It,O as Te,w as Dt,x as $e,y as Tt,X as $t,z as Ae,D as Me,A as At,B as Mt,F as Ft,G as zt,H as Lt,J as _t,K as Ot,N as Yt,Q as Bt}from"./vendor-CAVRpk7q.js";import{T as Gt,a as Kt,c as Ut,t as Ht,p as Wt,g as Vt,C as Xt}from"./promidas-DQFcmDil.js";import{f as T}from"./faker-vendor-lT0botVD.js";const qt={theme:"system",setTheme:()=>null},Fe=d.createContext(qt);function Jt({children:a,defaultTheme:t="system",storageKey:s="vite-ui-theme",...r}){const[n,o]=d.useState(()=>localStorage.getItem(s)||t);d.useEffect(()=>{const l=window.document.documentElement;if(l.classList.remove("light","dark"),n==="system"){const c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";l.classList.add(c);return}l.classList.add(n)},[n]);const i={theme:n,setTheme:l=>{localStorage.setItem(s,l),o(l)}};return e.jsx(Fe.Provider,{...r,value:i,children:a})}const Zt=()=>{const a=d.useContext(Fe);if(a===void 0)throw new Error("useTheme must be used within a ThemeProvider");return a};function N(...a){return mt(ut(a))}const Qt=ge("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),C=d.forwardRef(({className:a,variant:t,size:s,asChild:r=!1,...n},o)=>{const i=r?gt:"button";return e.jsx(i,{className:N(Qt({variant:t,size:s,className:a})),ref:o,...n})});C.displayName="Button";const ea=ft,ta=yt,aa=d.forwardRef(({className:a,inset:t,children:s,...r},n)=>e.jsxs(we,{ref:n,className:N("focus:bg-accent data-[state=open]:bg-accent flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none select-none [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t&&"pl-8",a),...r,children:[s,e.jsx(pt,{className:"ml-auto"})]}));aa.displayName=we.displayName;const sa=d.forwardRef(({className:a,...t},s)=>e.jsx(je,{ref:s,className:N("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-[--radix-dropdown-menu-content-transform-origin] overflow-hidden rounded-md border p-1 shadow-lg",a),...t}));sa.displayName=je.displayName;const ze=d.forwardRef(({className:a,sideOffset:t=4,...s},r)=>e.jsx(xt,{children:e.jsx(Se,{ref:r,sideOffset:t,className:N("bg-popover text-popover-foreground z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",a),...s})}));ze.displayName=Se.displayName;const X=d.forwardRef(({className:a,inset:t,...s},r)=>e.jsx(Ne,{ref:r,className:N("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm transition-colors outline-none select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",t&&"pl-8",a),...s}));X.displayName=Ne.displayName;const ra=d.forwardRef(({className:a,children:t,checked:s,...r},n)=>e.jsxs(Pe,{ref:n,className:N("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center rounded-sm py-1.5 pr-2 pl-8 text-sm transition-colors outline-none select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:s,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ce,{children:e.jsx(ht,{className:"h-4 w-4"})})}),t]}));ra.displayName=Pe.displayName;const na=d.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Re,{ref:r,className:N("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center rounded-sm py-1.5 pr-2 pl-8 text-sm transition-colors outline-none select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ce,{children:e.jsx(Ee,{className:"h-2 w-2 fill-current"})})}),t]}));na.displayName=Re.displayName;const oa=d.forwardRef(({className:a,inset:t,...s},r)=>e.jsx(Ie,{ref:r,className:N("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",a),...s}));oa.displayName=Ie.displayName;const ia=d.forwardRef(({className:a,...t},s)=>e.jsx(De,{ref:s,className:N("bg-muted -mx-1 my-1 h-px",a),...t}));ia.displayName=De.displayName;function la(){const{setTheme:a}=Zt();return e.jsxs(ea,{children:[e.jsx(ta,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"icon",children:[e.jsx(bt,{className:"h-[1.2rem] w-[1.2rem] scale-100 rotate-0 transition-all dark:scale-0 dark:-rotate-90"}),e.jsx(vt,{className:"absolute h-[1.2rem] w-[1.2rem] scale-0 rotate-90 transition-all dark:scale-100 dark:rotate-0"}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),e.jsxs(ze,{align:"end",children:[e.jsx(X,{onClick:()=>a("light"),children:"Light"}),e.jsx(X,{onClick:()=>a("dark"),children:"Dark"}),e.jsx(X,{onClick:()=>a("system"),children:"System"})]})]})}function da({state:a,onClick:t}){const s=()=>{switch(a.type){case"not-created":return{icon:St,color:"text-gray-400"};case"validating":return{icon:jt,color:"text-blue-500"};case"created-token-valid":return{icon:wt,color:"text-green-500"};case"token-invalid":return{icon:kt,color:"text-red-500"}}},{icon:r,color:n}=s();return e.jsx(C,{type:"button",onClick:t,variant:"ghost",size:"icon","aria-label":"Repository status",children:e.jsx(r,{className:`h-5 w-5 ${n}`})})}function ca({state:a,onClick:t}){return e.jsx(da,{state:a,onClick:t})}function ma({screenSize:a,homeButton:t,rulesButton:s,playerButton:r,repoStateIndicator:n,themeToggle:o}){const i=`Application header - ${a} view`;return e.jsx("header",{className:"h-12 border-b bg-white md:h-14 lg:h-16 dark:border-gray-800 dark:bg-gray-950","aria-label":i,children:e.jsxs("div",{className:"mx-auto flex h-full max-w-7xl items-center justify-between px-2 md:px-4",children:[e.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[t,r]}),e.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[s,n,o]})]})})}function ua({repoState:a,onRepoIndicatorClick:t,screenSize:s}){const r=me(),n=o=>{o.preventDefault(),r({to:"/",search:{reset:Date.now().toString()}})};return e.jsx(ma,{screenSize:s,homeButton:e.jsx(C,{variant:"ghost",size:"sm",asChild:!0,"aria-label":"„Éõ„Éº„É†„Å´Êàª„Çã",className:"text-xs md:text-sm lg:text-base",children:e.jsxs(re,{to:"/",onClick:n,title:"„Éõ„Éº„É†„Å´Êàª„Çã",children:[e.jsx("span",{className:"text-base md:text-lg lg:text-xl",children:"üé¥"})," MENU"]})}),playerButton:e.jsx(C,{variant:"ghost",size:"sm",asChild:!0,"aria-label":"„Éó„É¨„Ç§„É§„ÉºÁÆ°ÁêÜ",className:"text-xs md:text-sm lg:text-base",children:e.jsxs(re,{to:"/player",title:"„Éó„É¨„Ç§„É§„ÉºÁÆ°ÁêÜ",children:[e.jsx("span",{className:"text-base md:text-lg lg:text-xl",children:"üßô"})," PLAYER"]})}),rulesButton:e.jsx(C,{variant:"ghost",size:"sm",asChild:!0,"aria-label":"Êéü„ÇíÁ¢∫Ë™ç",className:"text-xs md:text-sm lg:text-base",children:e.jsxs(re,{to:"/intro",title:"Êéü„ÇíÁ¢∫Ë™ç",children:[e.jsx("span",{className:"text-base md:text-lg lg:text-xl",children:"üìú"})," Êéü"]})}),repoStateIndicator:e.jsx(ca,{state:a,onClick:t}),themeToggle:e.jsx(la,{})})}const B=Gt.forSessionStorage(Kt.PROTOPEDIA_API_V2_TOKEN);function ga(){const[a,t]=d.useState(null),[s,r]=d.useState(!1),[n,o]=d.useState(!0);d.useEffect(()=>{(async()=>{try{const m=await B.get();t(m),r(await B.has())}catch(m){console.error("[useToken] Failed to load token from storage",m)}finally{o(!1)}})()},[]);const i=d.useCallback(async c=>{await B.save(c),t(c),r(!0)},[]),l=d.useCallback(async()=>{await B.remove(),t(null),r(!1)},[]);return{token:a,hasToken:s,isLoading:n,saveToken:i,removeToken:l}}function pa(a=5){const t=[],s=new Set;for(let r=0;r<a;r++){let n;do n=T.number.int({min:1,max:1e5});while(s.has(n));s.add(n),t.push({id:n,prototypeNm:T.commerce.productName(),summary:T.commerce.productDescription(),freeComment:T.lorem.paragraph(),systemDescription:T.lorem.sentence(),mainUrl:T.image.url(),users:[T.person.fullName()],tags:T.helpers.arrayElements(["IoT","AI","Robot","Education","Healthcare","Entertainment"],{min:1,max:3}),materials:[],events:[],awards:[],teamNm:T.company.name(),createDate:T.date.past().toISOString(),updateDate:void 0,releaseDate:void 0,officialLink:void 0,videoUrl:void 0,relatedLink:void 0,relatedLink2:void 0,relatedLink3:void 0,relatedLink4:void 0,relatedLink5:void 0,viewCount:T.number.int({min:0,max:1e4}),goodCount:T.number.int({min:0,max:1e3}),commentCount:T.number.int({min:0,max:100}),releaseFlg:1,status:1,createId:void 0,updateId:void 0,uuid:void 0,nid:void 0,revision:void 0,licenseType:void 0,thanksFlg:void 0,slideMode:void 0})}return t}class xa{allPrototypes;filteredPrototypes;events=new Nt.EventEmitter;constructor(){const t=performance.now();this.allPrototypes=pa(1e4);const r=performance.now()-t;this.filteredPrototypes=this.allPrototypes,console.debug(`[DummyRepository] Generated 10000 prototypes in ${r.toFixed(2)}ms`),console.info("[DummyRepository] Initialized with 10000 dummy prototypes")}getConfig(){return{ttlMs:1/0,maxDataSizeBytes:30*1024*1024,logLevel:"info"}}getStats(){return{size:this.filteredPrototypes.length,cachedAt:new Date,isExpired:!1,remainingTtlMs:1/0,dataSizeBytes:0,refreshInFlight:!1}}async setupSnapshot(t){console.info("[DummyRepository] setupSnapshot called with params:",t),this.events.emit("snapshotStarted","setup");const s=performance.now(),r=this.allPrototypes.filter(u=>!(t.userNm&&!u.users.some(g=>g===t.userNm)||t.materialNm&&!u.materials.some(g=>g===t.materialNm)||t.tagNm&&!u.tags.some(g=>g===t.tagNm)||t.eventNm&&!u.events.some(g=>g===t.eventNm))),n=t.offset??0,o=t.limit??r.length,i=r.slice(n,n+o);this.filteredPrototypes=i;const c=performance.now()-s;console.debug(`[DummyRepository] Filtering took ${c.toFixed(2)}ms`),console.info(`[DummyRepository] Filtered ${this.allPrototypes.length} -> ${r.length} -> ${i.length} prototypes`);const m=this.getStats();return this.events.emit("snapshotCompleted",m),{ok:!0,stats:m}}async refreshSnapshot(){console.info("[DummyRepository] refreshSnapshot called (no-op)"),this.events.emit("snapshotStarted","refresh");const t=this.getStats();return this.events.emit("snapshotCompleted",t),{ok:!0,stats:t}}async analyzePrototypes(){if(this.filteredPrototypes.length===0)return{min:null,max:null};let t=this.filteredPrototypes[0].id,s=this.filteredPrototypes[0].id;for(const r of this.filteredPrototypes)r.id<t&&(t=r.id),r.id>s&&(s=r.id);return{min:t,max:s}}async getAllFromSnapshot(){return this.filteredPrototypes}async getPrototypeIdsFromSnapshot(){return this.filteredPrototypes.map(t=>t.id)}async getPrototypeFromSnapshotByPrototypeId(t){return this.filteredPrototypes.find(s=>s.id===t)??null}async getRandomPrototypeFromSnapshot(){if(this.filteredPrototypes.length===0)return null;const t=Math.floor(Math.random()*this.filteredPrototypes.length);return this.filteredPrototypes[t]??null}async getRandomSampleFromSnapshot(t){if(t<=0||this.filteredPrototypes.length===0)return[];const s=[...this.filteredPrototypes].sort(()=>Math.random()-.5);return s.slice(0,Math.min(t,s.length))}dispose(){console.info("[DummyRepository] dispose called (no-op)")}}let ne=null;function ha(){return ne||(ne=new xa),ne}class O{static instance=null;repository=null;tokenStatus="not-validated";error=null;initPromise=null;initPromiseId=0;storage;constructor(t=B){this.storage=t}static getInstance(t=B){return O.instance||(O.instance=new O(t)),O.instance}isDummyMode(){return!1}getState(){if(!this.repository)return this.tokenStatus==="invalid"?{type:"token-invalid",error:this.error||"Unknown error"}:{type:"not-created"};switch(this.tokenStatus){case"not-validated":return{type:"validating"};case"valid":return{type:"created-token-valid",repository:this.repository};case"invalid":return{type:"token-invalid",error:this.error||"Unknown error"}}}reset(){this.repository=null,this.tokenStatus="not-validated",this.error=null,this.initPromise=null,this.initPromiseId++}static resetInstance(){O.instance=null}createRepository(t){return Ut({protopediaApiToken:t,logLevel:"debug"})}async setupSnapshot(t,s){return await t.setupSnapshot(s)}async validateRepository(t){return await t.setupSnapshot({limit:0})}getDummyRepository(){return this.repository||(this.repository=ha(),this.tokenStatus="valid",console.info("[PromidasRepositoryManager] Created dummy repository (VITE_USE_DUMMY_DATA=true)")),this.repository}async getRepository(){if(this.isDummyMode())return this.getDummyRepository();const t=this.getState();if(t.type==="created-token-valid")return t.repository;if(this.initPromise)return this.initPromise;const s=this.initPromiseId;return this.initPromise=(async()=>{try{const r=await this.storage.get();if(!r)throw new Error("ProtoPedia API token is missing. Provide a token via the in-app Token UI.");if(r.trim()==="")throw this.repository=null,this.tokenStatus="invalid",this.error="Token is empty",new Error("Token is empty");let n;try{n=this.createRepository(r),this.initPromiseId===s&&(this.repository=n,this.tokenStatus="not-validated",this.error=null)}catch(i){console.error("Failed to create Promidas repository:",i);const l=i instanceof Error?Ht(i):"‰∏çÊòé„Å™„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ";throw this.initPromiseId===s&&(this.repository=null,this.tokenStatus="invalid",this.error=l),new Error(l)}const o=await this.validateRepository(n);if(!o.ok){console.error("Token validation failed:",o);const l=Wt(o)?.localizedMessage||"‰∏çÊòé„Å™„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ";throw console.info("Parsed token validation error:",l),this.initPromiseId===s&&(this.repository=null,this.tokenStatus="invalid",this.error=l),new Error(l)}return this.initPromiseId===s&&(this.tokenStatus="valid",this.error=null),n}finally{this.initPromiseId===s&&(this.initPromise=null)}})(),this.initPromise}}function fa(){return O.getInstance()}const $=fa(),Le=d.forwardRef(({className:a,type:t,...s},r)=>e.jsx("input",{type:t,className:N("border-input bg-background file:text-foreground placeholder:text-muted-foreground focus-visible:ring-ring flex h-9 w-full rounded-md border px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:ring-1 focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",a),ref:r,...s}));Le.displayName="Input";const A=d.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:N("bg-card text-card-foreground rounded-xl border shadow",a),...t}));A.displayName="Card";const z=d.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:N("flex flex-col space-y-1.5 p-6",a),...t}));z.displayName="CardHeader";const G=d.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:N("leading-none font-semibold tracking-tight",a),...t}));G.displayName="CardTitle";const q=d.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:N("text-muted-foreground text-sm",a),...t}));q.displayName="CardDescription";const M=d.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:N("p-6 pt-0",a),...t}));M.displayName="CardContent";const _e=d.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:N("flex items-center p-6 pt-0",a),...t}));_e.displayName="CardFooter";function ya({inputValue:a,showToken:t,hasToken:s,isValidating:r,repoState:n,onInputChange:o,onToggleShowToken:i,onSave:l,onRemove:c,screenSize:m}){const u=m?{smartphone:"p-3",tablet:"p-4",pc:"p-6"}[m]:"p-3 md:p-4 lg:p-6",g=m?{smartphone:"text-base",tablet:"text-lg",pc:"text-xl"}[m]:"text-base md:text-lg lg:text-xl",y=m?{smartphone:"text-xs",tablet:"text-sm",pc:"text-sm"}[m]:"text-xs md:text-sm",v=m?{smartphone:"space-y-2",tablet:"space-y-3",pc:"space-y-3"}[m]:"space-y-2 md:space-y-3",w=()=>r?e.jsx("p",{className:"text-muted-foreground text-xs",children:"Token„ÇíÁ¢∫Ë™ç‰∏≠..."}):n.type==="created-token-valid"?e.jsx("p",{className:"text-muted-foreground text-xs",children:"Token„ÅØÊúâÂäπ„Åß„Åô"}):n.type==="token-invalid"?e.jsx("p",{className:"text-destructive text-xs",children:"Token„ÅåÁÑ°Âäπ„Åß„Åô„ÄÇ„ÇÇ„Åó„Åè„ÅØAPI„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì„ÄÇ"}):null,h=()=>s?r?e.jsx(Rt,{className:"animate-spin",size:20}):n.type==="created-token-valid"?e.jsx(Et,{className:"text-green-600",size:20}):n.type==="token-invalid"?e.jsx(It,{className:"text-destructive",size:20}):null:e.jsx(Ee,{className:"text-muted-foreground",size:20});return e.jsxs(A,{className:"w-full max-w-sm",children:[e.jsx(z,{className:u,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(G,{className:g,children:"API Token"}),e.jsx(q,{className:y,children:"ProtoPedia API„Éà„Éº„ÇØ„É≥„ÇíË®≠ÂÆö"})]}),h()]})}),e.jsx(M,{className:u,children:e.jsxs("form",{className:v,onSubmit:j=>{j.preventDefault(),l()},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{type:t?"text":"password",id:"protopedia-api-token",name:"protopedia-api-token",value:a,onChange:j=>o(j.target.value),placeholder:"„Éà„Éº„ÇØ„É≥„ÇíÂÖ•Âäõ",autoComplete:"on"}),e.jsx(C,{type:"button",variant:"outline",size:"icon",onClick:i,"aria-label":t?"Hide token":"Show token",children:t?e.jsx(Pt,{size:18}):e.jsx(Ct,{size:18})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{type:"submit",className:"flex-1",disabled:!a.trim()||r,children:"‰∏ÄÊôÇÁöÑ„Å´‰øùÂ≠ò"}),s&&e.jsx(C,{type:"button",variant:"destructive",className:"flex-1",onClick:c,children:"ÂâäÈô§"})]}),w()]})}),e.jsx(_e,{className:u,children:e.jsxs("p",{className:`text-muted-foreground ${y}`,children:["„Éà„Éº„ÇØ„É≥„ÅØ"," ",e.jsx("a",{href:"https://protopedia.net",target:"_blank",rel:"noopener noreferrer",className:"hover:text-primary font-semibold underline underline-offset-4",children:"ProtoPedia"})," ","„ÅßÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ"]})})]})}function ba({screenSize:a}){const{token:t,hasToken:s,saveToken:r,removeToken:n}=ga(),[o,i]=d.useState(""),[l,c]=d.useState(!1),[m,u]=d.useState(!1),[g,y]=d.useState({type:"not-created"});d.useEffect(()=>{i(t||"")},[t]),d.useEffect(()=>{if(!s){y({type:"not-created"});return}const f=$.getState();y(f)},[s]);const v=async()=>{if(o.trim()){$.reset(),await r(o.trim()),u(!0);try{await $.getRepository();const f=$.getState();console.log("[TokenManager] Repository state after validation:",f),y(f)}catch(f){const p=f instanceof Error?f.message:String(f);console.error("[TokenManager] Validation failed:",p),y({type:"token-invalid",error:p})}finally{u(!1)}}},w=async()=>{await n(),$.reset(),i(""),y({type:"not-created"})},h=f=>{i(f)},j=()=>{c(!l)};return e.jsx(ya,{inputValue:o,showToken:l,hasToken:s,isValidating:m,repoState:g,onInputChange:h,onToggleShowToken:j,onSave:v,onRemove:w,screenSize:a})}function va(){const[a,t]=d.useState(null),[s,r]=d.useState("not-stored");return d.useEffect(()=>{const o=async()=>{if($.getState().type!=="created-token-valid"){t(null),r("not-stored");return}try{const m=(await $.getRepository()).getStats();t(m),r(Vt(m))}catch{t(null),r("not-stored")}};o();const i=setInterval(()=>{o()},1e4);return()=>clearInterval(i)},[]),{storeState:s,stats:a,isReady:s==="stored"}}const ka=ge("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function _({className:a,variant:t,...s}){return e.jsx("div",{className:N(ka({variant:t}),a),...s})}function wa({repoState:a,repoError:t,storeState:s,storeStats:r,useDummyData:n,screenSize:o}){const i=o?{smartphone:"p-3",tablet:"p-4",pc:"p-6"}[o]:"p-3 md:p-4 lg:p-6",l=o?{smartphone:"text-sm",tablet:"text-base",pc:"text-base"}[o]:"text-sm md:text-base",c=o?{smartphone:"text-xs",tablet:"text-sm",pc:"text-sm"}[o]:"text-xs md:text-sm",m=o?{smartphone:"space-y-3",tablet:"space-y-4",pc:"space-y-4"}[o]:"space-y-3 md:space-y-4",u=h=>{switch(h.type){case"not-created":return"Êú™ÂàùÊúüÂåñ";case"validating":return"Ê§úË®º‰∏≠";case"token-invalid":return"ÁÑ°Âäπ";case"created-token-valid":return"ÊúâÂäπ"}},g=h=>{switch(h.type){case"not-created":return"bg-muted text-muted-foreground";case"validating":return"bg-blue-600 text-white dark:bg-blue-700";case"token-invalid":return"bg-destructive text-destructive-foreground";case"created-token-valid":return"bg-green-600 text-white dark:bg-green-700"}},y=h=>{switch(h){case"not-stored":return"Êú™‰øùÂ≠ò";case"stored":return"‰øùÂ≠òÊ∏à„Åø";case"expired":return"ÊúüÈôêÂàá„Çå"}},v=h=>{switch(h){case"not-stored":return"bg-muted text-muted-foreground";case"stored":return"bg-blue-600 text-white dark:bg-blue-700";case"expired":return"bg-yellow-600 text-white dark:bg-yellow-700"}},w=h=>{if(h<=0)return"0Áßí";const j=Math.floor(h/1e3),f=Math.floor(j/60),p=Math.floor(f/60);return p>0?`${p}ÊôÇÈñì${f%60}ÂàÜ`:f>0?`${f}ÂàÜ${j%60}Áßí`:`${j}Áßí`};return n?e.jsxs(A,{className:"w-full max-w-md",children:[e.jsxs(z,{className:i,children:[e.jsx(G,{className:l,children:"PROMIDAS Repository"}),e.jsx(q,{className:c,children:"„ÉÄ„Éü„Éº„Éá„Éº„Çø„É¢„Éº„Éâ"})]}),e.jsx(M,{className:i,children:e.jsx("p",{className:`text-muted-foreground ${c}`,children:"Áí∞Â¢ÉÂ§âÊï∞ VITE_USE_DUMMY_DATA=true „ÅÆ„Åü„ÇÅ„ÄÅ ÂÆüÈöõ„ÅÆRepository„ÅØ‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ"})})]}):e.jsxs(A,{className:"w-full max-w-md",children:[e.jsxs(z,{className:i,children:[e.jsx(G,{className:l,children:"PROMIDAS Repository"}),e.jsx(q,{className:c,children:"Repository & Store Áä∂ÊÖã"})]}),e.jsxs(M,{className:`${i} ${m}`,children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`${c} font-medium`,children:"Repository"}),e.jsx(_,{variant:"outline",className:g(a),children:u(a)})]}),t&&e.jsx("p",{className:"text-destructive text-xs",children:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`${c} font-medium`,children:"Store"}),e.jsx(_,{variant:"outline",className:v(s),children:y(s)})]}),r&&s!=="not-stored"&&e.jsxs("div",{className:`text-muted-foreground space-y-1 ${c}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"„Éó„É≠„Éà„Çø„Ç§„ÉóÊï∞:"}),e.jsxs("span",{className:"font-mono",children:[r.size,"‰ª∂"]})]}),r.cachedAt&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"„Ç≠„É£„ÉÉ„Ç∑„É•Êó•ÊôÇ:"}),e.jsx("span",{className:"font-mono",children:new Date(r.cachedAt).toLocaleTimeString("ja-JP")})]}),s==="stored"&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ÊÆã„ÇäÊôÇÈñì:"}),e.jsx("span",{className:"font-mono",children:w(r.remainingTtlMs)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"„Éá„Éº„Çø„Çµ„Ç§„Ç∫:"}),e.jsxs("span",{className:"font-mono",children:[(r.dataSizeBytes/1024).toFixed(1)," KB"]})]})]})]})]})]})}function ja({screenSize:a}){const[t,s]=d.useState({type:"not-created"}),[r,n]=d.useState(null),{storeState:o,stats:i}=va(),l=!1;return d.useEffect(()=>{const c=()=>{const u=$.getState();s(u),n(u.type==="token-invalid"?u.error:null)};c();const m=setInterval(c,5e3);return()=>clearInterval(m)},[]),e.jsx(wa,{repoState:t,repoError:r,storeState:o,storeStats:i,useDummyData:l,screenSize:a})}function Oe({screenSize:a}){return e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(ba,{screenSize:a}),e.jsx(ja,{screenSize:a})]})}const Sa=At,Na=Dt,Ye=d.forwardRef(({className:a,...t},s)=>e.jsx(Te,{ref:s,className:N("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",a),...t}));Ye.displayName=Te.displayName;const Be=d.forwardRef(({className:a,children:t,...s},r)=>e.jsxs(Na,{children:[e.jsx(Ye,{}),e.jsxs($e,{ref:r,className:N("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] fixed top-[50%] left-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border p-6 shadow-lg duration-200 sm:rounded-lg",a),...s,children:[t,e.jsxs(Tt,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-sm opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-none disabled:pointer-events-none",children:[e.jsx($t,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Be.displayName=$e.displayName;const Ge=({className:a,...t})=>e.jsx("div",{className:N("flex flex-col space-y-1.5 text-center sm:text-left",a),...t});Ge.displayName="DialogHeader";const Ke=d.forwardRef(({className:a,...t},s)=>e.jsx(Ae,{ref:s,className:N("text-lg leading-none font-semibold tracking-tight",a),...t}));Ke.displayName=Ae.displayName;const Ue=d.forwardRef(({className:a,...t},s)=>e.jsx(Me,{ref:s,className:N("text-muted-foreground text-sm",a),...t}));Ue.displayName=Me.displayName;function Pa({open:a,onOpenChange:t,autoCloseOnValid:s=!1,screenSize:r}){return d.useEffect(()=>{if(!a||!s)return;const n=setInterval(()=>{const o=$.getState();console.debug("[RepoSetupDialog] Checking repo state:",o),o.type==="created-token-valid"&&t(!1)},500);return()=>clearInterval(n)},[a,s,t]),e.jsx(Sa,{open:a,onOpenChange:t,children:e.jsxs(Be,{className:"max-w-4xl",children:[e.jsxs(Ge,{children:[e.jsx(Ke,{children:"Setup PROMIDAS Repository"}),e.jsx(Ue,{children:"Configure your PROMIDAS API token to access prototype data."})]}),e.jsx(Oe,{screenSize:r})]})})}function Ca(){const a=()=>{if(typeof window>"u")return"smartphone";const r=window.innerWidth;return r>=1024?"pc":r>=768?"tablet":"smartphone"},[t,s]=d.useState(a);return d.useEffect(()=>{if(typeof window>"u")return;const r=()=>{s(a())};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),t}const He=d.createContext(void 0);function Ra({children:a}){const t=Ca();return e.jsx(He.Provider,{value:t,children:a})}function pe(){const a=d.useContext(He);if(a===void 0)throw new Error("useScreenSizeContext must be used within ScreenSizeProvider");return a}const Ea=[["7","8","9","0","u","i","o","p","j","k","l",";","m",",",".","/"],["1","2","3","4","q","w","e","r","a","s","d","f","z","x","c","v"]],Ia=[["j","k","l",";","m",",",".","/"],["a","s","d","f","z","x","c","v"],["7","8","9","0","u","i","o","p"],["1","2","3","4","q","w","e","r"]];function We(a,t=2){return(t>=3?Ia:Ea)[a]}function Da(a,t,s=2){return We(a,s)?.[t]}const oe=[4,8],Ta=8,ie=[4,8,12,16];class H{static async setupSnapshotFromRecipe(t,s){if(!t||!t.apiParams)throw new Error("Invalid recipe: apiParams is required");return console.debug("[INFO] API Params:",t.apiParams),await s.setupSnapshot(t.apiParams)}static createDeck(t){if(!Array.isArray(t))throw new Error("Invalid input: prototypes must be an array");const s=new Map,r=new Set;for(const n of t){if(!n||typeof n.id!="number")throw new Error("Invalid prototype: missing or invalid ID");if(r.has(n.id))throw new Error(`Duplicate prototype ID detected: ${n.id}`);r.add(n.id),s.set(n.id,n)}return s}static createDeckWithFilter(t,s){const r=[...t];if(s!=null){console.debug("[DEBUG] createDeckWithFilter - Applying filter to prototypes before deck creation");const n=s(r);return console.debug("[DEBUG] createDeckWithFilter - Prototypes count after filtering:",{before:r.length,after:n.length}),this.createDeck(n)}return this.createDeck(r)}static async getPrototypesFromRecipe(t,s){const r=await this.setupSnapshotFromRecipe(t,s);if(!r.ok)throw new Error(`Failed to fetch prototypes from repository: ${r.message}`);const n=await s.getAllFromSnapshot();return console.log(`[INFO] Retrieved ${n.length} prototypes from snapshot`),n}static getIds(t){return[...t.keys()].sort((s,r)=>s-r)}static getPrototypes(t){return[...t.values()]}static getById(t,s){return t.get(s)}static getByIds(t,s){return s.map(r=>t.get(r)).filter(r=>r!==void 0)}static getSize(t){return t.size}static has(t,s){return t.has(s)}static async sha256(t){const s=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}static async createIdsHash(t){const r=[...t].sort((n,o)=>n-o).join(",");return await this.sha256(r)}static async createIdentifier(t,s){const r=this.getIds(t),n=`${s}:${r.join(",")}`;return{deckHash:await this.sha256(n)}}static async createMetaData(t,s,r){const n=this.getIds(t),o=await this.sha256(`${s}:${n.join(",")}`),i=await this.sha256(n.join(","));return{deckHash:o,deckIdsHash:i,title:r,fetchedAt:s,prototypeIds:n}}}function $a(a){const t={ÔΩ¶:"„É≤",ÔΩß:"„Ç°",ÔΩ®:"„Ç£",ÔΩ©:"„Ç•",ÔΩ™:"„Çß",ÔΩ´:"„Ç©",ÔΩ¨:"„É£",ÔΩ≠:"„É•",ÔΩÆ:"„Éß",ÔΩØ:"„ÉÉ",ÔΩ∞:"„Éº",ÔΩ±:"„Ç¢",ÔΩ≤:"„Ç§",ÔΩ≥:"„Ç¶",ÔΩ¥:"„Ç®",ÔΩµ:"„Ç™",ÔΩ∂:"„Ç´",ÔΩ∑:"„Ç≠",ÔΩ∏:"„ÇØ",ÔΩπ:"„Ç±",ÔΩ∫:"„Ç≥",ÔΩª:"„Çµ",ÔΩº:"„Ç∑",ÔΩΩ:"„Çπ",ÔΩæ:"„Çª",ÔΩø:"„ÇΩ",ÔæÄ:"„Çø",ÔæÅ:"„ÉÅ",ÔæÇ:"„ÉÑ",ÔæÉ:"„ÉÜ",ÔæÑ:"„Éà",ÔæÖ:"„Éä",ÔæÜ:"„Éã",Ôæá:"„Éå",Ôæà:"„Éç",Ôæâ:"„Éé",Ôæä:"„Éè",Ôæã:"„Éí",Ôæå:"„Éï",Ôæç:"„Éò",Ôæé:"„Éõ",Ôæè:"„Éû",Ôæê:"„Éü",Ôæë:"„É†",Ôæí:"„É°",Ôæì:"„É¢",Ôæî:"„É§",Ôæï:"„É¶",Ôæñ:"„É®",Ôæó:"„É©",Ôæò:"„É™",Ôæô:"„É´",Ôæö:"„É¨",Ôæõ:"„É≠",Ôæú:"„ÉØ",Ôæù:"„É≥",Ôæû:"„Çõ",Ôæü:"„Çú"},s={„Ç´:"„Ç¨",„Ç≠:"„ÇÆ",„ÇØ:"„Ç∞",„Ç±:"„Ç≤",„Ç≥:"„Ç¥",„Çµ:"„Ç∂",„Ç∑:"„Ç∏",„Çπ:"„Ç∫",„Çª:"„Çº",„ÇΩ:"„Çæ",„Çø:"„ÉÄ",„ÉÅ:"„ÉÇ",„ÉÑ:"„ÉÖ",„ÉÜ:"„Éá",„Éà:"„Éâ",„Éè:"„Éê",„Éí:"„Éì",„Éï:"„Éñ",„Éò:"„Éô",„Éõ:"„Éú"},r={„Éè:"„Éë",„Éí:"„Éî",„Éï:"„Éó",„Éò:"„Éö",„Éõ:"„Éù"};return a.replace(/[\uFF61-\uFF9F]/g,n=>t[n]||n).replace(/([„Ç´-„Ç≥„Çµ-„ÇΩ„Çø-„Éà„Éè-„Éõ])„Çõ/g,(n,o)=>s[o]||o+"„Çõ").replace(/([„Éè-„Éõ])„Çú/g,(n,o)=>r[o]||o+"„Çú")}function Aa(a){return a.replace(/[\uFF10-\uFF19\uFF21-\uFF3A\uFF41-\uFF5A]/g,t=>String.fromCharCode(t.charCodeAt(0)-65248))}function le(a){return $a(Aa(a)).toLowerCase()}const xe={offset:0,limit:1e4},Ma={id:"all-prototypes",title:"üåê ÂÖ®‰ΩúÂìÅ",description:"ÂÖ®„Å¶„ÅÆ‰ΩúÂìÅ",apiParams:{...xe},difficulty:"beginner",tags:[]};function Fa(a,t=1e3){const s=[];for(let r=1;r<=a;r++){const n=(r-1)*t,o=n+1,i=n+t;s.push({id:`Deck-rande-${r}`,title:`Deck-${r}`,description:`${o.toLocaleString()} - ${i.toLocaleString()}`,apiParams:{offset:n,limit:t},difficulty:"beginner",tags:[]})}return s}function za(a){return a.map(t=>({id:`rel-${t}`,title:`üéâ ${t}`,description:`${t}Âπ¥Áîü„Åæ„Çå`,apiParams:{...xe},difficulty:"intermediate",tags:["„É™„É™„Éº„Çπ"],filter:La(t)}))}function La(a){return t=>t.filter(s=>{if(!s.releaseDate)return!1;const n=new Date(s.releaseDate).getFullYear()===a;return n&&console.debug(`‚úÖ DeckRecipe releaseDate filter matched: ${a} in ${s.id} - ${s.prototypeNm} (${s.releaseDate})`),n})}function he(a){const t=a.map(s=>le(s));return s=>s.filter(r=>{const n=le(r.prototypeNm),o=le(r.summary);let i=t.find(l=>n.includes(l));return i||(i=t.find(l=>o.includes(l))),i&&console.debug(`‚úÖ DeckRecipe filter matched: "${i}" in ${r.id} - ${r.prototypeNm}`),!!i})}const fe={apiParams:{...xe},difficulty:"intermediate",tags:["Âπ≤ÊîØ"]},_a={...fe,id:"eto-mi",title:"üêç Â∑≥",description:"„Å∏„Å≥„Å´„Å°„Å™„Çì„Å†‰ΩúÂìÅ",filter:he(["üêç","SNAKE","HEBI","HEAVY","„Å∏„Å≥","„Éò„Éì","„Çπ„Éç„Éº„ÇØ","Â∑≥","Ëõá"])},Oa={...fe,id:"eto-uma",title:"üê¥ UMA",description:"„ÅÜ„Åæ„Å´„Å°„Å™„Çì„Å†‰ΩúÂìÅ",filter:he(["üê¥","HORSE","UMA","„ÅÜ„Åæ","„Ç¶„Éû","„Éõ„Éº„Çπ","Âçà","È¶¨"])},Ya={...fe,id:"eto-hitsuji",title:"üêè Êú™",description:"„Å≤„Å§„Åò„Å´„Å°„Å™„Çì„Å†‰ΩúÂìÅ",filter:he(["üêè","SHEEP","HITSUJI","„Å≤„Å§„Åò","„Éí„ÉÑ„Ç∏","„É©„É†","„Ç∏„É≥„ÇÆ„Çπ„Ç´„É≥","Áæä"])};class Ve{static rangeRecipes=Fa(7);static releaseYearRecipes=za([2027,2026,2025,2024,2023,2022,2021,2020,2019,2018,2017,2016,2015,2014]);static RECIPES=[_a,Oa,Ya,...this.releaseYearRecipes,Ma,...this.rangeRecipes];static findById(t){return this.RECIPES.find(s=>s.id===t)}static getAll(){return[...this.RECIPES]}static filterByDifficulty(t){return this.RECIPES.filter(s=>s.difficulty===t)}static filterByTag(t){return this.RECIPES.filter(s=>s.tags.includes(t))}}class de{static RECIPES=[{id:"standard-10",title:"10",description:"10ÁµÑ„ÅÆÊú≠„Çí‰ΩøÁî®",tags:[],difficulty:"beginner",sortMethod:"random",maxSize:10},{id:"standard-20",title:"20",description:"20ÁµÑ„ÅÆÊú≠„Çí‰ΩøÁî®",tags:[],difficulty:"beginner",sortMethod:"random",maxSize:20},{id:"standard-30",title:"30",description:"30ÁµÑ„ÅÆÊú≠„Çí‰ΩøÁî®",tags:[],difficulty:"beginner",sortMethod:"random",maxSize:30},{id:"all-random",title:"ALL",description:"ÂÖ®„Å¶„ÅÆÊú≠„Çí‰ΩøÁî®",tags:[],difficulty:"advanced",sortMethod:"random",maxSize:"all"}];static findById(t){return this.RECIPES.find(s=>s.id===t)}static getAll(){return[...this.RECIPES]}static filterByDifficulty(t){return this.RECIPES.filter(s=>s.difficulty===t)}static filterByTag(t){return this.RECIPES.filter(s=>s.tags.includes(t))}}class ce{static generate(t,s){const r=Array.from(t.keys());let n;switch(s.sortMethod){case"random":n=this.shuffle(r);break;case"id-asc":n=[...r].sort((i,l)=>i-l);break;case"id-desc":n=[...r].sort((i,l)=>l-i);break;default:throw new Error(`Unknown sortMethod: ${s.sortMethod}`)}if(s.maxSize==="all")return n;if(typeof s.maxSize!="number"||s.maxSize<=0)throw new Error('maxSize must be positive number or "all"');const o=Math.min(s.maxSize,n.length);return n.slice(0,o)}static shuffle(t){const s=[...t];for(let r=s.length-1;r>0;r--){const n=Math.floor(Math.random()*(r+1));[s[r],s[n]]=[s[n],s[r]]}return s}static getSize(t){return t.length}static isEmpty(t){return t.length===0}static pop(t,s){if(s<=0)return{popped:[],remaining:t};const r=Math.min(s,t.length);return{popped:t.slice(0,r),remaining:t.slice(r)}}}const Ba=de.RECIPES;class E{static STORAGE_KEY="PP_KARUTA_PLAYERS";static storage=null;static MAX_PLAYERS=50;static getStorage(){return this.storage||(this.storage=Xt.forLocalStorage(this.STORAGE_KEY)),this.storage}static createPlayers(t){if(typeof t!="number"||t<1||t>this.MAX_PLAYERS)throw new Error(`Player count must be between 1 and ${this.MAX_PLAYERS}`);return Array.from({length:t},(s,r)=>this.createPlayer(`player-${r+1}`,`Player ${r+1}`))}static createPlayer(t,s){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Player id must be a non-empty string");if(!s||typeof s!="string"||s.trim()==="")throw new Error("Player name must be a non-empty string");return{id:t.trim(),name:s.trim()}}static validatePlayersForGame(t,s){if(!Array.isArray(t))throw new Error("Players must be an array");if(t.length===0)throw new Error("Players array must not be empty");if(t.length>s)throw new Error(`Maximum ${s} players allowed in a game`);const r=new Set;for(const n of t){if(!n||typeof n!="object")throw new Error("Each player must be an object");if(!n.id||typeof n.id!="string")throw new Error("Each player must have a valid id");if(r.has(n.id))throw new Error(`Duplicate player id: ${n.id}`);r.add(n.id)}}static validatePlayers(t){if(!Array.isArray(t))throw new Error("Players must be an array");if(t.length===0)throw new Error("Players array must not be empty");if(t.length>this.MAX_PLAYERS)throw new Error(`Maximum ${this.MAX_PLAYERS} players allowed`);const s=new Set;for(const r of t){if(!r||typeof r!="object")throw new Error("Each player must be an object");if(!r.id||typeof r.id!="string")throw new Error("Each player must have a valid id");if(s.has(r.id))throw new Error(`Duplicate player id: ${r.id}`);s.add(r.id)}}static async savePlayers(t){this.validatePlayers(t),await this.getStorage().save(JSON.stringify(t))}static async loadPlayers(){const s=await this.getStorage().get();if(!s)return null;try{const r=JSON.parse(s);return this.validatePlayers(r),r}catch(r){throw new Error(`Failed to load players from storage: ${r instanceof Error?r.message:"Unknown error"}`)}}static async hasPlayers(){return await this.getStorage().has()}static async removePlayers(){await this.getStorage().remove()}static async initialize(){const t=await this.loadPlayers();if(t&&t.length>0)return t;const s=this.createPlayers(1);return await this.savePlayers(s),s}}class Ga{static PLAY_MODES=["keyboard","touch"];static DEFAULT_PLAY_MODE="keyboard";static isValidPlayMode(t){return typeof t=="string"&&this.PLAY_MODES.includes(t)}static validatePlayMode(t){if(!this.isValidPlayMode(t))throw new Error(`Invalid PlayMode: ${t}. Must be one of: ${this.PLAY_MODES.join(", ")}`)}static getDisplayInfo(t){switch(t){case"keyboard":return{title:"Keyboard",description:"„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Ç≠„Éº„ÅßÊìç‰Ωú„Åó„Åæ„Åô„ÄÇÂÖ±ÈÄö„ÅÆTatami„Ç®„É™„Ç¢„Çí‰ΩøÁî®„Åó„ÄÅÂêÑ„Éó„É¨„Ç§„É§„Éº„Å´Â∞ÇÁî®„ÅÆ„Ç≠„Éº„Éê„Ç§„É≥„Éâ„ÇíÂâ≤„ÇäÂΩì„Å¶„Åæ„Åô„ÄÇ",targetDevice:"PCÁí∞Â¢ÉÂêë„Åë"};case"touch":return{title:"Touch",description:"„Çø„ÉÉ„Éó„ÅßÊìç‰Ωú„Åó„Åæ„Åô„ÄÇÂêÑ„Éó„É¨„Ç§„É§„Éº„Å´Â∞ÇÁî®„ÅÆTatami„Ç®„É™„Ç¢„ÇíË°®Á§∫„Åó„ÄÅËá™ÂàÜ„ÅÆ„Ç®„É™„Ç¢„ÅÆ„Åø„Çø„ÉÉ„ÉóÂèØËÉΩ„Åß„Åô„ÄÇ",targetDevice:"„É¢„Éê„Ç§„É´/„Çø„Éñ„É¨„ÉÉ„ÉàÂêë„Åë"}}}static requiresSeparateTatami(t){return t==="touch"}static getRecommendedPlayMode(){return"ontouchstart"in window||navigator.maxTouchPoints>0?"touch":"keyboard"}}class U{static MAX_GAME_PLAYERS=4;static createInitialState(t,s,r,n,o=5){if(t.size===0)throw new Error("Deck must not be empty");E.validatePlayersForGame(s,this.MAX_GAME_PLAYERS),Ga.validatePlayMode(r);const i=ce.generate(t,n),l=Math.min(o,i.length),c=i.slice(0,l),m=i.slice(l),u=s.map(g=>({player:g,tatami:[...c],mochiFuda:[],score:0}));return{deck:t,stack:m,tatami:c,playerStates:u,readingOrder:i}}}const J=ot({component:Ka});function Ka(){return e.jsx(Jt,{defaultTheme:"system",storageKey:"pp-karuta-theme",children:e.jsx(Ra,{children:e.jsx(Ua,{})})})}function Ua(){const a=pe(),[t,s]=d.useState(()=>$.getState()),[r,n]=d.useState(!1);d.useEffect(()=>{const i=setInterval(()=>{s($.getState())},1e3);return()=>clearInterval(i)},[]),d.useEffect(()=>{E.initialize().catch(i=>{console.error("Failed to initialize players:",i)})},[]);const o=a?{smartphone:"pt-12",tablet:"pt-14",pc:"pt-16"}[a]:"pt-12 md:pt-14 lg:pt-16";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-0 right-0 left-0 z-50",children:e.jsx(ua,{repoState:t,onRepoIndicatorClick:()=>n(!0),screenSize:a})}),e.jsxs("div",{className:o,children:[!1,e.jsx(Pa,{open:r,onOpenChange:()=>n(!1),autoCloseOnValid:!1,screenSize:a}),e.jsx(it,{})]})]})}const Ha=ge("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Z=d.forwardRef(({className:a,variant:t,...s},r)=>e.jsx("div",{ref:r,role:"alert",className:N(Ha({variant:t}),a),...s}));Z.displayName="Alert";const Wa=d.forwardRef(({className:a,...t},s)=>e.jsx("h5",{ref:s,className:N("mb-1 leading-none font-medium tracking-tight",a),...t}));Wa.displayName="AlertTitle";const Q=d.forwardRef(({className:a,...t},s)=>e.jsx("div",{ref:s,className:N("text-sm [&_p]:leading-relaxed",a),...t}));Q.displayName="AlertDescription";function Va({players:a,isLoading:t,error:s,onAddPlayer:r,onUpdatePlayer:n,onDeletePlayer:o}){return t?e.jsx("div",{className:"container mx-auto max-w-2xl p-4",children:e.jsxs(A,{children:[e.jsx(z,{children:e.jsx(G,{children:"„Éó„É¨„Ç§„É§„ÉºÁÆ°ÁêÜ"})}),e.jsx(M,{children:e.jsx("p",{children:"Ë™≠„ÅøËæº„Åø‰∏≠..."})})]})}):e.jsx("div",{className:"container mx-auto max-w-2xl p-4",children:e.jsxs(A,{children:[e.jsx(z,{children:e.jsx(G,{children:"„Éó„É¨„Ç§„É§„ÉºÁÆ°ÁêÜ"})}),e.jsxs(M,{children:[s&&e.jsx(Z,{variant:"destructive",className:"mb-4",children:e.jsx(Q,{children:s})}),e.jsx("div",{className:"space-y-4",children:a.map(i=>e.jsx(Xa,{player:i,onUpdate:n,onDelete:o,canDelete:a.length>1},i.id))}),e.jsxs("div",{className:"mt-4",children:[e.jsx(C,{onClick:r,disabled:a.length>=E.MAX_PLAYERS,className:"w-full",children:"+ „Éó„É¨„Ç§„É§„Éº„ÇíËøΩÂä†"}),a.length>=E.MAX_PLAYERS&&e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-500",children:["ÊúÄÂ§ß",E.MAX_PLAYERS,"‰∫∫„Åæ„ÅßÁôªÈå≤„Åß„Åç„Åæ„Åô"]})]})]})]})})}function Xa({player:a,onUpdate:t,onDelete:s,canDelete:r}){const[n,o]=d.useState(!1),[i,l]=d.useState(a.name),c=()=>{i.trim()&&(t(a.id,i),o(!1))},m=()=>{l(a.name),o(!1)};return e.jsx("div",{className:"flex items-center gap-2 rounded border p-3",children:n?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:i,onChange:u=>l(u.target.value),className:"flex-1 rounded border px-2 py-1 dark:bg-gray-800",autoFocus:!0,placeholder:"„Éó„É¨„Ç§„É§„ÉºÂêç","aria-label":"„Éó„É¨„Ç§„É§„ÉºÂêç",onKeyDown:u=>{u.key==="Enter"&&c(),u.key==="Escape"&&m()}}),e.jsx(C,{size:"sm",onClick:c,children:"‰øùÂ≠ò"}),e.jsx(C,{size:"sm",variant:"outline",onClick:m,children:"„Ç≠„É£„É≥„Çª„É´"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex-1 font-medium",children:a.name}),e.jsx(C,{size:"sm",variant:"outline",onClick:()=>o(!0),children:"Á∑®ÈõÜ"}),e.jsx(C,{size:"sm",variant:"destructive",onClick:()=>s(a.id),disabled:!r,children:"ÂâäÈô§"})]})})}function qa(){const[a,t]=d.useState([]),[s,r]=d.useState(!0),[n,o]=d.useState(null);d.useEffect(()=>{i()},[]);const i=async()=>{try{r(!0),o(null);const u=await E.initialize();t(u)}catch(u){const g=u instanceof Error?u.message:"Failed to load players";o(g),console.error("Failed to load players:",u)}finally{r(!1)}},l=d.useCallback(()=>{if(a.length>=E.MAX_PLAYERS){o(`Maximum ${E.MAX_PLAYERS} players allowed`);return}const u=`player-${Date.now()}`,g=E.createPlayer(u,`Player ${a.length+1}`),y=[...a,g];t(y),E.savePlayers(y).catch(v=>{console.error("Failed to save players:",v),o("Failed to save players")})},[a]),c=d.useCallback((u,g)=>{const y=a.map(v=>v.id===u?{...v,name:g.trim()}:v);t(y),E.savePlayers(y).catch(v=>{console.error("Failed to save players:",v),o("Failed to save players")})},[a]),m=d.useCallback(u=>{if(a.length<=1){o("At least one player must exist");return}const g=a.filter(y=>y.id!==u);t(g),E.savePlayers(g).catch(y=>{console.error("Failed to save players:",y),o("Failed to save players")})},[a]);return e.jsx(Va,{players:a,isLoading:s,error:n,onAddPlayer:l,onUpdatePlayer:c,onDeletePlayer:m})}const Ja=ue("/player")({component:Za});function Za(){return e.jsx(qa,{})}function Qa({onBack:a}){const[t,s]=d.useState("");return d.useEffect(()=>(document.body.classList.add("pp-karuta-intro-theme"),()=>{document.body.classList.remove("pp-karuta-intro-theme")}),[]),d.useEffect(()=>{fetch("/pp-karuta/INTRO.txt").then(n=>n.text()).then(n=>{const o=n.replace(/^---[\s\S]*?---\n\n/,"");s(o)}).catch(n=>{console.error("Failed to load INTRO.txt:",n),s("# Error loading INTRO.txt")})},[]),e.jsxs("div",{className:"intro-page",children:[e.jsx("div",{className:"protopedia-readme",children:e.jsx(Mt,{remarkPlugins:[Ft],children:t})}),e.jsx("button",{onClick:a,className:"back-button",children:"„Äê Â∏∞ÈÇÑ „Äë"})]})}const es=ue("/intro")({component:ts});function ts(){const a=me(),t=()=>{a({to:"/"})};return e.jsx(Qa,{onBack:t})}function as(a,t){return a.type!==t.type?!1:a.type==="token-invalid"&&t.type==="token-invalid"?a.error===t.error:a.type==="created-token-valid"&&t.type==="created-token-valid"?a.repository===t.repository:!0}function Xe(a=1e3){const[t,s]=d.useState($.getState());return d.useEffect(()=>{const r=setInterval(()=>{const n=$.getState();s(o=>as(o,n)?o:n)},a);return()=>clearInterval(r)},[a]),t}function ss({recipe:a,onSelect:t,isSelected:s=!1,isLoading:r=!1,isLoadingThisRecipe:n=!1,screenSize:o,showTags:i=!1}){const l=s?"bg-indigo-600 text-white dark:bg-indigo-500":"bg-white dark:bg-gray-800",c={title:s?"text-white dark:text-white":"text-gray-800 dark:text-gray-100",description:s?"text-white/90 dark:text-white/90":"text-gray-600 dark:text-gray-400"},m=o?{smartphone:{padding:"p-2",title:{size:"text-lg",margin:"mb-1"},description:{size:"text-xs",margin:"mb-1"},label:{size:"text-xs"},content:{size:"text-xs"}},tablet:{padding:"p-4",title:{size:"text-xl",margin:"mb-2"},description:{size:"text-sm",margin:"mb-2"},label:{size:"text-sm"},content:{size:"text-sm"}},pc:{padding:"p-6",title:{size:"text-2xl",margin:"mb-3"},description:{size:"text-sm",margin:"mb-3"},label:{size:"text-sm"},content:{size:"text-sm"}}}[o]:{padding:"p-4 md:p-6 lg:p-8",title:{size:"text-lg md:text-xl lg:text-2xl",margin:"mb-1 md:mb-2 lg:mb-3"},description:{size:"text-xs md:text-sm",margin:"mb-1 md:mb-2 lg:mb-3"}};return e.jsxs(C,{onClick:()=>t(a),disabled:r,variant:s?"default":"outline",className:`group relative h-auto overflow-hidden rounded-2xl shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-2xl active:scale-95 disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:scale-100 ${m.padding} ${l}`,children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/90 dark:bg-gray-800/90",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-4 border-indigo-500 border-t-transparent"}),e.jsx("span",{className:"text-sm font-semibold text-indigo-600 dark:text-indigo-400",children:"Loading..."})]})}),e.jsx("div",{className:"absolute inset-0 bg-linear-to-br from-blue-400 to-indigo-500 opacity-0 transition-opacity group-hover:opacity-10"}),e.jsxs("div",{className:"relative",children:[e.jsx("h2",{className:`font-bold wrap-break-word whitespace-normal ${m.title.size} ${m.title.margin} ${c.title}`,children:a.title}),a.description&&e.jsx("p",{className:`wrap-break-word whitespace-normal ${m.description.size} ${m.description.margin} ${c.description}`,children:a.description}),!1,i&&e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:a.tags.map(u=>e.jsx(_,{variant:"secondary",className:s?"bg-white/20 text-white hover:bg-white/30":"",children:u},u))})]})]})}function be({deck:a,showDetails:t=!1}){const s=Array.from(a.values()).slice(0,30);return e.jsx(Z,{className:"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950",children:e.jsxs(Q,{className:"text-green-800 dark:text-green-200",children:[e.jsxs("div",{className:"mb-2 font-semibold",children:["‚úì „Éá„ÉÉ„Ç≠: ",a.size.toLocaleString()," Êûö"]}),t&&s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.map(r=>e.jsxs(_,{variant:"outline",className:"bg-white text-xs dark:bg-gray-900",children:[e.jsx("span",{className:"font-mono text-gray-500 dark:text-gray-400",children:r.id}),e.jsx("span",{className:"ml-1 text-gray-700 dark:text-gray-300",children:r.prototypeNm})]},r.id))}),t&&a.size>30&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-400",children:["‰ªñ ",(a.size-30).toLocaleString()," ‰ª∂"]})]})})}const rs=zt,ns=Lt,os=_t;function is({deckRecipes:a,selectedDeckRecipe:t,onSelectDeckRecipe:s,isDeckLoading:r,loadingDeckRecipeId:n,generatedDeck:o,screenSize:i,enableGrouping:l=!0,initialOpenCategories:c}){const m=l?a.reduce((p,x)=>((x.tags.length>0?x.tags:["Êú™ÂàÜÈ°û"]).forEach(P=>{p[P]||(p[P]=[]),p[P].push(x)}),p),{}):null,[u,g]=d.useState(()=>m?Object.keys(m).reduce((p,x)=>(p[x]=c?.includes(x)??!1,p),{}):{}),y=p=>{g(x=>({...x,[p]:!x[p]}))},v=p=>e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-3 lg:grid-cols-4",children:p.map(x=>e.jsx(ss,{recipe:x,onSelect:s,isSelected:t?.id===x.id,isLoading:r,isLoadingThisRecipe:n===x.id,screenSize:i},x.id))});let w,h,j,f;switch(i){case"smartphone":w="px-3 py-2",h="text-sm",j="h-4 w-4",f="space-y-2";break;case"tablet":w="px-4 py-2.5",h="text-base",j="h-4 w-4",f="space-y-3";break;case"pc":w="px-4 py-3",h="text-base",j="h-5 w-5",f="space-y-4";break;default:w="px-4 py-2.5",h="text-base",j="h-4 w-4",f="space-y-3"}return e.jsxs(e.Fragment,{children:[o&&e.jsx(be,{deck:o,showDetails:!1}),l&&m?e.jsx("div",{className:f,children:Object.entries(m).map(([p,x])=>e.jsxs(rs,{open:u[p],onOpenChange:()=>y(p),children:[e.jsxs(ns,{className:`border-border bg-background/50 hover:bg-accent hover:border-accent-foreground/20 flex w-full items-center justify-between rounded-md border transition-all ${w}`,children:[e.jsx("h3",{className:`font-semibold ${h}`,children:p}),e.jsx(Ot,{className:`text-muted-foreground transition-transform duration-200 ${j} ${u[p]?"rotate-180":""}`})]}),e.jsx(os,{className:"pt-4",children:v(x)})]},p))}):v(a),o&&e.jsx(be,{deck:o,showDetails:!1})]})}function ls({selectedPlayMode:a,selectedDeckRecipe:t,generatedDeck:s,selectedStackRecipe:r,stackSize:n,selectedPlayerCount:o,screenSize:i}){const l=(()=>{switch(i){case"smartphone":return"p-3";case"tablet":return"p-4";case"pc":return"p-6"}})(),c=(()=>{switch(i){case"smartphone":return"text-base";case"tablet":return"text-lg";case"pc":return"text-xl"}})(),m=(()=>{switch(i){case"smartphone":return"mb-3";case"tablet":case"pc":return"mb-4"}})(),u=(()=>{switch(i){case"smartphone":return"gap-2";case"tablet":case"pc":return"gap-3"}})(),g=(()=>{switch(i){case"smartphone":return"text-sm";case"tablet":return"text-base";case"pc":return"text-xl"}})();return e.jsxs("div",{className:`mt-8 rounded-lg border-2 border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 ${l}`,children:[e.jsx("h3",{className:`${m} ${c} font-bold text-gray-900 dark:text-gray-100`,children:"üìã ÈÅ∏ÊäûÂÜÖÂÆπ"}),e.jsxs("div",{className:`grid ${u} sm:grid-cols-2`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${g} font-semibold text-gray-700 dark:text-gray-300`,children:"ÂÖ•ÂäõÊñπÂºè:"}),e.jsx("span",{className:`${g} text-gray-900 dark:text-gray-100`,children:a==="keyboard"?"‚å®Ô∏è „Ç≠„Éº„Éú„Éº„Éâ":a==="touch"?"üì± „Çø„ÉÉ„ÉÅ":"Êú™ÈÅ∏Êäû"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${g} font-semibold text-gray-700 dark:text-gray-300`,children:"ÂèÇÂä†ËÄÖ:"}),e.jsx("span",{className:`${g} text-gray-900 dark:text-gray-100`,children:o>0?`${o} ‰∫∫`:"Êú™ÈÅ∏Êäû"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${g} font-semibold text-gray-700 dark:text-gray-300`,children:"„Éá„ÉÉ„Ç≠"}),e.jsx("span",{className:`${g} text-gray-900 dark:text-gray-100`,children:t?e.jsxs(e.Fragment,{children:[t.title,s&&e.jsxs("span",{className:"ml-1 text-xs text-gray-600 dark:text-gray-400",children:["(",s.size.toLocaleString()," ÁµÑ)"]})]}):"Êú™ÈÅ∏Êäû"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${g} font-semibold text-gray-700 dark:text-gray-300`,children:"ÊûöÊï∞:"}),e.jsx("span",{className:`${g} text-gray-900 dark:text-gray-100`,children:r?e.jsxs(e.Fragment,{children:[r.title,n!==null&&e.jsxs("span",{className:"ml-1 text-xs text-gray-600 dark:text-gray-400",children:["(",n.toLocaleString()," ÁµÑ)"]})]}):"Êú™ÈÅ∏Êäû"})]})]})]})}function W({isSelected:a,onClick:t,disabled:s=!1,icon:r,label:n,className:o="",alignment:i="center",screenSize:l}){const c=l?{smartphone:{padding:"p-2",gap:"gap-2",iconSize:"h-8 w-8",textSize:"text-sm"},tablet:{padding:"p-4",gap:"gap-3",iconSize:"h-12 w-12",textSize:"text-base"},pc:{padding:"p-4",gap:"gap-3",iconSize:"h-12 w-12",textSize:"text-xl"}}[l]:{padding:"p-2 md:p-4",gap:"gap-2 md:gap-3",iconSize:"h-8 w-8 md:h-12 md:w-12",textSize:"text-sm md:text-base lg:text-xl"};return e.jsxs("div",{onClick:s?void 0:t,className:`group relative h-auto w-full overflow-hidden rounded-xl shadow-md transition-all duration-300 hover:scale-105 hover:shadow-lg active:scale-95 ${c.padding} ${s?"cursor-not-allowed opacity-50":"cursor-pointer hover:scale-105"} ${a?"bg-indigo-600 text-white dark:bg-indigo-500":"bg-white dark:bg-gray-800"} ${o}`,children:[e.jsx("div",{className:`absolute inset-0 bg-linear-to-br from-blue-400 to-indigo-500 opacity-0 transition-opacity group-hover:opacity-10 ${a?"opacity-20":""}`}),e.jsxs("div",{className:`relative flex items-center ${c.gap} ${i==="start"?"justify-start":"justify-center"}`,children:[r&&e.jsx("div",{className:`flex shrink-0 items-center justify-center rounded-full ${c.iconSize} ${a?"bg-white/20 text-white":"bg-indigo-100 dark:bg-indigo-900"}`,children:r}),e.jsx("div",{className:`${i==="start"?"w-full":""} ${i==="start"&&r?"flex-1":""}`,children:e.jsx("div",{className:`${i==="start"?"w-full":""} font-semibold ${c.textSize} ${i==="start"?"text-left":"text-center"} ${a?"text-white":"text-gray-900 dark:text-gray-100"}`,children:n})})]})]})}function ds({selectedPlayMode:a,onSelectPlayMode:t,isLoading:s,screenSize:r}){return e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(W,{isSelected:a==="touch",onClick:()=>t("touch"),disabled:s,icon:e.jsx(Yt,{className:"h-6 w-6"}),label:"„Çø„ÉÉ„ÉÅ",alignment:"center",screenSize:r}),e.jsx(W,{isSelected:a==="keyboard",onClick:()=>t("keyboard"),disabled:s,icon:e.jsx(Bt,{className:"h-6 w-6"}),label:"„Ç≠„Éº„Éú„Éº„Éâ",alignment:"center",screenSize:r})]})}function cs({availablePlayers:a,selectedPlayerIds:t,onTogglePlayer:s,onAddPlayer:r,isLoading:n,screenSize:o}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 items-start gap-4 md:grid-cols-3 lg:grid-cols-4",children:[a.map(i=>{const l=t.includes(i.id),c=t.length>=U.MAX_GAME_PLAYERS;return e.jsx(W,{isSelected:l,onClick:()=>s(i.id),disabled:n||!l&&c,icon:l?"‚úì":"üë§",label:i.name,alignment:"start",screenSize:o},i.id)}),e.jsx(W,{isSelected:!1,onClick:r,disabled:n||t.length>=U.MAX_GAME_PLAYERS,icon:e.jsx("span",{className:"text-4xl text-gray-400",children:"+"}),label:"",className:"bg-gray-50 hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700",alignment:"center",screenSize:o})]}),t.length>=U.MAX_GAME_PLAYERS&&e.jsxs("p",{className:"text-center text-sm text-gray-500 dark:text-gray-400",children:["„Ç≤„Éº„É†„Å´ÂèÇÂä†„Åß„Åç„Çã„ÅÆ„ÅØÊúÄÂ§ß",U.MAX_GAME_PLAYERS,"‰∫∫„Åæ„Åß„Åß„Åô"]})]})}const ms={primary:"text-indigo-600 dark:text-indigo-400",secondary:"text-gray-600 dark:text-gray-400",success:"text-green-600 dark:text-green-400",warning:"text-orange-600 dark:text-orange-400",danger:"text-red-600 dark:text-red-400"};function K({title:a,variant:t="primary",children:s,className:r="",screenSize:n}){const o=n?{smartphone:"text-xs",tablet:"text-sm",pc:"text-base"}[n]:"text-xs md:text-sm lg:text-base",i=n?{smartphone:"p-3 pt-5",tablet:"p-4 pt-6",pc:"p-4 pt-6"}[n]:"p-3 pt-5 md:p-4 md:pt-6",l=n?{smartphone:"-top-2 left-3 px-1.5",tablet:"-top-2.5 left-4 px-2",pc:"-top-2.5 left-4 px-2"}[n]:"-top-2 left-3 px-1.5 md:-top-2.5 md:left-4 md:px-2",c=n?{smartphone:"space-y-2",tablet:"space-y-3",pc:"space-y-3"}[n]:"space-y-2 md:space-y-3";return e.jsxs("div",{className:`relative rounded-lg border-2 border-gray-200 dark:border-gray-700 ${i} ${r}`,children:[e.jsx("h2",{className:`absolute bg-gradient-to-br from-indigo-50 to-purple-50 font-bold tracking-wider uppercase dark:from-gray-900 dark:to-gray-800 ${o} ${l} ${ms[t]}`,children:a}),e.jsx("div",{className:c,children:s})]})}function us({recipe:a,onSelect:t,isSelected:s=!1,isLoading:r=!1,screenSize:n}){const o=s?"bg-indigo-600 text-white dark:bg-indigo-500":"bg-white dark:bg-gray-800",i={title:s?"text-white":"text-gray-800 dark:text-gray-100",description:s?"text-indigo-100":"text-gray-600 dark:text-gray-400"},l=n?{smartphone:{padding:"p-2",titleSize:"text-base",descriptionSize:"text-xs",contentSize:"text-xs",labelSize:"text-xs"},tablet:{padding:"p-4",titleSize:"text-lg",descriptionSize:"text-sm",contentSize:"text-sm",labelSize:"text-sm"},pc:{padding:"p-6",titleSize:"text-xl",descriptionSize:"text-sm",contentSize:"text-sm",labelSize:"text-sm"}}[n]:{padding:"p-4 md:p-5 lg:p-6",titleSize:"text-base md:text-lg lg:text-xl",descriptionSize:"text-xs md:text-sm"};return e.jsxs(C,{onClick:()=>t(a),disabled:r,variant:s?"default":"outline",className:`group relative h-auto overflow-hidden rounded-2xl shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-2xl active:scale-95 disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:scale-100 ${l.padding} ${o}`,children:[e.jsx("div",{className:`absolute inset-0 bg-linear-to-br from-blue-400 to-indigo-500 opacity-0 transition-opacity group-hover:opacity-10 ${s?"opacity-20":""}`}),e.jsxs("div",{className:"relative",children:[e.jsx("h3",{className:`my-0 font-bold ${l.titleSize} ${i.title}`,children:a.title}),a.description&&e.jsx("p",{className:`my-0 ${l.descriptionSize} ${i.description}`,children:a.description}),!1,n!=="smartphone"&&e.jsx("div",{className:"flex flex-wrap items-center gap-1",children:a.tags.map(c=>e.jsxs(_,{variant:"secondary",className:s?"bg-white/20 text-white hover:bg-white/30":"",children:["#",c]},c))})]})]})}function gs({stackRecipes:a,selectedStackRecipe:t,onSelectStackRecipe:s,isLoading:r,generatedDeck:n,screenSize:o}){return n!==null&&n.size===0?e.jsx("div",{className:"rounded-lg border border-yellow-200 bg-yellow-50 p-4 dark:border-yellow-800 dark:bg-yellow-950",children:e.jsx("p",{className:"text-sm font-semibold text-yellow-800 dark:text-yellow-200",children:"‚ö†Ô∏è „Éá„ÉÉ„Ç≠„ÅåÁ©∫ (0ÁµÑ) „ÅÆ„Åü„ÇÅ„ÄÅ„Ç≤„Éº„É†„ÇíÈñãÂßãÂá∫Êù•„Åæ„Åõ„Çì"})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-3 lg:grid-cols-4",children:a.map(l=>e.jsx(us,{recipe:l,onSelect:s,isSelected:t?.id===l.id,isLoading:r,screenSize:o},l.id))})})}function ps({selectedTatamiSize:a,onSelectTatamiSize:t,availableSizes:s,isLoading:r,screenSize:n}){return e.jsx("div",{className:"grid grid-cols-4 gap-4",children:s.map(o=>{const i=a===o;return e.jsx(W,{isSelected:i,onClick:()=>t(o),disabled:r,label:String(o),alignment:"center",screenSize:n},o)})})}function xs({playMode:a,repository:t,deckRecipe:s,stackRecipe:r,players:n,tatamiSize:o,game:i,state:l,screenSize:c}){const m=r.generatedStack?r.generatedStack.length:s.generatedDeck&&r.selected?r.selected.maxSize==="all"?s.generatedDeck.size:Math.min(r.selected.maxSize,s.generatedDeck.size):null;return e.jsx("div",{className:"min-h-screen bg-linear-to-br from-indigo-50 to-purple-50 p-4 dark:from-gray-900 dark:to-gray-800",children:e.jsxs("div",{className:"mx-auto max-w-7xl",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx("h1",{className:"mb-2 text-2xl font-bold text-gray-800 md:text-3xl lg:text-4xl dark:text-gray-100",children:"üé¥ PP Karuta 26"})}),l.error&&e.jsx(Z,{variant:"destructive",className:"mb-6",children:e.jsxs(Q,{children:[e.jsx("p",{className:"font-semibold",children:"„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:"}),e.jsx("p",{className:"text-xs md:text-sm",children:l.error})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(K,{title:"ÂÖ•ÂäõÊñπÂºè",variant:"primary",screenSize:c,children:e.jsx(ds,{selectedPlayMode:a.selected,onSelectPlayMode:a.onSelect,isLoading:l.isLoading,screenSize:c})}),e.jsx(K,{title:"„Éó„É¨„Ç§„É§„Éº",variant:"success",screenSize:c,children:e.jsx(cs,{availablePlayers:n.available,selectedPlayerIds:n.selectedIds,onTogglePlayer:n.onToggle,onAddPlayer:n.onAdd,isLoading:l.isLoading,screenSize:c})}),e.jsx(K,{title:"Áï≥„Çµ„Ç§„Ç∫",variant:"warning",screenSize:c,children:e.jsx(ps,{selectedTatamiSize:o.selected,onSelectTatamiSize:o.onSelect,availableSizes:o.availableSizes,isLoading:l.isLoading,screenSize:c})}),e.jsxs(K,{title:"„Éá„ÉÉ„Ç≠",variant:"danger",screenSize:c,children:[!t.isReady&&e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Oe,{screenSize:c})}),t.isReady&&e.jsx(is,{deckRecipes:s.recipes,selectedDeckRecipe:s.selected,onSelectDeckRecipe:s.onSelect,isDeckLoading:s.isLoading,loadingDeckRecipeId:s.loadingRecipeId,generatedDeck:s.generatedDeck,screenSize:c,initialOpenCategories:s.selected?s.selected.tags:["Âπ≤ÊîØ"]})]}),t.isReady&&e.jsx(K,{title:"Êú≠Êï∞",variant:"secondary",screenSize:c,children:e.jsx(gs,{stackRecipes:r.recipes,selectedStackRecipe:r.selected,onSelectStackRecipe:r.onSelect,isLoading:l.isLoading,generatedStack:r.generatedStack,generatedDeck:s.generatedDeck,screenSize:c})})]}),e.jsx(ls,{selectedPlayMode:a.selected,selectedDeckRecipe:s.selected,generatedDeck:s.generatedDeck,selectedStackRecipe:r.selected,stackSize:m,selectedPlayerCount:n.selectedIds.length,screenSize:c}),e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx(C,{onClick:i.onStart,disabled:!i.canStart||l.isLoading,size:"lg",className:"h-12 px-8 text-base font-bold md:h-14 md:px-10 md:text-lg lg:h-16 lg:px-12 lg:text-xl",children:l.isLoading?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mr-2 h-5 w-5 animate-spin rounded-full border-4 border-white border-t-transparent"}),"Loading..."]}):"START"})}),!i.canStart&&e.jsx("p",{className:"mt-4 text-center text-sm text-gray-500 dark:text-gray-400",children:"ÂÖ®„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ"})]})})}function hs({setup:a,onShowIntro:t}){const s=pe(),r=Xe();d.useEffect(()=>{r.type==="token-invalid"&&console.error("Repository error:",r.error)},[r]);const n=r.type==="created-token-valid",o=r.type==="token-invalid"?r.error:null;return e.jsx(xs,{playMode:{selected:a.selectedPlayMode,onSelect:a.selectPlayMode},repository:{isReady:n},deckRecipe:{recipes:Ve.RECIPES,selected:a.selectedDeckRecipe,onSelect:a.selectDeckRecipe,isLoading:a.isDeckLoading,loadingRecipeId:a.loadingDeckRecipeId,generatedDeck:a.generatedDeck},stackRecipe:{recipes:Ba,selected:a.selectedStackRecipe,onSelect:a.selectStackRecipe,generatedStack:a.generatedStack},players:{available:a.availablePlayers,selectedIds:a.selectedPlayerIds,onToggle:a.togglePlayer,onAdd:a.addPlayer},tatamiSize:{selected:a.selectedTatamiSize,onSelect:a.selectTatamiSize,availableSizes:a.availableTatamiSizes},game:{onStart:a.createGameState,canStart:a.canStartGame},state:{isLoading:a.isCreatingGame||r.type==="validating",error:a.error||(o?`Repository error: ${o}`:null)},onShowIntro:t,screenSize:s})}function fs({enabled:a,playerStates:t,deck:s,onCardSelect:r}){d.useEffect(()=>{if(!a)return;const n=o=>{if(o.ctrlKey||o.metaKey||o.altKey||o.shiftKey)return;const i=o.key.toLowerCase(),l=t.length;for(let c=0;c<t.length;c++){const m=t[c],u=We(c,l);if(!u)continue;const g=u.indexOf(i);if(g!==-1){const y=H.getByIds(s,m.tatami);if(g<y.length){const v=y[g];o.preventDefault(),r(m.player.id,v);return}}}};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[a,t,s,r])}function ys({currentRace:a,totalRaces:t,score:s,mochiFudaCount:r,stackCount:n,tatamiCount:o,screenSize:i}){const l=i?{smartphone:"text-lg",tablet:"text-xl",pc:"text-2xl"}[i]:"text-lg sm:text-xl md:text-2xl",c=i?{smartphone:"my-0",tablet:"my-2",pc:"my-4"}[i]:"my-2 sm:my-3 md:my-4";return e.jsxs("div",{className:`text-center ${c}`,children:[e.jsx("div",{className:`font-bold text-gray-800 dark:text-gray-100 ${l}`,children:e.jsxs("span",{children:[a," / ",t]})}),!1]})}function bs({normalizedPrototype:a,index:t,keyboardKey:s,screenSize:r}){const o=`@container aspect-video overflow-hidden rounded-none ${r?{smartphone:"border-2",tablet:"border-2",pc:"border-2"}[r]:"border-2"} border-black bg-white shadow-none dark:border-white dark:bg-gray-950`;return e.jsx(A,{className:o,children:e.jsxs(M,{className:"flex h-full items-center justify-center p-0",children:[s&&e.jsx("span",{className:"font-bold text-gray-700 dark:text-gray-300 @[60px]:text-base @[80px]:text-lg @[100px]:text-xl @[120px]:text-2xl @[140px]:text-3xl @[180px]:text-4xl @[220px]:text-5xl @[280px]:text-6xl",children:s.toUpperCase()}),!1]})})}function qe({normalizedPrototype:a,index:t,isClickable:s=!1,showImage:r=!0,onClick:n,screenSize:o}){const l=`rounded-none ${o?{smartphone:"border-4",tablet:"border-8",pc:"border-8"}[o]:"border-4 md:border-8"} border-black dark:border-white`,c="group cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-xl active:scale-95",m="relative p-0",u=o?{smartphone:"aspect-video overflow-hidden rounded-none bg-gray-200",tablet:"aspect-video overflow-hidden rounded-none bg-gray-200",pc:"aspect-video overflow-hidden rounded-none bg-gray-200"}[o]:"aspect-video overflow-hidden rounded-none bg-gray-200";return e.jsx(A,{className:s?`${l} ${c}`:l,onClick:s&&n?()=>n(a):void 0,children:e.jsxs(M,{className:m,children:[r&&e.jsx("div",{className:u,children:e.jsx("img",{src:a.mainUrl,alt:a.prototypeNm,className:"h-full w-full object-cover",onError:y=>{y.currentTarget.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100"%3E%3Crect fill="%23ddd" width="100" height="100"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" dy=".3em" fill="%23999"%3ENo Image%3C/text%3E%3C/svg%3E'}})}),!1]})})}function vs(a){const{playMode:t}=a;return t==="keyboard"?e.jsx(bs,{...a}):e.jsx(qe,{...a})}function ks({player:a,playerIndex:t,playerCount:s,tatamiCards:r,onCardClick:n,mochiFudaCount:o,score:i,playMode:l,feedbackState:c=null,screenSize:m="pc"}){const u=l==="touch",g=m?{smartphone:"text-sm",tablet:"text-base",pc:"text-lg"}[m]:"text-sm md:text-base lg:text-lg",y=m?{smartphone:"p-2",tablet:"p-4",pc:"p-6"}[m]:"p-3 md:p-4 lg:p-6",v=m?{smartphone:"gap-2",tablet:"gap-3",pc:"gap-3"}[m]:"gap-2 md:gap-3",w=l==="keyboard"?"grid-cols-4":m?{smartphone:"grid-cols-2",tablet:"grid-cols-2",pc:"grid-cols-2"}[m]:"grid-cols-2 md:grid-cols-3 lg:grid-cols-4",h=c?c==="correct"?"border-green-500":"border-red-500":"border-indigo-300",j=c?c==="correct"?"shadow-2xl shadow-green-500/70":"shadow-2xl shadow-red-500/70":"shadow-lg",f=c?c==="correct"?"animate-[flash_0.6s_ease-in-out]":"animate-[shake_0.5s_ease-in-out]":"";return e.jsxs(A,{className:`border-2 ${h} ${j} ${f} transition-all duration-300`,children:[e.jsx(z,{className:y,children:e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("h3",{className:`flex items-center gap-2 font-bold text-indigo-700 ${g}`,children:[e.jsx("span",{children:"üë§"}),a.name]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{variant:"outline",className:"bg-yellow-100 text-yellow-700",children:[i.toLocaleString()," pts"]}),e.jsxs(_,{variant:"outline",className:"bg-pink-100 text-pink-700",children:[o.toLocaleString()," Êûö"]})]})]})}),e.jsx(M,{className:y,children:e.jsx("div",{className:`grid ${v} ${w}`,children:r.map((p,x)=>e.jsx(vs,{normalizedPrototype:p,index:x,isClickable:!0,playMode:l,showImage:u,onClick:n,keyboardKey:Da(t,x,s),screenSize:m},p.id))})})]})}function ws({tatamiCards:a,screenSize:t="pc"}){const s=t?{smartphone:"text-base",tablet:"text-lg",pc:"text-xl"}[t]:"text-base md:text-lg lg:text-xl",r=t?{smartphone:"grid-cols-4",tablet:"grid-cols-4",pc:"grid-cols-4"}[t]:"grid-cols-4 md:grid-cols-4 lg:grid-cols-4";return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:`mb-4 text-center font-bold text-gray-700 dark:text-gray-300 ${s}`,children:"üé¥ Shared Tatami (Reference Only)"}),e.jsx("div",{className:`grid gap-4 ${r}`,children:a.map((n,o)=>e.jsx(qe,{normalizedPrototype:n,index:o,isClickable:!1,showImage:!0,screenSize:t},n.id))})]})}function js({text:a,speed:t=500,startDelay:s=0}){const[r,n]=d.useState(""),[o,i]=d.useState(-1),l=d.useMemo(()=>Array.from(a),[a]);return d.useEffect(()=>{if(o!==-1)return;const c=setTimeout(()=>{i(0)},s);return()=>clearTimeout(c)},[s,o]),d.useEffect(()=>{if(o<0||o>=l.length)return;const c=setTimeout(()=>{n(l.slice(0,o+1).join("")),i(o+1)},t);return()=>clearTimeout(c)},[o,l,t]),{displayedText:r,isComplete:o>=l.length}}function Ss({normalizedPrototype:a,screenSize:t}){const s="üìú"+(a.prototypeNm??"NO NAME")+" - "+(a.summary||"NO DESCRIPTION"),{displayedText:r}=js({text:s,speed:200}),n=t?{smartphone:"text-base",tablet:"text-xl",pc:"text-2xl"}[t]:"text-base md:text-xl lg:text-2xl",o=t?{smartphone:"px-3 py-2",tablet:"px-4 py-3",pc:"px-6 py-4"}[t]:"px-3 py-2 md:px-4 md:py-3 lg:px-6 lg:py-4";return e.jsx("div",{className:`bg-primary text-primary-foreground flex items-center gap-3 rounded-lg shadow-lg ${o}`,children:e.jsx("h2",{className:`flex-1 font-bold tracking-widest ${n}`,children:r||"¬†"})})}function Ns({yomiFuda:a,sharedTatamiCards:t,playerStates:s,deck:r,currentRace:n,totalRaces:o,stackCount:i,playMode:l,onPlayerCardSelect:c,playerFeedbackStates:m,screenSize:u}){const g=s.reduce((p,x)=>p+x.score,0),y=s.reduce((p,x)=>p+x.mochiFuda.length,0),v=s.length,w=u?{smartphone:"p-2",tablet:"p-4",pc:"p-6"}[u]:"p-2 md:p-3 lg:p-4",h=u?{smartphone:"my-4 space-y-3",tablet:"my-6 space-y-4",pc:"my-8 space-y-6"}[u]:"my-4 md:my-6 lg:my-8 space-y-3 md:space-y-4 lg:space-y-6",j=u?{smartphone:"gap-2",tablet:"gap-3",pc:"gap-4"}[u]:"gap-2 md:gap-3 lg:gap-4",f=()=>l==="keyboard"?v===1?"grid-cols-1":v===2?"grid-cols-2":v===3?"grid-cols-3":"grid-cols-4":v<=1?"grid-cols-1":"grid-cols-2";return e.jsx("div",{className:`flex h-screen flex-col bg-gradient-to-br from-green-50 to-teal-100 dark:from-gray-900 dark:to-gray-800 ${w}`,children:e.jsxs("div",{className:"mx-auto flex w-full max-w-7xl flex-1 flex-col overflow-hidden",children:[e.jsx(ys,{currentRace:n,totalRaces:o,score:g,mochiFudaCount:y,stackCount:i,tatamiCount:t.length,screenSize:u}),e.jsxs("div",{className:`flex-shrink-0 ${h}`,children:[l!=="touch"&&e.jsx(ws,{tatamiCards:t,playMode:l,screenSize:u}),e.jsx(Ss,{normalizedPrototype:a,screenSize:u},a.id)]}),e.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:`grid ${j} ${f()}`,children:s.map((p,x)=>{const D=H.getByIds(r,p.tatami);return e.jsx(ks,{player:p.player,playerIndex:x,playerCount:s.length,tatamiCards:D,onCardClick:P=>c(p.player.id,P),mochiFudaCount:p.mochiFuda.length,score:p.score,playMode:l,feedbackState:m[p.player.id]??null,screenSize:u},p.player.id)})})})})]})})}function Ps({gameState:a,playMode:t,onCorrectAnswer:s,onIncorrectAnswer:r,screenSize:n}){const i=a.playerStates.reduce((w,h)=>w+h.mochiFuda.length,0),l=i+1,[c,m]=d.useState({}),u=a.readingOrder[i],g=u?a.deck.get(u):null,y=H.getByIds(a.deck,a.tatami),v=d.useCallback((w,h)=>{if(!g)return;const j=h.id===g.id;console.group(j?"‚úÖ Correct!":"‚ùå Incorrect!"),console.log("Player:",w),console.log("Selected:",h.prototypeNm,`(ID: ${h.id})`),console.log("Answer:",g.prototypeNm,`(ID: ${g.id})`),console.groupEnd(),m(p=>({...p,[w]:j?"correct":"incorrect"})),setTimeout(()=>{m(p=>({...p,[w]:null}))},j?1500:500),j?s(w,h.id):r(w)},[g,s,r]);return fs({enabled:t==="keyboard",playerStates:a.playerStates,deck:a.deck,onCardSelect:v}),i>=a.readingOrder.length?(console.log("üéâ All cards acquired! Game complete."),e.jsx("div",{children:"Loading results..."})):g?e.jsx(Ns,{yomiFuda:g,sharedTatamiCards:y,playerStates:a.playerStates,deck:a.deck,currentRace:l,totalRaces:a.readingOrder.length,stackCount:a.stack.length,playMode:t,onPlayerCardSelect:v,playerFeedbackStates:c,screenSize:n}):(console.error("Current YomiFuda not found in deck:",u,"at index",i),e.jsx("div",{children:"Error: YomiFuda not found"}))}const Cs="https://protopedia.net/prototype",Rs=a=>`${Cs}/${a}`;function Es({card:a}){const t=()=>{window.open(Rs(a.id),"_blank","noopener,noreferrer")};return e.jsx(A,{onClick:t,className:"cursor-pointer transition-all hover:shadow-lg",children:e.jsxs(M,{className:"p-4",children:[a.mainUrl&&e.jsx("img",{src:a.mainUrl,alt:a.prototypeNm,className:"mb-2 h-32 w-full rounded object-cover"}),e.jsx("h3",{className:"mb-1 text-sm font-semibold text-gray-800",children:a.prototypeNm}),e.jsx("p",{className:"line-clamp-2 text-xs text-gray-600",children:a.summary})]})})}function ve({onBackToTop:a,onReplay:t,buttonsGap:s,buttonSize:r}){return e.jsxs("div",{className:`flex flex-col justify-center sm:flex-row ${s}`,children:[e.jsx(C,{onClick:a,variant:"secondary",size:r,className:"shadow-lg",children:"üé¥ MENU"}),e.jsx(C,{onClick:t,variant:"default",size:r,className:"shadow-lg",children:"üîÑ REPLAY"})]})}function Is({playerStates:a,deck:t,onBackToTop:s,onReplay:r,screenSize:n}){const o=[...a].sort((c,m)=>m.score-c.score),i=[];o.forEach((c,m)=>{m===0?i.push(1):c.score===o[m-1].score?i.push(i[m-1]):i.push(m+1)});const l=n?{smartphone:{container:{padding:"p-4",maxWidth:"max-w-full"},header:{margin:"mb-4"},title:{size:"text-xl"},card:{margin:"mb-4"},ranking:{icon:"h-8 w-8 text-lg",name:"text-base",info:"text-xs",badge:"text-lg",padding:"p-3",gap:"gap-2"},playerCard:{icon:"h-8 w-8 text-base",title:"text-lg",gap:"gap-2"},grid:"grid-cols-1",buttons:{size:"default",gap:"gap-2"}},tablet:{container:{padding:"p-6",maxWidth:"max-w-3xl"},header:{margin:"mb-6"},title:{size:"text-2xl"},card:{margin:"mb-5"},ranking:{icon:"h-10 w-10 text-xl",name:"text-lg",info:"text-sm",badge:"text-xl",padding:"p-3",gap:"gap-3"},playerCard:{icon:"h-9 w-9 text-lg",title:"text-xl",gap:"gap-2"},grid:"grid-cols-2",buttons:{size:"lg",gap:"gap-3"}},pc:{container:{padding:"p-8",maxWidth:"max-w-4xl"},header:{margin:"mb-8"},title:{size:"text-2xl"},card:{margin:"mb-6"},ranking:{icon:"h-12 w-12 text-2xl",name:"text-lg",info:"text-sm",badge:"text-2xl",padding:"p-4",gap:"gap-4"},playerCard:{icon:"h-10 w-10 text-lg",title:"text-xl",gap:"gap-3"},grid:"grid-cols-3",buttons:{size:"lg",gap:"gap-4"}}}[n]:{container:{padding:"p-4 md:p-6 lg:p-8",maxWidth:"max-w-full md:max-w-3xl lg:max-w-4xl"},header:{margin:"mb-4 md:mb-6 lg:mb-8"},title:{size:"text-xl md:text-2xl"},card:{margin:"mb-4 md:mb-5 lg:mb-6"},ranking:{icon:"h-8 w-8 md:h-10 md:w-10 lg:h-12 lg:w-12 text-lg md:text-xl lg:text-2xl",name:"text-base md:text-lg",info:"text-xs md:text-sm",badge:"text-lg md:text-xl lg:text-2xl",padding:"p-3 md:p-3 lg:p-4",gap:"gap-2 md:gap-3 lg:gap-4"},playerCard:{icon:"h-8 w-8 md:h-9 md:w-9 lg:h-10 lg:w-10 text-base md:text-lg",title:"text-lg md:text-xl",gap:"gap-2 md:gap-2 lg:gap-3"},grid:"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",buttons:{size:"lg",gap:"gap-2 md:gap-3 lg:gap-4"}};return e.jsx("div",{className:`min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 ${l.container.padding}`,children:e.jsxs("div",{className:`mx-auto ${l.container.maxWidth}`,children:[e.jsx("div",{className:`text-center ${l.header.margin}`}),e.jsxs(A,{className:l.card.margin,children:[e.jsx(z,{children:e.jsx("h2",{className:`font-bold text-gray-800 dark:text-gray-100 ${l.title.size}`,children:"üèÜ Player Rankings"})}),e.jsx(M,{children:e.jsx("div",{className:"space-y-3",children:o.map((c,m)=>e.jsxs("div",{className:`flex items-center justify-between rounded-lg border dark:border-gray-700 dark:bg-gray-800 ${l.ranking.padding}`,children:[e.jsxs("div",{className:`flex items-center ${l.ranking.gap}`,children:[e.jsx("div",{className:`flex items-center justify-center rounded-full bg-indigo-100 font-bold text-indigo-600 dark:bg-indigo-900 dark:text-indigo-300 ${l.ranking.icon}`,children:i[m]}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-bold text-gray-800 dark:text-gray-100 ${l.ranking.name}`,children:c.player.name}),e.jsxs("p",{className:`text-gray-600 dark:text-gray-400 ${l.ranking.info}`,children:[c.mochiFuda.length," cards acquired"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs(_,{variant:"outline",className:`bg-indigo-100 font-bold text-indigo-700 dark:bg-indigo-900 dark:text-indigo-200 ${l.ranking.badge}`,children:[c.score," pts"]})})]},c.player.id))})})]}),e.jsx("div",{className:l.card.margin,children:e.jsx(ve,{onBackToTop:s,onReplay:r,buttonsGap:l.buttons.gap,buttonSize:l.buttons.size})}),o.map((c,m)=>{const u=c.mochiFuda.map(g=>t.get(g)).filter(g=>g!==void 0);return e.jsxs(A,{className:l.card.margin,children:[e.jsx(z,{children:e.jsxs("div",{className:`flex items-center ${l.playerCard.gap}`,children:[e.jsx("div",{className:`flex items-center justify-center rounded-full bg-indigo-100 font-bold text-indigo-600 dark:bg-indigo-900 dark:text-indigo-300 ${l.playerCard.icon}`,children:i[m]}),e.jsxs("h2",{className:`font-bold text-gray-800 dark:text-gray-100 ${l.playerCard.title}`,children:[c.player.name," (",u.length.toLocaleString()," Êûö)"]})]})}),e.jsx(M,{children:u.length===0?e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"NO FUDA"}):e.jsx("div",{className:`grid gap-4 ${l.grid}`,children:u.map(g=>e.jsx(Es,{card:g},g.id))})})]},c.player.id)}),e.jsx(ve,{onBackToTop:s,onReplay:r,buttonsGap:l.buttons.gap,buttonSize:l.buttons.size})]})})}function Ds({deck:a,playerStates:t,onBackToTop:s,onReplay:r}){const n=d.useCallback(()=>{console.log("üè† Back to TOP"),s()},[s]),o=d.useCallback(()=>{console.log("üîÑ Replay - Regenerating stack from deck"),r()},[r]);return e.jsx(Is,{playerStates:t,deck:a,onBackToTop:n,onReplay:o})}const Je="pp-karuta-deck-setup";function Ts(a,t){return a.offset===t.offset&&a.limit===t.limit&&a.userNm===t.userNm&&a.materialNm===t.materialNm&&a.tagNm===t.tagNm&&a.eventNm===t.eventNm}async function $s(a,t,s){console.log("üî® [generateDeckWithOptimization] Starting for recipe:",t.id);const r=s!==null&&Ts(s,t.apiParams);console.info("üîç [generateDeckWithOptimization] canReuseSnapshot:",r);let n;r?(console.debug("‚ôªÔ∏è Reusing repository snapshot (same apiParams), applying filter..."),n=await a.getAllFromSnapshot()):(console.debug("üåê Fetching new data from API (apiParams changed)"),n=await H.getPrototypesFromRecipe(t,a)),console.debug("üìä [generateDeckWithOptimization] Fetched prototypes:",n.length);const o=H.createDeckWithFilter(n,t.filter);return console.info("‚úÖ [generateDeckWithOptimization] Created deck with",o.size,"cards"),{deck:o,usedApiParams:t.apiParams}}function As(a){try{sessionStorage.setItem(Je,JSON.stringify(a))}catch(t){console.error("Failed to save setup state:",t)}}function ke(){try{const a=sessionStorage.getItem(Je);return a?JSON.parse(a):null}catch(a){return console.error("Failed to load setup state:",a),null}}function Ms({repository:a,onGameStateCreated:t}){const s=ke();console.log("üîç useGameSetup initialized with savedState:",s);const[r,n]=d.useState(null),[o,i]=d.useState(null),[l,c]=d.useState(!1),[m,u]=d.useState(null),[g,y]=d.useState(null),[v,w]=d.useState(null),[h,j]=d.useState(()=>{if(s?.selectedStackRecipeId){const k=de.findById(s.selectedStackRecipeId);return console.log("üîÑ Restoring StackRecipe from sessionStorage:",k?.id),k||null}const b=de.findById("standard-10");return console.log("üì¶ Using default StackRecipe:",b?.id),b||null}),[f,p]=d.useState([]),[x,D]=d.useState(()=>(console.log("üîÑ Restoring selectedPlayerIds from sessionStorage:",s?.selectedPlayerIds),s?.selectedPlayerIds||[])),[P,Y]=d.useState(()=>(console.log("üîÑ Restoring selectedPlayMode from sessionStorage:",s?.selectedPlayMode),s?.selectedPlayMode||"touch")),[S,L]=d.useState(()=>(console.log("üîÑ Restoring selectedTatamiSize from sessionStorage:",s?.selectedTatamiSize),s?.selectedTatamiSize||Ta)),[ee,F]=d.useState(null),[te,ye]=d.useState(!1);d.useEffect(()=>{(async()=>{const k=await E.loadPlayers();if(k&&k.length>0)p(k),D([k[0].id]);else{const I=E.createPlayer(`player-${Date.now()}`,"Player 1"),R=[I];p(R),D([I.id]),await E.savePlayers(R)}})()},[]);const ae=d.useCallback(async b=>{if(!a){F("Repository is not initialized");return}if(o?.id===b.id&&r!==null){console.log("üì¶ Same DeckRecipe selected, reusing existing Deck:",b.id),c(!1);return}c(!0),u(b.id),F(null);let k,I;try{const R=await $s(a,b,g);k=R.deck,I=R.usedApiParams}catch(R){const V=R instanceof Error?R.message:"Failed to generate Deck";F(V),console.error("Failed to generate Deck:",R),c(!1),u(null);return}if(y(I),n(k),i(b),console.log("‚úÖ Deck generated successfully:",k.size,"cards"),h&&k.size>0)try{const R=ce.generate(k,h);w(R),console.log("‚úÖ Stack regenerated:",R.length,"cards")}catch(R){console.error("Failed to regenerate Stack:",R),w(null)}else k.size===0&&(w(null),console.log("‚ö†Ô∏è Deck is empty, skipping Stack generation"));c(!1),u(null)},[a,o?.id,r,h,g]);d.useEffect(()=>{const b=ke();if(console.log("üîç Checking deck restoration:",{hasRepository:!!a,savedDeckRecipeId:b?.selectedDeckRecipeId,currentDeckRecipe:o?.id}),a&&b?.selectedDeckRecipeId&&!o){const k=Ve.RECIPES.find(I=>I.id===b.selectedDeckRecipeId);k?(console.log("üîÑ Restoring deck recipe from sessionStorage:",k.id),ae(k)):console.warn("‚ö†Ô∏è Saved deck recipe not found:",b.selectedDeckRecipeId)}},[a,o]),d.useEffect(()=>{a&&o&&!r&&!l&&(console.log("üîÑ Repository became available, regenerating deck for recipe:",o.id),ae(o))},[a,o,r,l]),d.useEffect(()=>{const b={selectedDeckRecipeId:o?.id||null,selectedStackRecipeId:h?.id||null,selectedPlayerIds:x,selectedPlayMode:P,selectedTatamiSize:S};As(b)},[o,h,x,P,S]);const Ze=d.useCallback(b=>{if(j(b),F(null),r&&r.size>0){const k=ce.generate(r,b);w(k),console.log("‚úÖ Stack generated:",k.length,"cards")}else w(null),r&&r.size===0&&console.log("‚ö†Ô∏è Deck is empty, skipping Stack generation")},[r]),Qe=d.useCallback(b=>{D(k=>{const I=k.includes(b)?k.filter(R=>R!==b):[...k,b];return P==="keyboard"&&I.length>=3&&(S===12||S===16)&&L(8),I}),F(null)},[P,S]),et=d.useCallback(async()=>{const b=f.length+1,k=E.createPlayer(`player-${Date.now()}`,`Player ${b}`),I=[...f,k];p(I),await E.savePlayers(I),D(R=>{const V=[...R,k.id];return P==="keyboard"&&V.length>=3&&(S===12||S===16)&&L(8),V}),F(null)},[f,P,S]),tt=d.useCallback(b=>{Y(b),F(null),b==="keyboard"&&x.length>=3&&(S===12||S===16)&&L(8)},[x.length,S]),at=d.useCallback(b=>{L(b),F(null)},[]),st=d.useMemo(()=>{if(P==="keyboard")switch(x.length){case 1:return ie;case 2:return ie;case 3:return oe;case 4:return oe;default:return oe}return ie},[P,x.length]),se=d.useMemo(()=>r!==null&&r.size>0&&h!==null&&v!==null&&v.length>0&&x.length>0&&P!==null&&!l&&!te,[r,h,v,x,P,l,te]),rt=d.useCallback(async()=>{if(!(!se||!r||!h||!P)){ye(!0),F(null);try{const b=f.filter(I=>x.includes(I.id));if(b.length===0)throw new Error("No players selected");const k=U.createInitialState(r,b,P,h,S);t(k)}catch(b){const k=b instanceof Error?b.message:"Failed to create game state";F(k),console.error("Failed to create game state:",b)}finally{ye(!1)}}},[se,r,h,P,S,f,x,t]);return{generatedDeck:r,selectedDeckRecipe:o,selectDeckRecipe:ae,isDeckLoading:l,loadingDeckRecipeId:m,generatedStack:v,selectedStackRecipe:h,selectStackRecipe:Ze,availablePlayers:f,selectedPlayerIds:x,togglePlayer:Qe,addPlayer:et,selectedPlayMode:P,selectPlayMode:tt,selectedTatamiSize:S,selectTatamiSize:at,availableTatamiSizes:st??[4,8,12,16],canStartGame:se,createGameState:rt,error:ee,isCreatingGame:te}}function Fs(){const a=me(),t=pe(),s=lt({from:"/"}),r=Xe(),n=r.type==="created-token-valid"?r.repository:null,[o,i]=d.useState(null),l=Ms({repository:n,onGameStateCreated:f=>{console.log("üéÆ Game started"),i(f),window.scrollTo({top:0,behavior:"smooth"})}}),c=s?.reset;d.useEffect(()=>{c&&(console.log("üîÑ Resetting game state due to reset parameter"),i(null))},[c]);const m=l.selectedPlayMode,u=d.useCallback((f,p)=>{console.log("üéØ handleCorrectAnswer called with playerId:",f,"cardId:",p),i(x=>{if(!x)return x;const D=x.playerStates.map(S=>{const L=S.tatami.filter(ee=>ee!==p);return x.stack.length>0&&L.push(x.stack[0]),S.player.id===f?{...S,tatami:L,mochiFuda:[...S.mochiFuda,p],score:S.score+1}:{...S,tatami:L}}),P=x.tatami.filter(S=>S!==p),Y=[...x.stack];if(Y.length>0){const S=Y.shift();S!==void 0&&P.push(S)}return console.log("üé¥ Updated - SharedTatami:",P,"Stack:",Y),{...x,tatami:P,stack:Y,playerStates:D}})},[]),g=d.useCallback(f=>{i(p=>{if(!p)return p;const x=p.playerStates.map(D=>D.player.id!==f?D:{...D,score:Math.max(0,D.score-1)});return{...p,playerStates:x}})},[]),y=d.useCallback(()=>{i(null)},[]),v=d.useCallback(async()=>{console.log("üîÑ Replaying game with same settings"),await l.createGameState()},[l]),w=d.useCallback(()=>{a({to:"/intro"})},[a]),h=o?.playerStates.reduce((f,p)=>f+p.mochiFuda.length,0)||0,j=o&&h>=o.readingOrder.length;return console.log("üìä Game status:",{totalMochiFuda:h,readingOrderLength:o?.readingOrder.length,isGameOver:j}),j&&o?e.jsx(Ds,{deck:o.deck,playerStates:o.playerStates,onBackToTop:y,onReplay:v}):o&&m?e.jsx(Ps,{gameState:o,playMode:m,onCorrectAnswer:u,onIncorrectAnswer:g,screenSize:t}):e.jsx(hs,{setup:l,onShowIntro:w})}const zs=ue("/")({component:Ls,validateSearch:a=>({reset:typeof a.reset=="string"?a.reset:void 0})});function Ls(){return e.jsx(Fs,{})}const _s=Ja.update({id:"/player",path:"/player",getParentRoute:()=>J}),Os=es.update({id:"/intro",path:"/intro",getParentRoute:()=>J}),Ys=zs.update({id:"/",path:"/",getParentRoute:()=>J}),Bs={IndexRoute:Ys,IntroRoute:Os,PlayerRoute:_s},Gs=J._addFileChildren(Bs)._addFileTypes(),Ks=dt({routeTree:Gs,basepath:"/pp-karuta"});nt.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(ct,{router:Ks})}));
